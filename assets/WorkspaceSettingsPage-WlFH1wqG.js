import{w as He,r as a,_ as qe,af as Fe,K as Qe,M as Je,h as ee,c as Ke,q as D,n as fe,j as t,a1 as Xe,a as Ye,f as B,e as V,a2 as Ge,I as se,k as Me,d as De,aj as te,S as Ze,i as pe}from"./index-Ba6YVotX.js";import{d as _,bG as et,bu as tt,M as je,bv as ge,m as st,ca as ae,cb as at,x as W,cc as ne,q as nt,r as lt,cd as le,p as U,C as oe,ce as ot,cg as ye,e2 as it,e3 as ct,e4 as rt,e5 as Ne,e6 as me,ch as Le,T as O,c2 as ie,d_ as dt,d$ as ut,cm as ht,e7 as xt,J as ft,e8 as pt,e9 as q,ea as F,eb as Q,ec as J,ed as K,i as Y,ee as jt,ef as gt,eg as yt,eh as mt,ei as vt,bo as Re,ej as z,L as E,b as R,bg as Ee,n as ce,F as Ct,c_ as _t,c$ as ve,d0 as Ce,ek as wt,y as Pe,el as St,aw as re,X as Ue,bN as kt,em as _e,en as we,eo as Se,ep as bt,D as ke,eq as It,U as be,I as Ie,ci as At,bt as Gt,R as Mt,aB as Dt,dQ as Nt,h as Lt,N as Rt,O as Ae,o as Et}from"./App-CM6DQiPl.js";import{H as Te}from"./Header-GcB7EjiI.js";import{A as Pt}from"./AddIntegrationTooltip-DIe93P-e.js";import{C as Ut,A as Tt}from"./CreatedByAvatar-YQVhMxPo.js";var $t={root:{overflow:"hidden"}},zt=a.forwardRef(function(s,i){var h=s.classes,p=s.className,j=s.raised,w=j===void 0?!1:j,C=qe(s,["classes","className","raised"]);return a.createElement(Fe,Qe({className:Je(h.root,p),elevation:w?8:1,ref:i},C))});const Ot=He($t,{name:"MuiCard"})(zt);function Wt(e){const{url:s}=ee(),i=Ke(),h=ee(`${s}/:section`),p=a.useCallback(j=>{i.replace(`${s}/${j}`)},[i,s]);return[(h==null?void 0:h.params.section)||e,p]}const Bt=({value:e,onChange:s=w=>w,options:i,getOptionLabel:h=w=>w,placeholder:p,disabled:j})=>{const[w,C]=a.useState(!1),x=a.useRef(null),k=a.useCallback(n=>{C(!1),s(n)},[s]);return t.jsxs(t.Fragment,{children:[t.jsxs(Vt,{ref:x,disabled:j,defaultChecked:e==null,open:w,onClick:()=>!j&&C(!0),children:[e==null?t.jsx("span",{style:{fontSize:12},children:p}):t.jsx(_,{variant:"body2",className:"value",children:h(e)}),t.jsx(et,{fontSize:"small"})]}),t.jsxs(tt,{open:w,anchorEl:x==null?void 0:x.current,anchorOrigin:{vertical:"bottom",horizontal:"left"},onClose:()=>C(!1),children:[e!==void 0&&t.jsx(je,{selected:e===null,onClick:()=>k(null),children:t.jsx(ge,{secondary:p})}),i==null?void 0:i.map((n,m)=>t.jsx(je,{selected:e===n,onClick:()=>k(n),children:t.jsx(ge,{primary:h(n)})},m))]})]})},Vt=D.div.withConfig({displayName:"DropDown__SelectorBox",componentId:"sc-1nacvcl-0"})(({theme:e,open:s,defaultChecked:i,disabled:h})=>({display:"flex",alignItems:"center",height:28,borderRadius:e.shape.borderRadius*1.5,padding:`${e.spacing(.7)}px ${e.spacing(2)}px`,cursor:"pointer",".value":{color:"inherit"},...!h&&{"&:hover":{background:e.palette.primary.main,color:e.palette.primary.contrastText}},...s&&{background:e.palette.primary.main,color:e.palette.primary.contrastText},...i&&!s&&{color:e.palette.common.gray,border:`1px solid ${e.palette.common.gray}`},...!i&&!s&&{border:`1px solid ${e.palette.primary.main}`,color:e.palette.primary.main},...h&&{color:fe(e.palette.text.secondary,.1),borderColor:fe(e.palette.text.secondary,.1),cursor:"default"}})),Ht=({title:e,titleId:s,...i},h)=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:17,height:17,fill:"none",ref:h,"aria-labelledby":s,...i},e?a.createElement("title",{id:s},e):null,a.createElement("mask",{id:"person-disabled_svg__a",width:17,height:17,x:0,y:0,maskUnits:"userSpaceOnUse",style:{maskType:"luminance"}},a.createElement("path",{fill:"#fff",d:"M17 0H0v17h17z"})),a.createElement("g",{mask:"url(#person-disabled_svg__a)"},a.createElement("path",{fill:"#94A1B2",d:"M6.801.85a3.4 3.4 0 1 0 0 6.8 3.4 3.4 0 0 0 0-6.8m0 1.7a1.7 1.7 0 1 1 0 3.4 1.7 1.7 0 0 1 0-3.4m0 5.95c-2.269 0-6.8 1.13-6.8 3.4v2.55h8.075a5.5 5.5 0 0 1-.4-1.615h-6.06V11.9c0-.544 2.661-1.785 5.185-1.785q.642.004 1.275.111a5.5 5.5 0 0 1 .892-1.479A11.4 11.4 0 0 0 6.801 8.5m6.375 0a3.825 3.825 0 1 0 3.825 3.825A3.81 3.81 0 0 0 13.176 8.5m0 1.275a2.547 2.547 0 0 1 2.55 2.55c.005.45-.119.893-.357 1.275l-3.468-3.468a2.35 2.35 0 0 1 1.275-.357m-2.193 1.275 3.468 3.468a2.36 2.36 0 0 1-1.275.357 2.547 2.547 0 0 1-2.55-2.55c-.005-.45.119-.893.357-1.275"}))),qt=a.forwardRef(Ht),Ft=({title:e,titleId:s,...i},h)=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:17,height:17,fill:"none",ref:h,"aria-labelledby":s,...i},e?a.createElement("title",{id:s},e):null,a.createElement("mask",{id:"envelop_svg__a",width:17,height:17,x:0,y:0,maskUnits:"userSpaceOnUse",style:{maskType:"luminance"}},a.createElement("path",{fill:"#fff",d:"M17 0H0v17h17z"})),a.createElement("g",{mask:"url(#envelop_svg__a)"},a.createElement("path",{fill:"#94A1B2",d:"M17.001 14.025h-3.4v2.55l-4.25-3.825 4.25-3.825v2.55h3.4zm-1.7-13.6h-13.6a1.7 1.7 0 0 0-1.7 1.7v10.2a1.7 1.7 0 0 0 1.7 1.7h5.95v-1.7h-5.95v-8.5l6.8 4.25 6.8-4.25v5.95h1.7v-7.65a1.7 1.7 0 0 0-1.7-1.7m-6.8 5.95-6.8-4.25h13.6z"}))),Qt=a.forwardRef(Ft),Jt=st(e=>({paper:{minHeight:"500px",maxWidth:"650px",minWidth:"340px",width:"100%"},customStepClass:{width:"100%"},dialogContent:{padding:e.spacing(2),overflow:"auto",display:"flex",flexDirection:"column",justifyContent:"space-between"},dialogActions:{padding:e.spacing(2)},cloudLogo:{height:"20px",width:"20px",marginRight:e.spacing(1),fill:e.palette.common.gray},cancelButton:{textTransform:"none"},info:{marginTop:"10px"}})),Kt=({stepInfo:e,permissions:s,checkedUsers:i,closeDialog:h,groups:p})=>{const j=Jt({stepInfo:e}),[w,C]=a.useState(!1),[x,k]=a.useState(!1),[n,m]=a.useState(!1),d=()=>{k(!1),h()};return t.jsxs(t.Fragment,{children:[t.jsxs(ae,{onClose:h,open:!0,classes:{paper:`${j.paper} ${j.customStepClass}`},children:[t.jsx(at,{onClose:h,hideTitleDivider:e.hideTitleDivider,children:t.jsxs(W,{display:"flex",children:[t.jsx(e.Icon,{className:j.cloudLogo,color:"disabled"}),t.jsx(_,{variant:"body1",noWrap:!0,children:e.label})]})}),t.jsxs(ne,{className:j.dialogContent,children:[t.jsx(a.Suspense,{fallback:t.jsx(nt,{children:t.jsx(lt,{})}),children:t.jsx(e.Component,{setLoading:k,handleNext:d,permissions:s,checkedUsers:i,onChangeUpdateAccessable:o=>m(o),groups:p})}),t.jsx(Xe,{severity:"info",className:j.info,children:"Your selection will override existing settings"})]}),t.jsxs(le,{className:j.dialogActions,children:[t.jsx(U,{id:"cancel-button",className:j.cancelButton,variant:"text",size:"small",disabled:x,onClick:h,children:"Cancel"}),t.jsx(U,{id:"ok-button",startIcon:x&&t.jsx(oe,{size:20}),disabled:x||!n,color:"primary",form:"wizard-form",type:"submit",size:"small",children:e.submitStepText})]})]}),t.jsx(ot,{confirmDialogOpen:w,closeConfirmDialog:()=>C(!1),confirmClose:()=>{h(),C(!1)}})]})},Xt=(e,s)=>{const i=a.useMemo(()=>e==null?void 0:e.filter(p=>s.includes(p._id)).every(p=>{var j;return((j=p.user)==null?void 0:j.status)===ye.PENDING}),[e,s]),h=a.useMemo(()=>e==null?void 0:e.filter(p=>s.includes(p._id)).every(p=>{var j;return((j=p.user)==null?void 0:j.status)===ye.ACTIVE}),[e,s]);return{isPendingOnly:i,isActiveOnly:h}};function Z(e){return Ye(B(`
      query UsersPermission($workspace_id: ID) {
        permissions(workspace_id: $workspace_id) {
          _id
          role
          user_id
          user_groups
          user {
            email
            status
            full_name
            two_factor_state
            status
          }
        }
      }
    `),{variables:{workspace_id:e}})}const $e=D("div").withConfig({displayName:"WorkspaceUsersPage__HeaderActions",componentId:"sc-w7jlbj-0"})(({theme:e,gap:s=1})=>({display:"flex",alignItems:"center",gap:e.spacing(s)})),Yt=D("div").withConfig({displayName:"WorkspaceUsersPage__DropdownItemContainer",componentId:"sc-w7jlbj-1"})(({theme:e,gap:s=1})=>({display:"flex",gap:e.spacing(s)})),X=({label:e,Icon:s,Svg:i,onClick:h})=>t.jsxs(Yt,{onClick:h,children:[i?t.jsx(i,{}):t.jsx("img",{src:s,alt:"DropDown Icon"}),t.jsx(_,{children:e})]}),Zt=D(it).withConfig({displayName:"WorkspaceUsersPage__RemoveCircleOutlineOutlinedIcon",componentId:"sc-w7jlbj-2"})(({theme:e})=>({color:e.palette.common.gray})),es=D(ct).withConfig({displayName:"WorkspaceUsersPage__EditIcon",componentId:"sc-w7jlbj-3"})(({theme:e})=>({color:e.palette.common.gray}));function ts({location:e}){const[s,i]=a.useState([]),[h,p]=a.useState([]),{workspaceId:j}=V(),w=rt(j),{data:{usersGroups:C=[]}={}}=Ne(j),[x,k]=a.useState([]),[n,m,d]=Ge("",1e3),{data:{permissions:o=[]}={},loading:S,error:y}=Z(j),u=a.useMemo(()=>C.reduce((c,b)=>(c[b==null?void 0:b._id]=b==null?void 0:b.name,c),{}),[C]),{isPendingOnly:A,isActiveOnly:N}=Xt(o,x);a.useEffect(()=>{var c;(c=e.state)!=null&&c.inviteUsers&&i(me)},[e]);const M=a.useCallback(c=>{m(c.target.value)},[m]),l=()=>{m("")},g=a.useMemo(()=>n?o.filter(c=>{var L,P,T,H,he;const b=((L=c==null?void 0:c.user_groups)==null?void 0:L.length)>0,I=b&&c.user_groups.find($=>$===w);let r=!1;return I?r=C==null?void 0:C.some(({name:$})=>$==null?void 0:$.toLowerCase().includes(n)):b&&(r=c==null?void 0:c.user_groups.find($=>{var xe;return(xe=u[$])==null?void 0:xe.includes(n)})),r||((T=(P=c==null?void 0:c.user)==null?void 0:P.full_name)==null?void 0:T.includes(n))||((he=(H=c==null?void 0:c.user)==null?void 0:H.email)==null?void 0:he.includes(n))}):o,[o,n,u,C,w]),G=a.useMemo(()=>o.filter(c=>x.includes(c._id)),[o,x]),f=c=>{switch(c){case K:return t.jsx(X,{onClick:()=>{i(F(K).steps(G))},Icon:Qt,label:K});case J:return t.jsx(X,{Svg:Zt,label:J,onClick:()=>i(F(J).steps(G))});case Q:return t.jsx(X,{onClick:()=>p(F(Q).steps(G)),Svg:es,label:Q});case q:return t.jsx(X,{onClick:()=>i(F(q).steps(G)),Icon:qt,label:q});default:return"Actions"}},v=a.useMemo(()=>{const c=[K,J],b=[q],I=[Q];return A?[...c,...I]:N?[...b,...I]:I},[A,N]);return t.jsxs(W,{display:"flex",overflow:"auto",flexDirection:"column",flexGrow:1,children:[t.jsx(Te,{showWorkspace:!0,Icon:Le,title:`Users ${o!=null&&o.length?` (${o.length})`:""}`,actions:t.jsxs($e,{children:[t.jsx(O,{placeholder:"Search Users/ Email / Groups",variant:"outlined",value:d,size:"small",style:{width:223},onChange:M,InputProps:{style:{borderRadius:6},startAdornment:t.jsx(ie,{fontSize:"small",color:"action"}),endAdornment:t.jsx(dt,{position:"end",children:d&&t.jsx(se,{size:"small",onClick:l,children:t.jsx(ut,{fontSize:"small"})})})}}),t.jsx(Bt,{placeholder:"Actions",disabled:x.length===0,options:v,getOptionLabel:f}),t.jsx(Pt,{startIcon:t.jsx(ht,{fontSize:"large",color:"action"}),onClick:()=>i(me),children:"Invite user"})]})}),t.jsx(W,{p:3,flexGrow:1,overflow:"auto",children:t.jsx(xt,{loading:S,error:y,permissions:g,openWizard:c=>i(c),checkedUsers:x,setCheckedUsers:k})}),s&&t.jsx(ft,{stepsInfo:s,closeDialog:c=>{c!=="backdropClick"&&i(!1)},dialogOpen:!0}),(h==null?void 0:h.length)>0&&h[0].label===pt.label&&t.jsx(Kt,{stepInfo:{...h[0],optionalInfo:[h[0].optionalInfo]},permissions:o,checkedUsers:x,closeDialog:()=>p(!1),groups:C,dialogOpen:!0})]})}function ze(){return Y(B(`
        mutation EditUsersGroup(
          $id: ID
          $input: UserGroupInput
          
        ) {
          editGroup(id: $id, group: $input)
        }
      `),{update(e){e.evict({fieldName:"usersGroups"})}})}function ss(){return Y(B(`
        mutation DeleteUsersGroup(
          $id: ID
        ) {
          deleteGroup(id: $id)
        }
      `),{update(e){e.evict({fieldName:"usersGroups"})}})}function as(){return Y(B(`
  mutation CreateUsersGroup($input: UserGroupInput) {
    createGroup(group: $input) {
      _id
    }
  }
`),{update(e){e.evict({fieldName:"usersGroups"})}})}function Oe(){const e=new Date,s={year:"numeric",month:"short",day:"2-digit"};return e.toLocaleDateString("en-US",s)}var de={},ns=gt,ls=yt;Object.defineProperty(de,"__esModule",{value:!0});var ue=de.default=void 0,os=ls(a),is=ns(jt()),cs=(0,is.default)(os.createElement("path",{d:"M8 10H5V7H3v3H0v2h3v3h2v-3h3v-2zm10 1c1.66 0 2.99-1.34 2.99-3S19.66 5 18 5c-.32 0-.63.05-.91.14.57.81.9 1.79.9 2.86s-.34 2.04-.9 2.86c.28.09.59.14.91.14zm-5 0c1.66 0 2.99-1.34 2.99-3S14.66 5 13 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm6.62 2.16c.83.73 1.38 1.66 1.38 2.84v2h3v-2c0-1.54-2.37-2.49-4.38-2.84zM13 13c-2 0-6 1-6 3v2h12v-2c0-2-4-3-6-3z"}),"GroupAdd");ue=de.default=cs;function We({onClose:e,group:s}){const{workspaceId:i}=V(),{description:h,name:p}=s||{description:"",tags:[],name:""},[j,{loading:w}]=as(),[C,{loading:x}]=ze(),[k,n]=a.useState(p),[m,d]=a.useState(h),[o]=Re(),S=Me(),[y,u]=a.useState((s==null?void 0:s.accounts)||[]),[A,N]=a.useState(""),M=De(),l=a.useMemo(()=>y!=null&&y.length?y[0]===z:!1,[y]),g=a.useMemo(()=>o==null?void 0:o.filter(({display_name:r,cloud_account_id:L})=>(r==null?void 0:r.toLowerCase().includes(A))||(L==null?void 0:L.toLowerCase().includes(A))),[o,A]),G=async r=>{var P;r.preventDefault();const L={name:k,description:m,last_modified_by:S==null?void 0:S.display_name,last_modified_time:Oe(),accounts:l?[z]:y,workspace_id:i};try{if(s)await C({variables:{id:s._id,input:L}});else{const{data:T}=await j({variables:{input:{...L,is_default:!1}}}),H=((P=T==null?void 0:T.createGroup)==null?void 0:P._id)??void 0;e(H,k||"")}}catch(T){M(T.message,"error");return}e()},f=r=>{u(r===z?[r]:[])},v=a.useCallback(r=>{N(r.target.value)},[]),c=(r,L)=>{u(r?[...y||[],L]:(y==null?void 0:y.filter(P=>P!==L))??[])},b=()=>{u([])},I=()=>{u((o==null?void 0:o.map(({cloud_account_id:r})=>r).filter(r=>r!=null))??null)};return t.jsxs(ae,{fullWidth:!0,open:!0,style:{marginLeft:"auto",marginRight:"auto",minWidth:660},onClose:()=>e(),children:[t.jsx(ne,{children:t.jsxs(E,{gap:2,children:[t.jsxs(R,{gap:2,style:{alignItems:"center"},children:[t.jsx(ue,{color:"action"}),t.jsx(_,{variant:"subtitle2",style:{textAlign:"left"},children:s?`Edit Group ${s==null?void 0:s.name}`:"Create New Access Group"}),t.jsx(se,{edge:"end",style:{marginLeft:"auto",marginRight:0},color:"inherit",onClick:()=>e(),"aria-label":"close",children:t.jsx(Ee,{color:"action"})})]}),t.jsx(_,{variant:"h4",children:"Group Details"}),t.jsx(_,{variant:"subtitle2",children:"Add the name and description of the Access Group"}),t.jsx(O,{autoFocus:!0,variant:"outlined",placeholder:"Access Group name",fullWidth:!0,value:k,onChange:r=>n(r.target.value)}),t.jsx(O,{variant:"outlined",placeholder:"Group Description (optional)",fullWidth:!0,value:m,onChange:r=>d(r.target.value)}),t.jsx(ce,{}),t.jsx(_,{variant:"h4",children:"Cloud Account Access"}),t.jsx(Ct,{component:"fieldset",children:t.jsxs(_t,{"aria-label":"options",style:{flexDirection:"row"},name:"options",value:l?z:"specific",onChange:(r,L)=>f(L),children:[t.jsx(ve,{value:z,control:t.jsx(Ce,{color:"primary"}),label:`All Accounts (${o==null?void 0:o.length})`}),t.jsx(ve,{value:"specific",control:t.jsx(Ce,{color:"primary"}),label:`Specific ${l?"":`(${(y==null?void 0:y.length)||0})`}`})]})}),!l&&t.jsx(O,{placeholder:"Search Accounts",variant:"outlined",value:A,onChange:v,InputProps:{style:{borderRadius:6},startAdornment:t.jsx(ie,{fontSize:"small",color:"action"})}}),!l&&t.jsxs(E,{children:[t.jsx(Be,{selected:y,handleClearAll:b,handleSelectAll:I}),t.jsx(ds,{children:g==null?void 0:g.map(r=>t.jsx(rs,{className:"account-row",children:t.jsxs(wt,{children:[t.jsx(Pe,{color:"primary",checked:y==null?void 0:y.some(L=>L===(r==null?void 0:r.cloud_account_id)),onClick:L=>L.stopPropagation(),onChange:(L,P)=>c(P,r==null?void 0:r.cloud_account_id),inputProps:{"aria-label":"primary checkbox"}}),t.jsx(St,{width:"16",height:"16"}),t.jsxs(E,{children:[t.jsx(_,{children:r==null?void 0:r.display_name}),t.jsx(_,{color:"textSecondary",children:r==null?void 0:r.cloud_account_id})]})]})},r==null?void 0:r.cloud_account_id))})]})]})}),t.jsxs(le,{children:[t.jsx(U,{variant:"text",onClick:()=>e(),children:"Cancel"}),t.jsx(U,{onClick:G,startIcon:(w||x)&&t.jsx(oe,{size:20}),color:"primary",autoFocus:!0,children:s?"Save":"Create & Assign Members"})]})]})}const rs=D(mt).withConfig({displayName:"UsersGroupModal__StyledAccountRow",componentId:"sc-rli04x-0"})(["height:48px;"]),ds=D(vt).withConfig({displayName:"UsersGroupModal__StyledAccountList",componentId:"sc-rli04x-1"})(["border:1px solid ",";border-radius:6px;padding:","px;.account-row:nth-child(even){background-color:",";}"],e=>e.theme.palette.dividerLight,e=>e.theme.spacing(1),e=>e.theme.palette.dividerLight),Be=({selected:e,handleClearAll:s,handleSelectAll:i})=>t.jsxs(R,{style:{alignItems:"center"},children:[(e==null?void 0:e.length)>0&&t.jsxs(_,{children:[e==null?void 0:e.length," Selected"]}),t.jsx(U,{variant:"text",size:"small",style:{marginLeft:"auto"},onClick:s,children:"Clear"}),t.jsx(ce,{flexItem:!0,orientation:"vertical",variant:"middle"}),t.jsx(U,{color:"primary",variant:"text",size:"small",onClick:i,children:"Select all"})]});function us({permissions:e,members:s,addMember:i,removeMember:h,handleClearAll:p,handleSelectAll:j}){const[w,C]=a.useState([]),x=a.useMemo(()=>{const n=(o,S)=>{var A,N,M,l;const y=((A=o==null?void 0:o.user)==null?void 0:A.full_name)||((N=o==null?void 0:o.user)==null?void 0:N.email),u=((M=S==null?void 0:S.user)==null?void 0:M.full_name)||((l=S==null?void 0:S.user)==null?void 0:l.email);return y<u?-1:y>u?1:0},m=e==null?void 0:e.filter(o=>s==null?void 0:s.some(S=>S===(o==null?void 0:o._id))).sort(n),d=e==null?void 0:e.filter(o=>s==null?void 0:s.every(S=>S!==(o==null?void 0:o._id))).sort(n);return[...m,...d]},[]),k=(n,m)=>{n?i(m):h(m),C([...w,m])};return t.jsxs(E,{children:[t.jsx(Be,{selected:s,handleClearAll:p,handleSelectAll:j}),(e==null?void 0:e.length)>0&&t.jsx(xs,{gap:1,children:x==null?void 0:x.map(n=>{var m,d,o,S;return t.jsxs(hs,{className:"member-item",children:[t.jsx(Pe,{color:"primary",checked:s==null?void 0:s.some(y=>y===(n==null?void 0:n._id)),onClick:y=>y.stopPropagation(),onChange:(y,u)=>k(u,n==null?void 0:n._id),disabled:(n==null?void 0:n.role)===te.Superuser}),((m=n==null?void 0:n.user)==null?void 0:m.full_name)&&t.jsx(re,{icon:t.jsx(Ut,{name:Ue((d=n==null?void 0:n.user)==null?void 0:d.full_name)})}),t.jsxs(E,{children:[t.jsx(_,{children:(o=n==null?void 0:n.user)==null?void 0:o.full_name}),t.jsx(_,{color:"textSecondary",children:(S=n==null?void 0:n.user)==null?void 0:S.email})]})]},n==null?void 0:n._id)})})]})}const hs=D(R).withConfig({displayName:"MembersList__MemberItem",componentId:"sc-r3rfam-0"})(["height:45px;padding:","px;align-items:center;"],e=>e.theme.spacing(1)),xs=D(E).withConfig({displayName:"MembersList__MembersListContainer",componentId:"sc-r3rfam-1"})(["border:solid 1px ",";border-radius:6px;padding:","px;.member-item:nth-child(even){background-color:",";}"],e=>e.theme.palette.dividerLight,e=>e.theme.spacing(1),e=>e.theme.palette.dividerLight);function Ve(e){const{isOpen:s,onClose:i,group:h={}}=e,{_id:p,name:j,is_admin:w}=h,[C,x]=a.useState([]),[k,n]=a.useState(""),{workspaceId:m}=V(),{data:{permissions:d=[]}={}}=Z(m),o=a.useMemo(()=>d==null?void 0:d.filter(f=>{var v,c,b,I;return(w||(f==null?void 0:f.role)!==te.Superuser)&&(!k||((c=(v=f==null?void 0:f.user)==null?void 0:v.full_name)==null?void 0:c.toLowerCase().includes(k))||((I=(b=f==null?void 0:f.user)==null?void 0:b.email)==null?void 0:I.toLowerCase().includes(k)))}),[d,k,w]),[S,{loading:y}]=Y(B(`
      mutation updatePermissions($input: UpdatePermissionsInput) {
        updatePermissions(input: $input)
      }
    `),{update(f){f.evict({fieldName:"permissions"})}}),u=a.useMemo(()=>d==null?void 0:d.filter(f=>{var v;return((v=f==null?void 0:f.user_groups)==null?void 0:v.includes(p||""))??!1}),[d,p]);a.useEffect(()=>{x((u==null?void 0:u.filter(Boolean).map(f=>(f==null?void 0:f._id)??""))??[])},[u,p]);const A=f=>{x(v=>[...v,f])},N=f=>{x(v=>v.filter(c=>c!==f))},M=()=>{x(C.filter(f=>{const v=d==null?void 0:d.find(c=>(c==null?void 0:c._id)===f);return(v==null?void 0:v.role)===te.Superuser}))},l=()=>{x((o??[]).filter(Boolean).map(f=>(f==null?void 0:f._id)??""))},g=a.useMemo(()=>{const f=[];return(u??[]).forEach(v=>{C.every(b=>b!==(v==null?void 0:v._id))&&v&&v.user_groups&&f.push({permission_id:v._id,role:v.role??void 0,user_groups:v.user_groups.filter(b=>b!==null&&b!==p)})}),C.forEach(v=>{var b;if((u??[]).every(I=>(I==null?void 0:I._id)!==v)){const I=d==null?void 0:d.find(r=>(r==null?void 0:r._id)===v);f.push({permission_id:I==null?void 0:I._id,role:(I==null?void 0:I.role)??void 0,user_groups:[...((b=I==null?void 0:I.user_groups)==null?void 0:b.filter(r=>typeof r=="string"))??[],p??""]})}}),f},[C,u,d,p]),G=async()=>{await S({variables:{input:{permissions:g}}}),i()};return t.jsxs(ae,{fullWidth:!0,open:s,style:{marginLeft:"auto",marginRight:"auto",minWidth:660},onClose:()=>i(!1),children:[t.jsx(ne,{children:t.jsxs(E,{gap:2,children:[t.jsxs(E,{gap:2,children:[t.jsxs(R,{gap:2,style:{alignItems:"center"},children:[t.jsx(ue,{color:"action"}),t.jsxs(_,{variant:"subtitle2",style:{textAlign:"left"},children:["Manage Access ",j]}),t.jsx(se,{edge:"end",style:{marginLeft:"auto",marginRight:0},color:"inherit",onClick:()=>i(),"aria-label":"close",children:t.jsx(Ee,{color:"action"})})]}),t.jsx(_,{variant:"h4",children:"Groups Membership"}),t.jsx(O,{onChange:f=>n(f.target.value),value:k,label:"Search by Name or Email",variant:"outlined"})]}),t.jsx(us,{members:C.filter(Boolean),permissions:o,addMember:A,removeMember:N,handleClearAll:M,handleSelectAll:l})]})}),t.jsxs(le,{children:[t.jsx(U,{variant:"text",onClick:()=>i(),children:"Cancel"}),t.jsx(U,{startIcon:y&&t.jsx(oe,{size:20}),onClick:G,color:"primary",autoFocus:!0,children:"Save Changes"})]})]})}function fs({group:e}){var M;const[s,i]=a.useState(!1),[h,p]=a.useState(!1),[j]=ze(),[w]=ss(),{workspaceId:C}=V(),x=kt(),k=De(),n=Me(),{data:{permissions:m=[]}={}}=Z(C),d=a.useMemo(()=>{var l;return(l=m==null?void 0:m.find(g=>(g==null?void 0:g.user_id)===(e==null?void 0:e.last_modified_by)))==null?void 0:l.user},[m,e]),o=a.useMemo(()=>{var l;return((e==null?void 0:e.accounts)??[]).length>0&&((l=e==null?void 0:e.accounts)==null?void 0:l[0])===z},[e]),S=a.useMemo(()=>{var l;return(l=(m??[]).filter(g=>{var G;return(G=g==null?void 0:g.user_groups)==null?void 0:G.includes((e==null?void 0:e._id)??"")}))==null?void 0:l.length},[m,e]),y=a.useMemo(()=>[{..._e,disabled:!!e.is_admin},we,{...Se,disabled:!!e.is_default}],[e]),u=a.useCallback(async l=>{const{_id:g,...G}=e;switch(l==null?void 0:l.label){case Se.label:if(!await x.confirm({title:t.jsxs(R,{gap:1,style:{alignItems:"center"},children:[t.jsx(bt,{color:"action"}),t.jsx(_,{children:"Set Default Access Group"})]}),text:t.jsxs(E,{style:{width:300},children:[t.jsx(_,{children:"The default Access Group will be set to:"}),t.jsx(_,{children:`"${e.name}"`}),t.jsx(_,{children:"Newly invited users and users who sign in via SSO will be affected by this action."})]}),confirmText:"Set as Default",declineText:"Cancel",origin:"bottom"}))return;await j({variables:{id:e==null?void 0:e._id,input:{...G,is_default:!0,last_modified_time:Oe(),last_modified_by:n==null?void 0:n.display_name}}}),k("Default Group changed successfully","success");break;case _e.label:i(!0);break;case we.label:p(!0);break}},[j,e,x,k,n]),A=a.useCallback(async l=>{await x.confirm({title:t.jsxs(R,{gap:1,style:{alignItems:"center"},children:[t.jsx(ke,{}),t.jsx(_,{children:"Delete Access Group"})]}),inputText:{disabled:!0},text:t.jsx(E,{style:{width:300},children:t.jsxs(_,{children:["The Access Group ",`"${e.name}"`," will be removed."]})}),confirmText:"Delete Access Group",declineText:"Cancel",origin:"bottom"})&&(await w({variables:{id:e==null?void 0:e._id}}),k("Group Deleted Successfully","success"))},[e,w,x,k]),N=a.useMemo(()=>!!(S>0||e.is_default),[S,e.is_default]);return t.jsxs(gs,{gap:2,children:[t.jsxs(R,{style:{justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(R,{gap:1,style:{alignItems:"center"},children:[t.jsx(It,{color:"action"}),t.jsx(_,{variant:"h4",children:e.name})]}),t.jsxs(R,{style:{alignItems:"center"},children:[(e==null?void 0:e.is_default)&&t.jsx(js,{children:"Default"}),t.jsxs(R,{className:"group-actions",children:[!(e!=null&&e.is_admin)&&t.jsx(be,{placement:"top",title:S>0?"Remove all members to enable this option":e.is_default?"This option unavailable for Default Access Group":"",children:t.jsx("div",{children:t.jsx(Ie,{onClick:A,disabled:N,children:t.jsx(ke,{fontSize:"small"})})})}),t.jsx(At,{disablePropagation:!0,triggerComponent:l=>t.jsx(Ie,{size:"small",className:"menu-button",...l,children:t.jsx(Gt,{fontSize:"small"})}),options:y,onClickOptions:l=>{u(l)}})]})]})]}),t.jsx(ps,{children:e==null?void 0:e.description}),t.jsxs(R,{children:[t.jsx(E,{gap:1,style:{alignItems:"start",width:"50%"},children:t.jsxs(R,{gap:1,children:[t.jsx(Mt,{size:"small",type:"Account",disableTooltip:!0}),o?t.jsx(_,{color:"textSecondary",children:"All accounts"}):t.jsx(_,{children:(M=e.accounts)==null?void 0:M.length})]})}),t.jsx(ce,{light:!0,flexItem:!0,orientation:"vertical",variant:"middle"}),t.jsxs(E,{gap:1,style:{alignItems:"start",marginLeft:12},children:[t.jsxs(R,{style:{alignItems:"center"},children:[t.jsx(Dt,{color:"action"}),t.jsx(_,{children:S})]}),d&&t.jsx(re,{icon:t.jsx(be,{title:t.jsxs(E,{children:[t.jsx(_,{color:"textSecondary",children:"Last modify by"}),t.jsx(_,{children:d==null?void 0:d.full_name}),t.jsx(_,{children:d==null?void 0:d.email})]}),children:t.jsx(Tt,{children:Ue(d==null?void 0:d.full_name)})}),label:e==null?void 0:e.last_modified_time})]})]}),s&&t.jsx(We,{group:e,onClose:()=>i(!1)}),t.jsx(Ve,{group:e,onClose:()=>p(!1),isOpen:h})]})}const ps=D(_).withConfig({displayName:"UsersGroup__Description",componentId:"sc-cyscgn-0"})(["width:290px;height:34px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;white-space:normal;text-overflow:ellipsis;"]),js=D(_).withConfig({displayName:"UsersGroup__DefaultLabel",componentId:"sc-cyscgn-1"})(["background-color:",";border-radius:100px;padding:0px 9px;color:",";font-size:10px;height:18px;line-height:18px;"],e=>e.theme.palette.common.black,e=>e.theme.palette.common.white),gs=D(E).withConfig({displayName:"UsersGroup__GroupCard",componentId:"sc-cyscgn-2"})(["border-radius:6px;background-color:",";border-radius:","px;padding:","px;border:1px solid transparent;width:314px;margin-bottom:","px;.group-actions{visibility:hidden;}&:hover{border:1px solid ",";.group-actions{visibility:visible;}}.MuiButtonBase-root.Mui-disabled{}"],e=>e.theme.palette.background.paper,e=>e.theme.shape.borderRadius,e=>e.theme.spacing(2),e=>e.theme.spacing(2),e=>e.theme.palette.divider),ys=()=>{const{workspaceId:e}=V(),{data:{usersGroups:s=[]}={}}=Ne(e),[i,h]=a.useState(!1),[p,j]=a.useState(void 0),[w]=Re(),{data:{permissions:C=[]}={}}=Z(e),[x,k,n]=Ge("",500),m=a.useMemo(()=>(s??[]).map(u=>{const A=((u==null?void 0:u.accounts)||[]).reduce((M,l)=>{const g=w==null?void 0:w.find(({cloud_account_id:G})=>G===l);return g!=null&&g.display_name&&M.push(g.display_name),M},[]),N=(C??[]).reduce((M,l)=>{var g,G,f,v,c;return(g=l==null?void 0:l.user_groups)!=null&&g.includes((u==null?void 0:u._id)??"")&&((G=l==null?void 0:l.user)!=null&&G.full_name||(f=l==null?void 0:l.user)!=null&&f.email)&&M.push({name:(v=l==null?void 0:l.user)==null?void 0:v.full_name,email:(c=l==null?void 0:l.user)==null?void 0:c.email}),M},[]);return{...u,accountNames:A,members:N}}),[s,w,C]),d=a.useMemo(()=>x?m.filter(u=>{var A,N,M,l;return((A=u==null?void 0:u.name)==null?void 0:A.toLowerCase().includes(x==null?void 0:x.toLowerCase()))||((N=u.accountNames)==null?void 0:N.some(g=>g==null?void 0:g.includes(x)))||((M=u.members)==null?void 0:M.some(({name:g,email:G})=>(g==null?void 0:g.includes(x))||(G==null?void 0:G.includes(x))))||((l=u.accounts)==null?void 0:l.some(g=>g==null?void 0:g.includes(x)))}):m,[x,m]),o=a.useCallback(()=>{h(!0)},[]),S=a.useCallback(u=>{k(u.target.value)},[k]),y=(u,A)=>{h(!1),u&&j({_id:u,name:A})};return t.jsxs(W,{display:"flex",flexDirection:"column",height:"100%",children:[t.jsx(Te,{title:`${d==null?void 0:d.length} Groups`,actions:t.jsxs($e,{children:[t.jsx(O,{placeholder:"Search Group / Account / Member",variant:"outlined",value:n,size:"small",style:{width:308},onChange:S,InputProps:{style:{borderRadius:6},startAdornment:t.jsx(ie,{fontSize:"small",color:"action"})}}),t.jsx(U,{startIcon:t.jsx(Nt,{fontSize:"large",color:"action"}),variant:"text",onClick:o,children:"New"})]})}),t.jsx(W,{p:3,flexGrow:1,overflow:"auto",children:t.jsx(ms,{children:d==null?void 0:d.map(({accountNames:u,members:A,...N})=>t.jsx(fs,{group:N},N._id))})}),i&&t.jsx(We,{onClose:y}),p&&t.jsx(Ve,{group:p,onClose:()=>j(void 0),isOpen:!!(p!=null&&p._id)})]})},ms=D.div.withConfig({displayName:"UsersGroupsPage__GroupsContainer",componentId:"sc-1bkk372-0"})(["display:grid;grid-template-columns:repeat(auto-fill,minmax(314px,1fr));grid-gap:","px;width:100%;max-width:1300px;margin:0px auto;margin-bottom:40px;"],e=>e.theme.spacing(1)),bs=()=>{const{path:e}=ee(),[s,i]=Wt("users");return t.jsxs(vs,{style:{height:"100%"},children:[t.jsx(Lt,{paper:!0,title:t.jsxs(R,{gap:1,style:{alignItems:"center",marginRight:"12px"},children:[t.jsx(re,{style:{marginRight:"12px"},icon:t.jsx(Le,{color:"action"}),label:"Users and access",labelVariant:"h5"}),t.jsxs(Rt,{value:s,onChange:(h,p)=>i(p),children:[t.jsx(Ae,{value:"users",label:"Users"}),t.jsx(Ae,{value:"groups",label:"Access Groups"})]})]})}),t.jsxs(Ze,{children:[t.jsx(pe,{exact:!0,path:[e,`${e}/users`],component:ts}),t.jsx(pe,{path:`${e}/groups`,component:ys})]})]})},Is=D(Et).withConfig({displayName:"WorkspaceSettingsPage__HeaderLink",componentId:"sc-4j1pkf-0"})(({theme:e})=>({display:"flex",alignItems:"center"})),As=D(Ot).withConfig({displayName:"WorkspaceSettingsPage__Card",componentId:"sc-4j1pkf-1"})(({theme:e})=>({cursor:"pointer",padding:e.spacing(2),display:"flex",justifyContent:"center",alignItems:"center",height:e.spacing(11)})),Gs=D(_).withConfig({displayName:"WorkspaceSettingsPage__CardText",componentId:"sc-4j1pkf-2"})(({theme:e})=>({alignSelf:"center"})),Ms=D.div.withConfig({displayName:"WorkspaceSettingsPage__Scrollable",componentId:"sc-4j1pkf-3"})(["height:100%;overflow:auto;"]),vs=D(E).withConfig({displayName:"WorkspaceSettingsPage__LayoutColumnWrapper",componentId:"sc-4j1pkf-4"})(["overflow:unset;"]),Ds=D(R).withConfig({displayName:"WorkspaceSettingsPage__LayoutRowWrapper",componentId:"sc-4j1pkf-5"})(["overflow:unset;"]),Ns=D.div.withConfig({displayName:"WorkspaceSettingsPage__EmptyState",componentId:"sc-4j1pkf-6"})(["margin-top:20%;display:flex;flex-direction:column;justify-content:center;align-items:center;color:",";"],e=>e.theme.palette.primary.contrastText);export{As as Card,Gs as CardText,Ns as EmptyState,Is as HeaderLink,vs as LayoutColumnWrapper,Ds as LayoutRowWrapper,Ms as Scrollable,bs as default};
