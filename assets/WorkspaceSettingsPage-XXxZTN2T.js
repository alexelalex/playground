import{w as He,r as a,_ as qe,al as Fe,K as Ye,M as Je,h as ee,c as Ke,j as t,q as D,o as pe,U as Qe,a as Ze,f as B,e as V,V as Ge,I as se,k as Me,d as De,ap as te,S as Xe,i as fe}from"./index-lG--m1G-.js";import{d as _,bD as et,bY as tt,M as je,bZ as ge,m as st,bq as ae,br as at,x as W,bs as ne,q as nt,r as lt,bt as le,p as U,C as oe,bu as ot,bw as ye,eg as it,eh as Ne,ei as ve,ej as q,ek as F,el as Y,em as J,bx as Ee,T as O,ec as ct,ed as rt,by as ie,bG as dt,en as ut,J as ht,eo as xt,ep as K,eq as pt,er as ft,i as Z,es as jt,et as gt,eu as yt,bo as Le,ev as $,L as R,b as L,bg as Re,n as ce,F as vt,cj as mt,ck as me,cl as Ce,ew as Ct,y as Pe,ex as _t,ey as wt,ez as St,aw as re,V as Ue,cF as bt,eA as _e,eB as we,eC as Se,eD as kt,D as be,eE as It,ae as ke,I as Ie,bz as At,b$ as Gt,R as Mt,aB as Dt,e1 as Nt,o as Et,h as Lt,N as Rt,O as Ae}from"./App-DEb2AZmf.js";import{H as Te}from"./Header-Xy3QA87U.js";import{A as Pt}from"./AddIntegrationTooltip-Vjc9WazQ.js";import{C as Ut,A as Tt}from"./CreatedByAvatar-BPGFYrsx.js";var zt={root:{overflow:"hidden"}},$t=a.forwardRef(function(s,i){var h=s.classes,f=s.className,j=s.raised,w=j===void 0?!1:j,C=qe(s,["classes","className","raised"]);return a.createElement(Fe,Ye({className:Je(h.root,f),elevation:w?8:1,ref:i},C))});const Ot=He(zt,{name:"MuiCard"})($t);function Wt(e){const{url:s}=ee(),i=Ke(),h=ee(`${s}/:section`),f=a.useCallback(j=>{i.replace(`${s}/${j}`)},[i,s]);return[(h==null?void 0:h.params.section)||e,f]}const Bt=({value:e,onChange:s=w=>w,options:i,getOptionLabel:h=w=>w,placeholder:f,disabled:j})=>{const[w,C]=a.useState(!1),x=a.useRef(null),b=a.useCallback(n=>{C(!1),s(n)},[s]);return t.jsxs(t.Fragment,{children:[t.jsxs(Vt,{ref:x,disabled:j,defaultChecked:e==null,open:w,onClick:()=>!j&&C(!0),children:[e==null?t.jsx("span",{style:{fontSize:12},children:f}):t.jsx(_,{variant:"body2",className:"value",children:h(e)}),t.jsx(et,{fontSize:"small"})]}),t.jsxs(tt,{open:w,anchorEl:x==null?void 0:x.current,anchorOrigin:{vertical:"bottom",horizontal:"left"},onClose:()=>C(!1),children:[e!==void 0&&t.jsx(je,{selected:e===null,onClick:()=>b(null),children:t.jsx(ge,{secondary:f})}),i==null?void 0:i.map((n,v)=>t.jsx(je,{selected:e===n,onClick:()=>b(n),children:t.jsx(ge,{primary:h(n)})},v))]})]})},Vt=D.div.withConfig({displayName:"DropDown__SelectorBox",componentId:"sc-1nacvcl-0"})(({theme:e,open:s,defaultChecked:i,disabled:h})=>({display:"flex",alignItems:"center",height:28,borderRadius:e.shape.borderRadius*1.5,padding:`${e.spacing(.7)}px ${e.spacing(2)}px`,cursor:"pointer",".value":{color:"inherit"},...!h&&{"&:hover":{background:e.palette.primary.main,color:e.palette.primary.contrastText}},...s&&{background:e.palette.primary.main,color:e.palette.primary.contrastText},...i&&!s&&{color:e.palette.common.gray,border:`1px solid ${e.palette.common.gray}`},...!i&&!s&&{border:`1px solid ${e.palette.primary.main}`,color:e.palette.primary.main},...h&&{color:pe(e.palette.text.secondary,.1),borderColor:pe(e.palette.text.secondary,.1),cursor:"default"}})),Ht=({title:e,titleId:s,...i},h)=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:17,height:17,fill:"none",ref:h,"aria-labelledby":s,...i},e?a.createElement("title",{id:s},e):null,a.createElement("mask",{id:"person-disabled_svg__a",width:17,height:17,x:0,y:0,maskUnits:"userSpaceOnUse",style:{maskType:"luminance"}},a.createElement("path",{fill:"#fff",d:"M17 0H0v17h17z"})),a.createElement("g",{mask:"url(#person-disabled_svg__a)"},a.createElement("path",{fill:"#94A1B2",d:"M6.801.85a3.4 3.4 0 1 0 0 6.8 3.4 3.4 0 0 0 0-6.8m0 1.7a1.7 1.7 0 1 1 0 3.4 1.7 1.7 0 0 1 0-3.4m0 5.95c-2.269 0-6.8 1.13-6.8 3.4v2.55h8.075a5.5 5.5 0 0 1-.4-1.615h-6.06V11.9c0-.544 2.661-1.785 5.185-1.785q.642.004 1.275.111a5.5 5.5 0 0 1 .892-1.479A11.4 11.4 0 0 0 6.801 8.5m6.375 0a3.825 3.825 0 1 0 3.825 3.825A3.81 3.81 0 0 0 13.176 8.5m0 1.275a2.547 2.547 0 0 1 2.55 2.55c.005.45-.119.893-.357 1.275l-3.468-3.468a2.35 2.35 0 0 1 1.275-.357m-2.193 1.275 3.468 3.468a2.36 2.36 0 0 1-1.275.357 2.547 2.547 0 0 1-2.55-2.55c-.005-.45.119-.893.357-1.275"}))),qt=a.forwardRef(Ht),Ft=({title:e,titleId:s,...i},h)=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:17,height:17,fill:"none",ref:h,"aria-labelledby":s,...i},e?a.createElement("title",{id:s},e):null,a.createElement("mask",{id:"envelop_svg__a",width:17,height:17,x:0,y:0,maskUnits:"userSpaceOnUse",style:{maskType:"luminance"}},a.createElement("path",{fill:"#fff",d:"M17 0H0v17h17z"})),a.createElement("g",{mask:"url(#envelop_svg__a)"},a.createElement("path",{fill:"#94A1B2",d:"M17.001 14.025h-3.4v2.55l-4.25-3.825 4.25-3.825v2.55h3.4zm-1.7-13.6h-13.6a1.7 1.7 0 0 0-1.7 1.7v10.2a1.7 1.7 0 0 0 1.7 1.7h5.95v-1.7h-5.95v-8.5l6.8 4.25 6.8-4.25v5.95h1.7v-7.65a1.7 1.7 0 0 0-1.7-1.7m-6.8 5.95-6.8-4.25h13.6z"}))),Yt=a.forwardRef(Ft),Jt=st(e=>({paper:{minHeight:"500px",maxWidth:"650px",minWidth:"340px",width:"100%"},customStepClass:{width:"100%"},dialogContent:{padding:e.spacing(2),overflow:"auto",display:"flex",flexDirection:"column",justifyContent:"space-between"},dialogActions:{padding:e.spacing(2)},cloudLogo:{height:"20px",width:"20px",marginRight:e.spacing(1),fill:e.palette.common.gray},cancelButton:{textTransform:"none"},info:{marginTop:"10px"}})),Kt=({stepInfo:e,permissions:s,checkedUsers:i,closeDialog:h,groups:f})=>{const j=Jt({stepInfo:e}),[w,C]=a.useState(!1),[x,b]=a.useState(!1),[n,v]=a.useState(!1),d=()=>{b(!1),h()};return t.jsxs(t.Fragment,{children:[t.jsxs(ae,{onClose:h,open:!0,classes:{paper:`${j.paper} ${j.customStepClass}`},children:[t.jsx(at,{onClose:h,hideTitleDivider:e.hideTitleDivider,children:t.jsxs(W,{display:"flex",children:[t.jsx(e.Icon,{className:j.cloudLogo,color:"disabled"}),t.jsx(_,{variant:"body1",noWrap:!0,children:e.label})]})}),t.jsxs(ne,{className:j.dialogContent,children:[t.jsx(a.Suspense,{fallback:t.jsx(nt,{children:t.jsx(lt,{})}),children:t.jsx(e.Component,{setLoading:b,handleNext:d,permissions:s,checkedUsers:i,onChangeUpdateAccessable:o=>v(o),groups:f})}),t.jsx(Qe,{severity:"info",className:j.info,children:"Your selection will override existing settings"})]}),t.jsxs(le,{className:j.dialogActions,children:[t.jsx(U,{id:"cancel-button",className:j.cancelButton,variant:"text",size:"small",disabled:x,onClick:h,children:"Cancel"}),t.jsx(U,{id:"ok-button",startIcon:x&&t.jsx(oe,{size:20}),disabled:x||!n,color:"primary",form:"wizard-form",type:"submit",size:"small",children:e.submitStepText})]})]}),t.jsx(ot,{confirmDialogOpen:w,closeConfirmDialog:()=>C(!1),confirmClose:()=>{h(),C(!1)}})]})},Qt=(e,s)=>{const i=a.useMemo(()=>e==null?void 0:e.filter(f=>s.includes(f._id)).every(f=>{var j;return((j=f.user)==null?void 0:j.status)===ye.PENDING}),[e,s]),h=a.useMemo(()=>e==null?void 0:e.filter(f=>s.includes(f._id)).every(f=>{var j;return((j=f.user)==null?void 0:j.status)===ye.ACTIVE}),[e,s]);return{isPendingOnly:i,isActiveOnly:h}};function X(e){return Ze(B(`
      query UsersPermission($workspace_id: ID) {
        permissions(workspace_id: $workspace_id) {
          _id
          role
          user_id
          user_groups
          user {
            email
            status
            full_name
            two_factor_state
            status
          }
        }
      }
    `),{variables:{workspace_id:e}})}const ze=D("div").withConfig({displayName:"WorkspaceUsersPage__HeaderActions",componentId:"sc-w7jlbj-0"})(({theme:e,gap:s=1})=>({display:"flex",alignItems:"center",gap:e.spacing(s)})),Zt=D("div").withConfig({displayName:"WorkspaceUsersPage__DropdownItemContainer",componentId:"sc-w7jlbj-1"})(({theme:e,gap:s=1})=>({display:"flex",gap:e.spacing(s)})),Q=({label:e,Icon:s,Svg:i,onClick:h})=>t.jsxs(Zt,{onClick:h,children:[i?t.jsx(i,{}):t.jsx("img",{src:s,alt:"DropDown Icon"}),t.jsx(_,{children:e})]}),Xt=D(ft).withConfig({displayName:"WorkspaceUsersPage__RemoveCircleOutlineOutlinedIcon",componentId:"sc-w7jlbj-2"})(({theme:e})=>({color:e.palette.common.gray})),es=D(pt).withConfig({displayName:"WorkspaceUsersPage__EditIcon",componentId:"sc-w7jlbj-3"})(({theme:e})=>({color:e.palette.common.gray}));function ts({location:e}){const[s,i]=a.useState([]),[h,f]=a.useState([]),{workspaceId:j}=V(),w=it(j),{data:{usersGroups:C=[]}={}}=Ne(j),[x,b]=a.useState([]),[n,v,d]=Ge("",1e3),{data:{permissions:o=[]}={},loading:S,error:y}=X(j),u=a.useMemo(()=>C.reduce((c,k)=>(c[k==null?void 0:k._id]=k==null?void 0:k.name,c),{}),[C]),{isPendingOnly:A,isActiveOnly:N}=Qt(o,x);a.useEffect(()=>{var c;(c=e.state)!=null&&c.inviteUsers&&i(ve)},[e]);const M=a.useCallback(c=>{v(c.target.value)},[v]),l=()=>{v("")},g=a.useMemo(()=>n?o.filter(c=>{var E,P,T,H,he;const k=((E=c==null?void 0:c.user_groups)==null?void 0:E.length)>0,I=k&&c.user_groups.find(z=>z===w);let r=!1;return I?r=C==null?void 0:C.some(({name:z})=>z==null?void 0:z.toLowerCase().includes(n)):k&&(r=c==null?void 0:c.user_groups.find(z=>{var xe;return(xe=u[z])==null?void 0:xe.includes(n)})),r||((T=(P=c==null?void 0:c.user)==null?void 0:P.full_name)==null?void 0:T.includes(n))||((he=(H=c==null?void 0:c.user)==null?void 0:H.email)==null?void 0:he.includes(n))}):o,[o,n,u,C,w]),G=a.useMemo(()=>o.filter(c=>x.includes(c._id)),[o,x]),p=c=>{switch(c){case q:return t.jsx(Q,{onClick:()=>{i(K(q).steps(G))},Icon:Yt,label:q});case F:return t.jsx(Q,{Svg:Xt,label:F,onClick:()=>i(K(F).steps(G))});case Y:return t.jsx(Q,{onClick:()=>f(K(Y).steps(G)),Svg:es,label:Y});case J:return t.jsx(Q,{onClick:()=>i(K(J).steps(G)),Icon:qt,label:J});default:return"Actions"}},m=a.useMemo(()=>{const c=[q,F],k=[J],I=[Y];return A?[...c,...I]:N?[...k,...I]:I},[A,N]);return t.jsxs(W,{display:"flex",overflow:"auto",flexDirection:"column",flexGrow:1,children:[t.jsx(Te,{showWorkspace:!0,Icon:Ee,title:`Users ${o!=null&&o.length?` (${o.length})`:""}`,actions:t.jsxs(ze,{children:[t.jsx(O,{placeholder:"Search Users/ Email / Groups",variant:"outlined",value:d,size:"small",style:{width:223},onChange:M,InputProps:{style:{borderRadius:6},startAdornment:t.jsx(ie,{fontSize:"small",color:"action"}),endAdornment:t.jsx(ct,{position:"end",children:d&&t.jsx(se,{size:"small",onClick:l,children:t.jsx(rt,{fontSize:"small"})})})}}),t.jsx(Bt,{placeholder:"Actions",disabled:x.length===0,options:m,getOptionLabel:p}),t.jsx(Pt,{startIcon:t.jsx(dt,{fontSize:"large",color:"action"}),onClick:()=>i(ve),children:"Invite user"})]})}),t.jsx(W,{p:3,flexGrow:1,overflow:"auto",children:t.jsx(ut,{loading:S,error:y,permissions:g,openWizard:c=>i(c),checkedUsers:x,setCheckedUsers:b})}),s&&t.jsx(ht,{stepsInfo:s,closeDialog:c=>{c!=="backdropClick"&&i(!1)},dialogOpen:!0}),(h==null?void 0:h.length)>0&&h[0].label===xt.label&&t.jsx(Kt,{stepInfo:{...h[0],optionalInfo:[h[0].optionalInfo]},permissions:o,checkedUsers:x,closeDialog:()=>f(!1),groups:C,dialogOpen:!0})]})}function $e(){return Z(B(`
        mutation EditUsersGroup(
          $id: ID
          $input: UserGroupInput
          
        ) {
          editGroup(id: $id, group: $input)
        }
      `),{update(e){e.evict({fieldName:"usersGroups"})}})}function ss(){return Z(B(`
        mutation DeleteUsersGroup(
          $id: ID
        ) {
          deleteGroup(id: $id)
        }
      `),{update(e){e.evict({fieldName:"usersGroups"})}})}function as(){return Z(B(`
  mutation CreateUsersGroup($input: UserGroupInput) {
    createGroup(group: $input) {
      _id
    }
  }
`),{update(e){e.evict({fieldName:"usersGroups"})}})}function Oe(){const e=new Date,s={year:"numeric",month:"short",day:"2-digit"};return e.toLocaleDateString("en-US",s)}var de={},ns=gt,ls=jt;Object.defineProperty(de,"__esModule",{value:!0});var ue=de.default=void 0,os=ls(a),is=ns(yt()),cs=(0,is.default)(os.createElement("path",{d:"M8 10H5V7H3v3H0v2h3v3h2v-3h3v-2zm10 1c1.66 0 2.99-1.34 2.99-3S19.66 5 18 5c-.32 0-.63.05-.91.14.57.81.9 1.79.9 2.86s-.34 2.04-.9 2.86c.28.09.59.14.91.14zm-5 0c1.66 0 2.99-1.34 2.99-3S14.66 5 13 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm6.62 2.16c.83.73 1.38 1.66 1.38 2.84v2h3v-2c0-1.54-2.37-2.49-4.38-2.84zM13 13c-2 0-6 1-6 3v2h12v-2c0-2-4-3-6-3z"}),"GroupAdd");ue=de.default=cs;function We({onClose:e,group:s}){const{workspaceId:i}=V(),{description:h,name:f}=s||{description:"",name:""},[j,{loading:w}]=as(),[C,{loading:x}]=$e(),[b,n]=a.useState(f),[v,d]=a.useState(h),[o]=Le(),S=Me(),[y,u]=a.useState((s==null?void 0:s.accounts)||[]),[A,N]=a.useState(""),M=De(),l=a.useMemo(()=>y!=null&&y.length?y[0]===$:!1,[y]),g=a.useMemo(()=>o==null?void 0:o.filter(({display_name:r,cloud_account_id:E})=>(r==null?void 0:r.toLowerCase().includes(A))||(E==null?void 0:E.toLowerCase().includes(A))),[o,A]),G=async r=>{var P;r.preventDefault();const E={name:b,description:v,last_modified_by:S==null?void 0:S.display_name,last_modified_time:Oe(),accounts:l?[$]:y,workspace_id:i};try{if(s)await C({variables:{id:s._id,input:E}});else{const{data:T}=await j({variables:{input:{...E,is_default:!1}}}),H=((P=T==null?void 0:T.createGroup)==null?void 0:P._id)??void 0;e(H,b||"")}}catch(T){M(T.message,"error");return}e()},p=r=>{u(r===$?[r]:[])},m=a.useCallback(r=>{N(r.target.value)},[]),c=(r,E)=>{u(r?[...y||[],E]:(y==null?void 0:y.filter(P=>P!==E))??[])},k=()=>{u([])},I=()=>{u((o==null?void 0:o.map(({cloud_account_id:r})=>r).filter(r=>r!=null))??null)};return t.jsxs(ae,{fullWidth:!0,open:!0,style:{marginLeft:"auto",marginRight:"auto",minWidth:660},onClose:()=>e(),children:[t.jsx(ne,{children:t.jsxs(R,{gap:2,children:[t.jsxs(L,{gap:2,style:{alignItems:"center"},children:[t.jsx(ue,{color:"action"}),t.jsx(_,{variant:"subtitle2",style:{textAlign:"left"},children:s?`Edit Group ${s==null?void 0:s.name}`:"Create New Access Group"}),t.jsx(se,{edge:"end",style:{marginLeft:"auto",marginRight:0},color:"inherit",onClick:()=>e(),"aria-label":"close",children:t.jsx(Re,{color:"action"})})]}),t.jsx(_,{variant:"h4",children:"Group Details"}),t.jsx(_,{variant:"subtitle2",children:"Add the name and description of the Access Group"}),t.jsx(O,{autoFocus:!0,variant:"outlined",placeholder:"Access Group name",fullWidth:!0,value:b,onChange:r=>n(r.target.value)}),t.jsx(O,{variant:"outlined",placeholder:"Group Description (optional)",fullWidth:!0,value:v,onChange:r=>d(r.target.value)}),t.jsx(ce,{}),t.jsx(_,{variant:"h4",children:"Cloud Account Access"}),t.jsx(vt,{component:"fieldset",children:t.jsxs(mt,{"aria-label":"options",style:{flexDirection:"row"},name:"options",value:l?$:"specific",onChange:(r,E)=>p(E),children:[t.jsx(me,{value:$,control:t.jsx(Ce,{color:"primary"}),label:`All Accounts (${o==null?void 0:o.length})`}),t.jsx(me,{value:"specific",control:t.jsx(Ce,{color:"primary"}),label:`Specific ${l?"":`(${(y==null?void 0:y.length)||0})`}`})]})}),!l&&t.jsx(O,{placeholder:"Search Accounts",variant:"outlined",value:A,onChange:m,InputProps:{style:{borderRadius:6},startAdornment:t.jsx(ie,{fontSize:"small",color:"action"})}}),!l&&t.jsxs(R,{children:[t.jsx(Be,{selected:y,handleClearAll:k,handleSelectAll:I}),t.jsx(ds,{children:g==null?void 0:g.map(r=>t.jsx(rs,{className:"account-row",children:t.jsxs(Ct,{children:[t.jsx(Pe,{color:"primary",checked:y==null?void 0:y.some(E=>E===(r==null?void 0:r.cloud_account_id)),onClick:E=>E.stopPropagation(),onChange:(E,P)=>c(P,r==null?void 0:r.cloud_account_id),inputProps:{"aria-label":"primary checkbox"}}),t.jsx(_t,{width:"16",height:"16"}),t.jsxs(R,{children:[t.jsx(_,{children:r==null?void 0:r.display_name}),t.jsx(_,{color:"textSecondary",children:r==null?void 0:r.cloud_account_id})]})]})},r==null?void 0:r.cloud_account_id))})]})]})}),t.jsxs(le,{children:[t.jsx(U,{variant:"text",onClick:()=>e(),children:"Cancel"}),t.jsx(U,{onClick:G,startIcon:(w||x)&&t.jsx(oe,{size:20}),color:"primary",autoFocus:!0,children:s?"Save":"Create & Assign Members"})]})]})}const rs=D(St).withConfig({displayName:"UsersGroupModal__StyledAccountRow",componentId:"sc-rli04x-0"})(["height:48px;"]),ds=D(wt).withConfig({displayName:"UsersGroupModal__StyledAccountList",componentId:"sc-rli04x-1"})(["border:1px solid ",";border-radius:6px;padding:","px;.account-row:nth-child(even){background-color:",";}"],e=>e.theme.palette.dividerLight,e=>e.theme.spacing(1),e=>e.theme.palette.dividerLight),Be=({selected:e,handleClearAll:s,handleSelectAll:i})=>t.jsxs(L,{style:{alignItems:"center"},children:[(e==null?void 0:e.length)>0&&t.jsxs(_,{children:[e==null?void 0:e.length," Selected"]}),t.jsx(U,{variant:"text",size:"small",style:{marginLeft:"auto"},onClick:s,children:"Clear"}),t.jsx(ce,{flexItem:!0,orientation:"vertical",variant:"middle"}),t.jsx(U,{color:"primary",variant:"text",size:"small",onClick:i,children:"Select all"})]});function us({permissions:e,members:s,addMember:i,removeMember:h,handleClearAll:f,handleSelectAll:j}){const[w,C]=a.useState([]),x=a.useMemo(()=>{const n=(o,S)=>{var A,N,M,l;const y=((A=o==null?void 0:o.user)==null?void 0:A.full_name)||((N=o==null?void 0:o.user)==null?void 0:N.email),u=((M=S==null?void 0:S.user)==null?void 0:M.full_name)||((l=S==null?void 0:S.user)==null?void 0:l.email);return y<u?-1:y>u?1:0},v=e==null?void 0:e.filter(o=>s==null?void 0:s.some(S=>S===(o==null?void 0:o._id))).sort(n),d=e==null?void 0:e.filter(o=>s==null?void 0:s.every(S=>S!==(o==null?void 0:o._id))).sort(n);return[...v,...d]},[]),b=(n,v)=>{n?i(v):h(v),C([...w,v])};return t.jsxs(R,{children:[t.jsx(Be,{selected:s,handleClearAll:f,handleSelectAll:j}),(e==null?void 0:e.length)>0&&t.jsx(xs,{gap:1,children:x==null?void 0:x.map(n=>{var v,d,o,S;return t.jsxs(hs,{className:"member-item",children:[t.jsx(Pe,{color:"primary",checked:s==null?void 0:s.some(y=>y===(n==null?void 0:n._id)),onClick:y=>y.stopPropagation(),onChange:(y,u)=>b(u,n==null?void 0:n._id),disabled:(n==null?void 0:n.role)===te.Superuser}),((v=n==null?void 0:n.user)==null?void 0:v.full_name)&&t.jsx(re,{icon:t.jsx(Ut,{name:Ue((d=n==null?void 0:n.user)==null?void 0:d.full_name)})}),t.jsxs(R,{children:[t.jsx(_,{children:(o=n==null?void 0:n.user)==null?void 0:o.full_name}),t.jsx(_,{color:"textSecondary",children:(S=n==null?void 0:n.user)==null?void 0:S.email})]})]},n==null?void 0:n._id)})})]})}const hs=D(L).withConfig({displayName:"MembersList__MemberItem",componentId:"sc-r3rfam-0"})(["height:45px;padding:","px;align-items:center;"],e=>e.theme.spacing(1)),xs=D(R).withConfig({displayName:"MembersList__MembersListContainer",componentId:"sc-r3rfam-1"})(["border:solid 1px ",";border-radius:6px;padding:","px;.member-item:nth-child(even){background-color:",";}"],e=>e.theme.palette.dividerLight,e=>e.theme.spacing(1),e=>e.theme.palette.dividerLight);function Ve(e){const{isOpen:s,onClose:i,group:h={}}=e,{_id:f,name:j,is_admin:w}=h,[C,x]=a.useState([]),[b,n]=a.useState(""),{workspaceId:v}=V(),{data:{permissions:d=[]}={}}=X(v),o=a.useMemo(()=>d==null?void 0:d.filter(p=>{var m,c,k,I;return(w||(p==null?void 0:p.role)!==te.Superuser)&&(!b||((c=(m=p==null?void 0:p.user)==null?void 0:m.full_name)==null?void 0:c.toLowerCase().includes(b))||((I=(k=p==null?void 0:p.user)==null?void 0:k.email)==null?void 0:I.toLowerCase().includes(b)))}),[d,b,w]),[S,{loading:y}]=Z(B(`
      mutation updatePermissions($input: UpdatePermissionsInput) {
        updatePermissions(input: $input)
      }
    `),{update(p){p.evict({fieldName:"permissions"})}}),u=a.useMemo(()=>d==null?void 0:d.filter(p=>{var m;return((m=p==null?void 0:p.user_groups)==null?void 0:m.includes(f||""))??!1}),[d,f]);a.useEffect(()=>{x((u==null?void 0:u.filter(Boolean).map(p=>(p==null?void 0:p._id)??""))??[])},[u,f]);const A=p=>{x(m=>[...m,p])},N=p=>{x(m=>m.filter(c=>c!==p))},M=()=>{x(C.filter(p=>{const m=d==null?void 0:d.find(c=>(c==null?void 0:c._id)===p);return(m==null?void 0:m.role)===te.Superuser}))},l=()=>{x((o??[]).filter(Boolean).map(p=>(p==null?void 0:p._id)??""))},g=a.useMemo(()=>{const p=[];return(u??[]).forEach(m=>{C.every(k=>k!==(m==null?void 0:m._id))&&m&&m.user_groups&&p.push({permission_id:m._id,role:m.role??void 0,user_groups:m.user_groups.filter(k=>k!==null&&k!==f)})}),C.forEach(m=>{var k;if((u??[]).every(I=>(I==null?void 0:I._id)!==m)){const I=d==null?void 0:d.find(r=>(r==null?void 0:r._id)===m);p.push({permission_id:I==null?void 0:I._id,role:(I==null?void 0:I.role)??void 0,user_groups:[...((k=I==null?void 0:I.user_groups)==null?void 0:k.filter(r=>typeof r=="string"))??[],f??""]})}}),p},[C,u,d,f]),G=async()=>{await S({variables:{input:{permissions:g}}}),i()};return t.jsxs(ae,{fullWidth:!0,open:s,style:{marginLeft:"auto",marginRight:"auto",minWidth:660},onClose:()=>i(!1),children:[t.jsx(ne,{children:t.jsxs(R,{gap:2,children:[t.jsxs(R,{gap:2,children:[t.jsxs(L,{gap:2,style:{alignItems:"center"},children:[t.jsx(ue,{color:"action"}),t.jsxs(_,{variant:"subtitle2",style:{textAlign:"left"},children:["Manage Access ",j]}),t.jsx(se,{edge:"end",style:{marginLeft:"auto",marginRight:0},color:"inherit",onClick:()=>i(),"aria-label":"close",children:t.jsx(Re,{color:"action"})})]}),t.jsx(_,{variant:"h4",children:"Groups Membership"}),t.jsx(O,{onChange:p=>n(p.target.value),value:b,label:"Search by Name or Email",variant:"outlined"})]}),t.jsx(us,{members:C.filter(Boolean),permissions:o,addMember:A,removeMember:N,handleClearAll:M,handleSelectAll:l})]})}),t.jsxs(le,{children:[t.jsx(U,{variant:"text",onClick:()=>i(),children:"Cancel"}),t.jsx(U,{startIcon:y&&t.jsx(oe,{size:20}),onClick:G,color:"primary",autoFocus:!0,children:"Save Changes"})]})]})}function ps({group:e}){var M;const[s,i]=a.useState(!1),[h,f]=a.useState(!1),[j]=$e(),[w]=ss(),{workspaceId:C}=V(),x=bt(),b=De(),n=Me(),{data:{permissions:v=[]}={}}=X(C),d=a.useMemo(()=>{var l;return(l=v==null?void 0:v.find(g=>(g==null?void 0:g.user_id)===(e==null?void 0:e.last_modified_by)))==null?void 0:l.user},[v,e]),o=a.useMemo(()=>{var l;return((e==null?void 0:e.accounts)??[]).length>0&&((l=e==null?void 0:e.accounts)==null?void 0:l[0])===$},[e]),S=a.useMemo(()=>{var l;return(l=(v??[]).filter(g=>{var G;return(G=g==null?void 0:g.user_groups)==null?void 0:G.includes((e==null?void 0:e._id)??"")}))==null?void 0:l.length},[v,e]),y=a.useMemo(()=>[{..._e,disabled:!!e.is_admin},we,{...Se,disabled:!!e.is_default}],[e]),u=a.useCallback(async l=>{const{_id:g,...G}=e;switch(l==null?void 0:l.label){case Se.label:if(!await x.confirm({title:t.jsxs(L,{gap:1,style:{alignItems:"center"},children:[t.jsx(kt,{color:"action"}),t.jsx(_,{children:"Set Default Access Group"})]}),text:t.jsxs(R,{style:{width:300},children:[t.jsx(_,{children:"The default Access Group will be set to:"}),t.jsx(_,{children:`"${e.name}"`}),t.jsx(_,{children:"Newly invited users and users who sign in via SSO will be affected by this action."})]}),confirmText:"Set as Default",declineText:"Cancel",origin:"bottom"}))return;await j({variables:{id:e==null?void 0:e._id,input:{...G,is_default:!0,last_modified_time:Oe(),last_modified_by:n==null?void 0:n.display_name}}}),b("Default Group changed successfully","success");break;case _e.label:i(!0);break;case we.label:f(!0);break}},[j,e,x,b,n]),A=a.useCallback(async l=>{await x.confirm({title:t.jsxs(L,{gap:1,style:{alignItems:"center"},children:[t.jsx(be,{}),t.jsx(_,{children:"Delete Access Group"})]}),inputText:{disabled:!0},text:t.jsx(R,{style:{width:300},children:t.jsxs(_,{children:["The Access Group ",`"${e.name}"`," will be removed."]})}),confirmText:"Delete Access Group",declineText:"Cancel",origin:"bottom"})&&(await w({variables:{id:e==null?void 0:e._id}}),b("Group Deleted Successfully","success"))},[e,w,x,b]),N=a.useMemo(()=>!!(S>0||e.is_default),[S,e.is_default]);return t.jsxs(gs,{gap:2,children:[t.jsxs(L,{style:{justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(L,{gap:1,style:{alignItems:"center"},children:[t.jsx(It,{color:"action"}),t.jsx(_,{variant:"h4",children:e.name})]}),t.jsxs(L,{style:{alignItems:"center"},children:[(e==null?void 0:e.is_default)&&t.jsx(js,{children:"Default"}),t.jsxs(L,{className:"group-actions",children:[!(e!=null&&e.is_admin)&&t.jsx(ke,{placement:"top",title:S>0?"Remove all members to enable this option":e.is_default?"This option unavailable for Default Access Group":"",children:t.jsx("div",{children:t.jsx(Ie,{onClick:A,disabled:N,children:t.jsx(be,{fontSize:"small"})})})}),t.jsx(At,{disablePropagation:!0,triggerComponent:l=>t.jsx(Ie,{size:"small",className:"menu-button",...l,children:t.jsx(Gt,{fontSize:"small"})}),options:y,onClickOptions:l=>{u(l)}})]})]})]}),t.jsx(fs,{children:e==null?void 0:e.description}),t.jsxs(L,{children:[t.jsx(R,{gap:1,style:{alignItems:"start",width:"50%"},children:t.jsxs(L,{gap:1,children:[t.jsx(Mt,{size:"small",type:"Account",disableTooltip:!0}),o?t.jsx(_,{color:"textSecondary",children:"All accounts"}):t.jsx(_,{children:(M=e.accounts)==null?void 0:M.length})]})}),t.jsx(ce,{light:!0,flexItem:!0,orientation:"vertical",variant:"middle"}),t.jsxs(R,{gap:1,style:{alignItems:"start",marginLeft:12},children:[t.jsxs(L,{style:{alignItems:"center"},children:[t.jsx(Dt,{color:"action"}),t.jsx(_,{children:S})]}),d&&t.jsx(re,{icon:t.jsx(ke,{title:t.jsxs(R,{children:[t.jsx(_,{color:"textSecondary",children:"Last modify by"}),t.jsx(_,{children:d==null?void 0:d.full_name}),t.jsx(_,{children:d==null?void 0:d.email})]}),children:t.jsx(Tt,{children:Ue(d==null?void 0:d.full_name)})}),label:e==null?void 0:e.last_modified_time})]})]}),s&&t.jsx(We,{group:e,onClose:()=>i(!1)}),t.jsx(Ve,{group:e,onClose:()=>f(!1),isOpen:h})]})}const fs=D(_).withConfig({displayName:"UsersGroup__Description",componentId:"sc-cyscgn-0"})(["width:290px;height:34px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;white-space:normal;text-overflow:ellipsis;"]),js=D(_).withConfig({displayName:"UsersGroup__DefaultLabel",componentId:"sc-cyscgn-1"})(["background-color:",";border-radius:100px;padding:0px 9px;color:",";font-size:10px;height:18px;line-height:18px;"],e=>e.theme.palette.common.black,e=>e.theme.palette.common.white),gs=D(R).withConfig({displayName:"UsersGroup__GroupCard",componentId:"sc-cyscgn-2"})(["border-radius:6px;background-color:",";border-radius:","px;padding:","px;border:1px solid transparent;width:314px;margin-bottom:","px;.group-actions{visibility:hidden;}&:hover{border:1px solid ",";.group-actions{visibility:visible;}}.MuiButtonBase-root.Mui-disabled{}"],e=>e.theme.palette.background.paper,e=>e.theme.shape.borderRadius,e=>e.theme.spacing(2),e=>e.theme.spacing(2),e=>e.theme.palette.divider),ys=()=>{const{workspaceId:e}=V(),{data:{usersGroups:s=[]}={}}=Ne(e),[i,h]=a.useState(!1),[f,j]=a.useState(void 0),[w]=Le(),{data:{permissions:C=[]}={}}=X(e),[x,b,n]=Ge("",500),v=a.useMemo(()=>(s??[]).map(u=>{const A=((u==null?void 0:u.accounts)||[]).reduce((M,l)=>{const g=w==null?void 0:w.find(({cloud_account_id:G})=>G===l);return g!=null&&g.display_name&&M.push(g.display_name),M},[]),N=(C??[]).reduce((M,l)=>{var g,G,p,m,c;return(g=l==null?void 0:l.user_groups)!=null&&g.includes((u==null?void 0:u._id)??"")&&((G=l==null?void 0:l.user)!=null&&G.full_name||(p=l==null?void 0:l.user)!=null&&p.email)&&M.push({name:(m=l==null?void 0:l.user)==null?void 0:m.full_name,email:(c=l==null?void 0:l.user)==null?void 0:c.email}),M},[]);return{...u,accountNames:A,members:N}}),[s,w,C]),d=a.useMemo(()=>x?v.filter(u=>{var A,N,M,l;return((A=u==null?void 0:u.name)==null?void 0:A.toLowerCase().includes(x==null?void 0:x.toLowerCase()))||((N=u.accountNames)==null?void 0:N.some(g=>g==null?void 0:g.includes(x)))||((M=u.members)==null?void 0:M.some(({name:g,email:G})=>(g==null?void 0:g.includes(x))||(G==null?void 0:G.includes(x))))||((l=u.accounts)==null?void 0:l.some(g=>g==null?void 0:g.includes(x)))}):v,[x,v]),o=a.useCallback(()=>{h(!0)},[]),S=a.useCallback(u=>{b(u.target.value)},[b]),y=(u,A)=>{h(!1),u&&j({_id:u,name:A})};return t.jsxs(W,{display:"flex",flexDirection:"column",height:"100%",children:[t.jsx(Te,{title:`${d==null?void 0:d.length} Groups`,actions:t.jsxs(ze,{children:[t.jsx(O,{placeholder:"Search Group / Account / Member",variant:"outlined",value:n,size:"small",style:{width:308},onChange:S,InputProps:{style:{borderRadius:6},startAdornment:t.jsx(ie,{fontSize:"small",color:"action"})}}),t.jsx(U,{startIcon:t.jsx(Nt,{fontSize:"large",color:"action"}),variant:"text",onClick:o,children:"New"})]})}),t.jsx(W,{p:3,flexGrow:1,overflow:"auto",children:t.jsx(vs,{children:d==null?void 0:d.map(({accountNames:u,members:A,...N})=>t.jsx(ps,{group:N},N._id))})}),i&&t.jsx(We,{onClose:y}),f&&t.jsx(Ve,{group:f,onClose:()=>j(void 0),isOpen:!!(f!=null&&f._id)})]})},vs=D.div.withConfig({displayName:"UsersGroupsPage__GroupsContainer",componentId:"sc-1bkk372-0"})(["display:grid;grid-template-columns:repeat(auto-fill,minmax(314px,1fr));grid-gap:","px;width:100%;max-width:1300px;margin:0px auto;margin-bottom:40px;"],e=>e.theme.spacing(1)),ks=()=>{const{path:e}=ee(),[s,i]=Wt("users");return t.jsxs(ms,{style:{height:"100%"},children:[t.jsx(Lt,{paper:!0,title:t.jsxs(L,{gap:1,style:{alignItems:"center",marginRight:"12px"},children:[t.jsx(re,{style:{marginRight:"12px"},icon:t.jsx(Ee,{color:"action"}),label:"Users and access",labelVariant:"h5"}),t.jsxs(Rt,{value:s,onChange:(h,f)=>i(f),children:[t.jsx(Ae,{value:"users",label:"Users"}),t.jsx(Ae,{value:"groups",label:"Access Groups"})]})]})}),t.jsxs(Xe,{children:[t.jsx(fe,{exact:!0,path:[e,`${e}/users`],component:ts}),t.jsx(fe,{path:`${e}/groups`,component:ys})]})]})},Is=D(Et).withConfig({displayName:"WorkspaceSettingsPage__HeaderLink",componentId:"sc-4j1pkf-0"})(({theme:e})=>({display:"flex",alignItems:"center"})),As=D(Ot).withConfig({displayName:"WorkspaceSettingsPage__Card",componentId:"sc-4j1pkf-1"})(({theme:e})=>({cursor:"pointer",padding:e.spacing(2),display:"flex",justifyContent:"center",alignItems:"center",height:e.spacing(11)})),Gs=D(_).withConfig({displayName:"WorkspaceSettingsPage__CardText",componentId:"sc-4j1pkf-2"})(({theme:e})=>({alignSelf:"center"})),Ms=D.div.withConfig({displayName:"WorkspaceSettingsPage__Scrollable",componentId:"sc-4j1pkf-3"})(["height:100%;overflow:auto;"]),ms=D(R).withConfig({displayName:"WorkspaceSettingsPage__LayoutColumnWrapper",componentId:"sc-4j1pkf-4"})(["overflow:unset;"]),Ds=D(L).withConfig({displayName:"WorkspaceSettingsPage__LayoutRowWrapper",componentId:"sc-4j1pkf-5"})(["overflow:unset;"]),Ns=D.div.withConfig({displayName:"WorkspaceSettingsPage__EmptyState",componentId:"sc-4j1pkf-6"})(["margin-top:20%;display:flex;flex-direction:column;justify-content:center;align-items:center;color:",";"],e=>e.theme.palette.primary.contrastText);export{As as Card,Gs as CardText,Ns as EmptyState,Is as HeaderLink,ms as LayoutColumnWrapper,Ds as LayoutRowWrapper,Ms as Scrollable,ks as default};
