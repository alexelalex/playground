const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Terraform-CPArW_F8.js","assets/index-CDz6_-F0.js","assets/index-TJTpLzNp.css","assets/AWS_dark-D1d2d1qV.js","assets/AWS_light-DY3n9btR.js","assets/Azure_dark-DYBPPVYT.js","assets/Azure_light-BEyjIFEa.js","assets/CloudTrail_dark-DFmcTnBV.js","assets/CloudTrail_light-Bb_1IG97.js","assets/Github_dark-Cc7ArBIn.js","assets/Github_light-hPuRC508.js","assets/boto_dark-B2VqBhuP.js","assets/boto_light-DiKTGmii.js","assets/kubernetes_dark-D_lLIYaL.js","assets/kubernetes_light-P3B5nO9m.js","assets/Bitbucket-C0NJ_Xh0.js","assets/Lightlytics-5kVKjXaz.js","assets/LightlyticsDaemon-CJBwitJh.js","assets/TerraformCloud-t3l9bSsF.js","assets/kubernetes-BzZiujhe.js"])))=>i.map(i=>d[i]);
import{w as hs,r as a,o as ce,_ as Ks,M as Fe,N as ae,K as Xs,F as Ne,Q as I,j as e,l as y,R as D,q as v,C as re,aN as Oe,g as se,a as Ae,a8 as xs,aO as Zs,c as gs,H as ms,aP as Le,I as et,v as st,h as tt,S as nt,i as ns}from"./index-CDz6_-F0.js";import{p as Pe,gu as ve,U as js,aw as de,x as os,d as u,I as H,A as ot,cb as ys,ca as rt,w as it,gv as lt,b as g,L as N,c5 as at,D as ct,h as pe,bE as we,fH as U,gw as dt,a5 as _s,gx as fs,aM as ge,R as G,aN as Be,gy as Y,j as ke,gz as ut,gA as pt,u as be,gB as rs,gC as K,gD as is,K as Ce,T as me,by as ht,n as Re,a6 as oe,C as Ve,gE as bs,q as J,B as te,gF as We,bD as xt,bY as gt,M as xe,ae as ee,gG as mt,gH as vs,aD as Se,dI as Me,dJ as Ge,g as ue,gI as Cs,gJ as jt,gK as qe,gL as De,dj as Is,aR as yt,aL as _t,dN as ft,ah as He,X as ws,gM as bt,gN as vt,aB as Ue,gO as Ct,gP as ls,bL as It,eb as ks,gQ as wt,cJ as kt,gR as Rt,ax as Ie,gS as St,gT as as,ay as Rs,aA as Et,gU as Ft,fG as Tt,y as $t,gV as zt,gW as Ot,as as Ye,F as Dt,c as Nt,S as At,P as Lt,bO as Pt,gX as Bt,s as je,gY as Vt,gZ as Wt,r as Ee,N as Ss,O as ne,g_ as Mt,b6 as Gt,g$ as Es,h0 as qt,h1 as Ht,h2 as Ut,h3 as Yt,bg as Qt,h4 as Fs,h5 as Jt,h6 as Ts,aC as Qe,h7 as $s,aK as Kt,h8 as zs,h9 as Os,ha as Xt,hb as Zt,hc as en,bq as Ds,hd as sn,f as tn,cy as nn,he as on,hf as rn,hg as ln,hh as an,hi as cn}from"./App-c61S4xKC.js";import{u as dn,F as un,a as Ns,N as pn,g as hn,p as xn,o as gn,b as mn}from"./DiscoveryLayout-BJgOwZA9.js";import{H as jn}from"./Header-CRo7NnqJ.js";Pe.styles;var yn=function(t){return{root:{display:"inline-flex",borderRadius:t.shape.borderRadius},contained:{boxShadow:t.shadows[2]},disableElevation:{boxShadow:"none"},disabled:{},fullWidth:{width:"100%"},vertical:{flexDirection:"column"},grouped:{minWidth:40},groupedHorizontal:{"&:not(:first-child)":{borderTopLeftRadius:0,borderBottomLeftRadius:0},"&:not(:last-child)":{borderTopRightRadius:0,borderBottomRightRadius:0}},groupedVertical:{"&:not(:first-child)":{borderTopRightRadius:0,borderTopLeftRadius:0},"&:not(:last-child)":{borderBottomRightRadius:0,borderBottomLeftRadius:0}},groupedText:{},groupedTextHorizontal:{"&:not(:last-child)":{borderRight:"1px solid ".concat(t.palette.type==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)")}},groupedTextVertical:{"&:not(:last-child)":{borderBottom:"1px solid ".concat(t.palette.type==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)")}},groupedTextPrimary:{"&:not(:last-child)":{borderColor:ce(t.palette.primary.main,.5)}},groupedTextSecondary:{"&:not(:last-child)":{borderColor:ce(t.palette.secondary.main,.5)}},groupedOutlined:{},groupedOutlinedHorizontal:{"&:not(:first-child)":{marginLeft:-1},"&:not(:last-child)":{borderRightColor:"transparent"}},groupedOutlinedVertical:{"&:not(:first-child)":{marginTop:-1},"&:not(:last-child)":{borderBottomColor:"transparent"}},groupedOutlinedPrimary:{"&:hover":{borderColor:t.palette.primary.main}},groupedOutlinedSecondary:{"&:hover":{borderColor:t.palette.secondary.main}},groupedContained:{boxShadow:"none"},groupedContainedHorizontal:{"&:not(:last-child)":{borderRight:"1px solid ".concat(t.palette.grey[400]),"&$disabled":{borderRight:"1px solid ".concat(t.palette.action.disabled)}}},groupedContainedVertical:{"&:not(:last-child)":{borderBottom:"1px solid ".concat(t.palette.grey[400]),"&$disabled":{borderBottom:"1px solid ".concat(t.palette.action.disabled)}}},groupedContainedPrimary:{"&:not(:last-child)":{borderColor:t.palette.primary.dark}},groupedContainedSecondary:{"&:not(:last-child)":{borderColor:t.palette.secondary.dark}}}},_n=a.forwardRef(function(t,n){var o=t.children,i=t.classes,l=t.className,r=t.color,d=r===void 0?"default":r,c=t.component,p=c===void 0?"div":c,x=t.disabled,j=x===void 0?!1:x,_=t.disableElevation,w=_===void 0?!1:_,C=t.disableFocusRipple,f=C===void 0?!1:C,h=t.disableRipple,$=h===void 0?!1:h,A=t.fullWidth,k=A===void 0?!1:A,z=t.orientation,R=z===void 0?"horizontal":z,m=t.size,F=m===void 0?"medium":m,S=t.variant,L=S===void 0?"outlined":S,B=Ks(t,["children","classes","className","color","component","disabled","disableElevation","disableFocusRipple","disableRipple","fullWidth","orientation","size","variant"]),X=Fe(i.grouped,i["grouped".concat(ae(R))],i["grouped".concat(ae(L))],i["grouped".concat(ae(L)).concat(ae(R))],i["grouped".concat(ae(L)).concat(d!=="default"?ae(d):"")],j&&i.disabled);return a.createElement(p,Xs({role:"group",className:Fe(i.root,l,k&&i.fullWidth,w&&i.disableElevation,L==="contained"&&i.contained,R==="vertical"&&i.vertical),ref:n},B),a.Children.map(o,function(T){return a.isValidElement(T)?a.cloneElement(T,{className:Fe(X,T.props.className),color:T.props.color||d,disabled:T.props.disabled||j,disableElevation:T.props.disableElevation||w,disableFocusRipple:f,disableRipple:$,fullWidth:k,size:T.props.size||F,variant:T.props.variant||L}):null}))});const fn=hs(yn,{name:"MuiButtonGroup"})(_n),bn=({format:s,...t})=>{const n=Ne(),[o,i]=a.useState();a.useEffect(()=>{s&&ve(Object.assign({}),`../assets/formats/${s}_${n.palette.type}.svg`,4).then(({ReactComponent:r})=>i(r)).catch(()=>{ve(Object.assign({"../assets/formats/Terraform.svg":()=>I(()=>import("./Terraform-CPArW_F8.js"),__vite__mapDeps([0,1,2]))}),`../assets/formats/${s}.svg`,4).then(({ReactComponent:r})=>i(r))})},[s,n.palette.type]);const l=o&&e.jsx(o,{with:18,height:18,...t,style:{borderRadius:5,...t.style}});return l?e.jsx(js,{disabled:!s,title:"Format",content:e.jsx(de,{icon:l,label:s}),children:l}):!1},vn=({type:s,disableTooltip:t,...n})=>{const o=Ne(),[i,l]=a.useState();a.useEffect(()=>{!s||s==="Unknown"||ve(Object.assign({"../assets/sources/AWS_dark.svg":()=>I(()=>import("./AWS_dark-D1d2d1qV.js"),__vite__mapDeps([3,1,2])),"../assets/sources/AWS_light.svg":()=>I(()=>import("./AWS_light-DY3n9btR.js"),__vite__mapDeps([4,1,2])),"../assets/sources/Azure_dark.svg":()=>I(()=>import("./Azure_dark-DYBPPVYT.js"),__vite__mapDeps([5,1,2])),"../assets/sources/Azure_light.svg":()=>I(()=>import("./Azure_light-BEyjIFEa.js"),__vite__mapDeps([6,1,2])),"../assets/sources/CloudTrail_dark.svg":()=>I(()=>import("./CloudTrail_dark-DFmcTnBV.js"),__vite__mapDeps([7,1,2])),"../assets/sources/CloudTrail_light.svg":()=>I(()=>import("./CloudTrail_light-Bb_1IG97.js"),__vite__mapDeps([8,1,2])),"../assets/sources/Github_dark.svg":()=>I(()=>import("./Github_dark-Cc7ArBIn.js"),__vite__mapDeps([9,1,2])),"../assets/sources/Github_light.svg":()=>I(()=>import("./Github_light-hPuRC508.js"),__vite__mapDeps([10,1,2])),"../assets/sources/boto_dark.svg":()=>I(()=>import("./boto_dark-B2VqBhuP.js"),__vite__mapDeps([11,1,2])),"../assets/sources/boto_light.svg":()=>I(()=>import("./boto_light-DiKTGmii.js"),__vite__mapDeps([12,1,2])),"../assets/sources/kubernetes_dark.svg":()=>I(()=>import("./kubernetes_dark-D_lLIYaL.js"),__vite__mapDeps([13,1,2])),"../assets/sources/kubernetes_light.svg":()=>I(()=>import("./kubernetes_light-P3B5nO9m.js"),__vite__mapDeps([14,1,2]))}),`../assets/sources/${s}_${o.palette.type}.svg`,4).then(({ReactComponent:d})=>l(d)).catch(()=>{ve(Object.assign({"../assets/sources/AWS_dark.svg":()=>I(()=>import("./AWS_dark-D1d2d1qV.js"),__vite__mapDeps([3,1,2])),"../assets/sources/AWS_light.svg":()=>I(()=>import("./AWS_light-DY3n9btR.js"),__vite__mapDeps([4,1,2])),"../assets/sources/Azure_dark.svg":()=>I(()=>import("./Azure_dark-DYBPPVYT.js"),__vite__mapDeps([5,1,2])),"../assets/sources/Azure_light.svg":()=>I(()=>import("./Azure_light-BEyjIFEa.js"),__vite__mapDeps([6,1,2])),"../assets/sources/Bitbucket.svg":()=>I(()=>import("./Bitbucket-C0NJ_Xh0.js"),__vite__mapDeps([15,1,2])),"../assets/sources/CloudTrail_dark.svg":()=>I(()=>import("./CloudTrail_dark-DFmcTnBV.js"),__vite__mapDeps([7,1,2])),"../assets/sources/CloudTrail_light.svg":()=>I(()=>import("./CloudTrail_light-Bb_1IG97.js"),__vite__mapDeps([8,1,2])),"../assets/sources/Github_dark.svg":()=>I(()=>import("./Github_dark-Cc7ArBIn.js"),__vite__mapDeps([9,1,2])),"../assets/sources/Github_light.svg":()=>I(()=>import("./Github_light-hPuRC508.js"),__vite__mapDeps([10,1,2])),"../assets/sources/Lightlytics.svg":()=>I(()=>import("./Lightlytics-5kVKjXaz.js"),__vite__mapDeps([16,1,2])),"../assets/sources/LightlyticsDaemon.svg":()=>I(()=>import("./LightlyticsDaemon-CJBwitJh.js"),__vite__mapDeps([17,1,2])),"../assets/sources/TerraformCloud.svg":()=>I(()=>import("./TerraformCloud-t3l9bSsF.js"),__vite__mapDeps([18,1,2])),"../assets/sources/boto_dark.svg":()=>I(()=>import("./boto_dark-B2VqBhuP.js"),__vite__mapDeps([11,1,2])),"../assets/sources/boto_light.svg":()=>I(()=>import("./boto_light-DiKTGmii.js"),__vite__mapDeps([12,1,2])),"../assets/sources/kubernetes.svg":()=>I(()=>import("./kubernetes-BzZiujhe.js"),__vite__mapDeps([19,1,2])),"../assets/sources/kubernetes_dark.svg":()=>I(()=>import("./kubernetes_dark-D_lLIYaL.js"),__vite__mapDeps([13,1,2])),"../assets/sources/kubernetes_light.svg":()=>I(()=>import("./kubernetes_light-P3B5nO9m.js"),__vite__mapDeps([14,1,2]))}),`../assets/sources/${s}.svg`,4).then(({ReactComponent:d})=>l(d))})},[s,o.palette.type]);const r=i&&e.jsx(i,{width:18,height:18,...n,style:{borderRadius:5,...n.style}});return r?e.jsx(js,{disabled:t||!s,title:"Source",content:e.jsxs(os,{display:"flex",alignItems:"center",children:[e.jsx(os,{mr:1,children:r}),e.jsx(u,{variant:"body2",children:s==="Lightlytics"?"Stream Security":s})]}),children:r}):!1};function Cn(s,{facet:t,fields:n}){return a.useMemo(()=>{if(t)return t;const o=y.chain(s).reduce((i,l)=>({...i,...y.mapValues(n,(r,d)=>{const c=Array.isArray(n)?r:d,p={...i[c]},x=y.get(l,c),j=y.compact(Array.isArray(x)?x:[x]);for(const _ of j)p[_]=(p[_]||0)+1;return p})}),{}).value();return y.chain(o).mapValues(i=>y.map(i,(l,r)=>({value:r,count:l}))).value()},[t,n,s])}const As=D.createContext(null),Je=()=>a.useContext(As);function Ls({facet:s=null,data:t,values:n,valuesDefaults:o=null,onValuesChange:i,...l}){const[r,d]=a.useState({}),c=Cn(t,{facet:s,fields:r}),p=a.useCallback(j=>(d(_=>({..._,[j]:!0})),()=>{d(_=>({..._,[j]:!1}))}),[]),x=a.useMemo(()=>({facets:c,values:n,valuesDefaults:o,registerField:p,onValuesChange:i}),[c,i,p,n,o]);return e.jsx(As.Provider,{value:x,...l})}function In({label:s,field:t,input:n=En,optionsSortBy:o,renderOption:i,createOption:l,mergeValues:r=!1,compare:d=y.isEqual,getValue:c,defaultCollapsed:p=!1}){const{values:x,valuesDefaults:j,facets:_,registerField:w,onValuesChange:C}=Je(),f=a.useCallback((O,Q)=>c?c(O,Q):O==null?void 0:O[Q],[c]),h=a.useMemo(()=>f(x,t),[t,f,x]),$=a.useMemo(()=>f(j,t),[t,f,j]),[A,k]=a.useState(typeof h<"u"?!1:p),[z,R]=a.useState(null),[m,F]=a.useState(null),[S,L]=a.useState(l?f(x,t):[]);a.useEffect(()=>w(t),[t,w]);const B=a.useCallback(O=>{const Q=typeof r=="function"?r(x,O,t):{...x,[t]:O};C(y.omitBy(Q,q=>!(q!=null&&q.length)))},[t,r,C,x]),X=a.useCallback(()=>{R(null);const O=Array.isArray(m)?m:[m];L(O),B(O),F(null)},[m,B]),T=a.useCallback(O=>{const Q=[...S.slice(0,O),...S.slice(O+1)];L(Q);const q=S.filter(_e=>!d(_e,S[O]));B(q)},[d,S,B]),b=a.useCallback(O=>{R(O.currentTarget),F(f(x,t))},[t,f,x]),ye=a.useMemo(()=>o?y.sortBy(_[t],o):_[t],[_,t,o]);return e.jsxs(kn,{children:[e.jsxs(Rn,{grow:[1,0],children:[e.jsx(u,{variant:"subtitle2",children:s}),l?e.jsx(H,{size:"small",onClick:b,children:e.jsx(ot,{fontSize:"small"})}):e.jsx(H,{size:"small",onClick:()=>k(!A),children:A?e.jsx(ys,{fontSize:"small"}):e.jsx(rt,{fontSize:"small"})})]}),e.jsx(it,{in:!A,children:e.jsx(Sn,{children:e.jsx(n,{options:ye,createdOptions:S,onDeleteOption:T,value:h,defaultValue:$,onValueChange:B,renderOption:i||y.identity,compare:d})})}),l&&e.jsx(lt,{open:!!z,anchorEl:z,onClose:()=>R(null),children:e.jsxs(wn,{gap:2,children:[l({value:m,onChange:F}),e.jsx(Pe,{onClick:X,disabled:!m||Array.isArray(m)&&!m.length,children:"Apply filter"})]})})]})}const wn=v(N).withConfig({displayName:"Facet__CreateOptionContainer",componentId:"sc-szy15k-0"})(({theme:s})=>({padding:s.spacing(2)})),kn=v.div.withConfig({displayName:"Facet__FacetContainer",componentId:"sc-szy15k-1"})(({theme:s})=>({marginBottom:s.spacing(2),paddingBottom:s.spacing(1),borderBottom:`solid 1px ${s.palette.dividerLight}`})),Rn=v(g).withConfig({displayName:"Facet__FacetHeader",componentId:"sc-szy15k-2"})(({theme:s})=>({marginBottom:s.spacing(1),alignItems:"center"})),Sn=v.div.withConfig({displayName:"Facet__FacetInputs",componentId:"sc-szy15k-3"})(({theme:s})=>({}));function En({options:s,createdOptions:t,onDeleteOption:n,value:o,defaultValue:i,onValueChange:l,renderOption:r,compare:d}){const c=a.useCallback((f,h)=>y.some(h,$=>d($,f)),[d]),p=a.useCallback(f=>{const h=c(f,o)?o.filter($=>!d($,f)):[...o||[],f];l(h)},[d,c,l,o]),[x,j]=a.useState(!1),_=5,w=a.useMemo(()=>y.chain(s).sortBy(({value:f})=>!c(f,o)).value(),[c,s]),C=a.useMemo(()=>y.chain(w).slice(0,x?void 0:_).value(),[x,w]);return e.jsxs("div",{children:[t==null?void 0:t.map((f,h)=>e.jsx(cs,{checked:c(f,o),disabled:c(f,i),onChange:()=>p(f),label:r(f),canDelete:!c(f,i),onDelete:()=>n(h),count:void 0},h)),C==null?void 0:C.map(({count:f,value:h},$)=>e.jsx(cs,{checked:c(h,o),disabled:c(h,i),onChange:()=>p(h),label:r(h),count:f,onDelete:void 0,canDelete:void 0},$)),(x&&C.length===_||(s==null?void 0:s.length)>_)&&e.jsx(Pe,{size:"small",variant:"text",color:"primary",onClick:()=>j(!x),children:x?"Show less":`Show more (${s.length-_})`})]})}function cs({label:s,checked:t,disabled:n,onChange:o,count:i,onDelete:l,canDelete:r}){return e.jsxs(Tn,{grow:[0,1,0],gap:1,$disabled:n,onClick:()=>{n||o()},children:[e.jsx(at,{checked:t,disabled:n,color:"primary",size:"small",onChange:d=>{d.stopPropagation(),o()}}),e.jsx(u,{variant:"body2",component:"div",noWrap:!0,children:s}),i&&e.jsxs(Fn,{children:["(",i,")"]}),l&&e.jsx(H,{size:"small",onClick:l,style:{visibility:r?"visible":"hidden"},children:e.jsx(ct,{fontSize:"small"})})]})}const Fn=v(u).withConfig({displayName:"Facet__FacetOptionCounter",componentId:"sc-szy15k-4"})(["",""],({theme:s})=>`
    ${s.typography.body2};
    color: ${s.palette.text.secondary};
    text-align: right;
    width: 40px;
  `),Tn=v(g).withConfig({displayName:"Facet__FacetOptionContainer",componentId:"sc-szy15k-5"})(({theme:s,$disabled:t})=>({padding:s.spacing(1),alignItems:"center",borderRadius:s.shape.borderRadius/2,...!t&&{cursor:"pointer","&:hover":{background:s.palette.action.hover}}})),M=D.memo(In),$n=D.forwardRef(({data:s,values:t={},toggleButton:n,onChange:o,...i},l)=>e.jsxs(N,{ref:l,...i,children:[e.jsx(pe,{title:e.jsxs(e.Fragment,{children:[e.jsx(we,{color:"action"}),e.jsx(u,{variant:"subtitle1",children:"Filters"})]}),actions:n}),e.jsx(U,{grow:!0,scroll:!0,children:e.jsx(zn,{children:e.jsxs(Ls,{data:s,values:t,onValuesChange:o,children:[e.jsx(M,{label:"Severity",field:"violation_severity",renderOption:r=>e.jsx(de,{icon:e.jsx(_s,{severity:r}),label:dt[r]})}),e.jsx(M,{label:"Category",field:"violation_category",renderOption:r=>e.jsx(de,{icon:e.jsx(fs,{category:r,fontSize:"small"}),label:r})}),e.jsx(M,{label:"Action",field:"action_types",renderOption:r=>e.jsxs(g,{style:{alignItems:"center"},gap:1,children:[e.jsx(ge,{type:r,size:"small"}),e.jsx(u,{noWrap:!0,children:re(r)})]})}),e.jsx(M,{label:"Resource Type",field:"resource.type",renderOption:r=>e.jsxs(g,{style:{alignItems:"center"},gap:1,children:[e.jsx(G,{type:r,size:"small"}),e.jsx(u,{noWrap:!0,children:se(r)})]}),optionsSortBy:a.useCallback(r=>Oe(r.value),[])}),e.jsx(M,{label:"Impact",field:"impact_types",renderOption:r=>e.jsx(Be,{type:r})})]})})})]})),zn=v.div.withConfig({displayName:"EventResourcesFilters__Content",componentId:"sc-1tw54tn-0"})(({theme:s})=>({padding:s.spacing(2,3)}));function On(s){const t=Y();if(!s){if(!t)throw new Error("EventContext missing");s=t==null?void 0:t.eventId}const{data:n,...o}=Ae(Dn,{skip:!s,variables:{event_id:s}});return[n==null?void 0:n.impacts,o]}const Dn=ke`
  query EventImpacts($event_id: ID!) {
    impacts(event_id: $event_id) {
      type
      resource_ids
    }
  }
`;function Nn(s){const[t,...n]=On(s);return[a.useMemo(()=>{if(!t)return;const o={};for(const i of t)for(const l of i.resource_ids)o[l]||(o[l]=new Set),o[l].add(i.type);return y.chain(o).mapValues(i=>Array.from(i)).value()},[t]),...n]}const ds=["delete","modify","create"];function An({resources:s,ancestors:t,viewMode:n,groupByKey:o,treeOpen:i}){return a.useMemo(()=>{switch(n){case"tree":const l=y.chain(t).map(p=>({resource:p})).concat(s).value(),r=s.map(({resource:p})=>p.id),d=ut(l,r,{getId:p=>p.resource.id,getParent:p=>p.resource.parent});return[{key:"tree",value:"tree",children:pt(d,i)}];case"list":return y.chain(Pn(s,Ln[o])).map((p,x)=>({children:y.chain(p).sortBy(j=>Oe(j.resource.type)).value(),key:o,value:x})).sortBy(({value:p})=>o==="action_type"?ds.includes(p)?ds.indexOf(p):1/0:o==="resource_type"?Oe(p):o==="violation_severity"?-p:null).value();default:return[]}},[n,t,s,i,o])}const Ln={action_type:({action_types:s})=>s==null?void 0:s[0],resource_type:({resource:s})=>s==null?void 0:s.type,violation_severity:({violation_severity:s})=>s};function Pn(s,t){const n={};for(const o of s){const i=t(o),l=Array.isArray(i)?i:[i];for(const r of l)n[r]||(n[r]=[]),n[r].push(o)}return n}const Ps=D.forwardRef(({selectedResourceId:s,onResourceNavigation:t,title:n,...o},i)=>{var es,ss;const l=a.useRef(null),[r,{loading:d}]=Nn(),[c,p]=be("gb","action_type"),[x,j]=be("v","tree"),[,{loading:_}]=rs({skip:x!=="tree"}),[w,C]=a.useState(""),[f,h]=a.useState(w),$=xs(E=>{h(E)},500),A=a.useCallback(E=>{C(E),$(E)},[$]),[k,z]=be("rf",null),[R,m]=a.useState(!!k),[F,S]=a.useState({}),[L,B]=a.useState({}),{simulation:X,violationsBy:T}=Y(),[b,{loading:ye}]=K(),[O]=rs({skip:x!=="tree"}),Q=a.useMemo(()=>f||Object.keys(k||{}).length>0,[k,f]),q=a.useMemo(()=>{var E;return r?(E=b==null?void 0:b.sub_events)==null?void 0:E.filter(V=>!V.hidden).map(V=>({...V,impact_types:y.chain(V.resources).map(le=>r[le.id]).flatten().compact().uniq().value()})):b==null?void 0:b.sub_events},[b==null?void 0:b.sub_events,r]),_e=is({violationsByResourceId:T.resourceId,subEvents:q,filtersValues:null,searchPhrase:""}),Xe=is({violationsByResourceId:T.resourceId,subEvents:q,filtersValues:k,searchPhrase:f}),ie=An({resources:Xe,ancestors:O,viewMode:x,groupByKey:c,treeOpen:L}),Hs=a.useCallback(E=>{p(E)},[p]);a.useEffect(()=>{S({})},[c]),a.useEffect(()=>{if(x==="tree"){const E=y.chain(b==null?void 0:b.sub_events).map("resources").flatten().concat(O).value();B(y.chain(E).keyBy("id").mapValues(()=>!0).value())}},[O,b==null?void 0:b.sub_events,x]),a.useEffect(()=>{ie.length===1?S({0:!0}):S({})},[c,ie,x]),a.useEffect(()=>{if(s){const E=ie.findIndex(V=>V.children.find(le=>{var he;return((he=le.resource)==null?void 0:he.id)===s}));E>-1&&(S({[E]:!0}),setTimeout(()=>l.current&&l.current.scrollTo(({child:V})=>{var le,he,ts;return((ts=(he=((le=V==null?void 0:V.node)==null?void 0:le.item)||V)==null?void 0:he.resource)==null?void 0:ts.id)===s}),0))}},[ie,s]);const Us=a.useMemo(()=>({treeOpen:L,setTreeOpen:B,selectedResourceId:s,onResourceNavigation:t}),[L,s,t]),Ze=R?e.jsxs(e.Fragment,{children:[Q&&e.jsx(te,{variant:"text",size:"small",onClick:()=>z({}),children:"Clear"}),e.jsx(We,{open:!0,onClick:()=>m(!1)})]}):e.jsx(te,{variant:"text",size:"small",selected:Q,startIcon:e.jsx(we,{fontSize:"small"}),onClick:()=>m(!0),children:"Filters"}),Ys=a.useCallback(E=>(E==null?void 0:E.children)||[],[]),Qs=a.useCallback(E=>{var V;return((V=E.children)==null?void 0:V.length)||0},[]),Js=Bs(X,b==null?void 0:b.sub_events);return e.jsxs(Ce,{paper:!0,row:!0,ref:i,...o,children:[e.jsx(Vn,{open:R,children:e.jsx(U,{grow:!0,children:e.jsx($n,{data:_e,values:k,onChange:z,toggleButton:Ze})})}),e.jsxs(Ce,{grow:!0,column:!0,children:[((es=b==null?void 0:b.sub_events)==null?void 0:es.length)>0&&e.jsx(pe,{title:e.jsxs(e.Fragment,{children:[!R&&e.jsxs(e.Fragment,{children:[Ze,e.jsx(Re,{light:!0,flexItem:!0,orientation:"vertical"})]}),n?e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"subtitle1",noWrap:!0,children:n}),e.jsxs(u,{color:"textSecondary",children:["(",((ss=b==null?void 0:b.sub_events)==null?void 0:ss.length)||0,")"]})]}):e.jsx(Bn,{gap:1,children:e.jsx(u,{variant:"subtitle1",noWrap:!0,children:ye?e.jsx(oe,{width:200}):Q?`${Xe.length} out of ${_e.length} matching resources`:Js})}),(d||_)&&e.jsx(Ve,{size:15})]}),actions:e.jsxs(g,{gap:2,style:{overflow:"visible",alignItems:"center"},children:[e.jsx("div",{children:e.jsx(me,{placeholder:"Search by resource name or ID",variant:"outlined",value:w,size:"small",style:{width:260},onChange:E=>A(E.target.value),InputProps:{endAdornment:e.jsx(ht,{fontSize:"small",color:"action"})}})}),x==="list"&&e.jsx(Zn,{value:c,onChange:Hs}),e.jsx(Kn,{value:x,onChange:E=>j(E)})]})}),e.jsx(U,{grow:!0,children:e.jsx(Wn,{...o,children:ye||(q==null?void 0:q.length)>0?e.jsx(Vs.Provider,{value:Us,children:e.jsx(bs,{ref:l,open:F,groups:ie,count:ie.length,getChildren:Ys,getChildrenCount:Qs,HeaderComponent:Mn,ChildComponent:Un,onOpenChange:S})}):e.jsx(J,{children:X&&((b==null?void 0:b.status)==="failed"?e.jsx(u,{variant:"subtitle1",children:"Failed to process simulation"}):(b==null?void 0:b.status)==="processing"?e.jsx(u,{variant:"subtitle1",children:"Processing simulation"}):(b==null?void 0:b.status)==="pending"?e.jsx(u,{variant:"subtitle1",children:"Simulation is pending"}):(b==null?void 0:b.status)==="error"?e.jsx(u,{variant:"subtitle1",children:"An error occurred while processing the simulation"}):e.jsx(u,{variant:"subtitle1",children:"Changes to supported resources were not found in the Terraform plan"}))})})})]})]})}),Bs=(s,t)=>{const n=a.useMemo(()=>{var o;return y.uniqBy((o=t==null?void 0:t.filter(i=>!i.hidden))==null?void 0:o.reduce((i,l)=>[...i,...l.resources],[]),"id").length},[t]);return s?n===1?"1 Resource to be changed":`${n} Resources to be changed`:n===1?"1 Changed resource":`${n} Changed resources`},Bn=v(g).withConfig({displayName:"EventResources__TitleWrapper",componentId:"sc-1cog2wh-0"})({flexWrap:"wrap",alignItems:"center"}),Vn=v.div.withConfig({displayName:"EventResources__FiltersDrawer",componentId:"sc-1cog2wh-1"})(({theme:s,open:t})=>({maxWidth:t?300:0,minWidth:t?300:0,transition:"max-width 250ms ease-out",background:ce(s.palette.background.default,.5),overflow:"hidden",display:"flex",flexDirection:"column"})),Vs=D.createContext(void 0),Wn=v.div.withConfig({displayName:"EventResources__Content",componentId:"sc-1cog2wh-2"})(({theme:s})=>({overflow:"auto"})),Mn=a.forwardRef(({group:s,open:t,onToggle:n},o)=>{const i=t?Me:Ge;return e.jsxs(Gn,{gap:2,grow:!0,ref:o,onClick:n,children:[e.jsxs(g,{gap:1,style:{overflow:"auto",alignItems:"center"},children:[e.jsx(i,{color:"action",fontSize:"small"}),e.jsx(qn,{group:s}),e.jsx(Hn,{group:s})]}),t&&s.key!=="violation_severity"&&e.jsx(u,{component:"div",variant:"body2",color:"textSecondary",noWrap:!0,children:{action_type:"Resource Type",resource_type:"Action",tree:e.jsxs(g,{gap:2,grow:!0,style:{overflow:"auto"},children:[e.jsx(u,{variant:"body2",noWrap:!0,style:{flexGrow:2,maxWidth:300},children:"Type"}),e.jsx(u,{variant:"body2",noWrap:!0,style:{flexGrow:1},children:"Action"})]})}[s.key]}),t&&e.jsx(u,{variant:"body2",color:"textSecondary",noWrap:!0,children:"Impacts"}),t&&s.key!=="violation_severity"&&e.jsx(u,{variant:"body2",color:"textSecondary",noWrap:!0,children:"Violations"}),t&&e.jsx(qe,{children:e.jsx(u,{variant:"body2",color:"textSecondary",noWrap:!0,children:"Predicted Cost"})})]})}),Gn=v(g).withConfig({displayName:"EventResources__Header",componentId:"sc-1cog2wh-3"})(({theme:s})=>({padding:s.spacing(2,1),alignItems:"center",borderBottom:`solid 1px ${s.palette.dividerLight}`,cursor:"pointer","&:hover":{background:s.palette.action.hover},"& > *:first-child":{flexGrow:"2 !important",maxWidth:450}})),qn=({group:s,...t})=>{switch(s.key){case"action_type":return e.jsx(ge,{type:s.value,size:"small",...t});case"resource_type":return e.jsx(G,{type:s.value,size:"small",...t});case"tree":return e.jsx(Is,{color:"action",fontSize:"small"});default:return e.jsx(e.Fragment,{})}},Hn=({group:s})=>{const t=(()=>{switch(s.key){case"action_type":return re(s.value);case"resource_type":return se(s.value);case"violation_severity":return e.jsx(de,{icon:e.jsx(_s,{severity:s.value}),label:yt(s.value)});case"tree":return"Resource";default:return!1}})(),n=(()=>{switch(s.key){case"tree":return!1;default:return s.children.length}})();return e.jsxs(g,{gap:1,style:{overflow:"auto",alignItems:"center"},children:[e.jsx(u,{variant:"subtitle1",noWrap:!0,style:{flexGrow:1},children:t}),n&&e.jsxs(u,{variant:"subtitle2",color:"textSecondary",children:["(",n,")"]})]})},Un=a.forwardRef(({child:s,group:t,childIndex:n},o)=>{var k,z,R;const i=Ne(),{violationsBy:l}=Y(),r=Se(),d=a.useContext(Vs);if(!d)throw new Error("Child component must be wrapped within Context.Provider");const{treeOpen:c,setTreeOpen:p,selectedResourceId:x,onResourceNavigation:j}=d;function _(m){m.stopPropagation(),p(F=>({...F,[h.id]:!F[h.id]}))}const w=((k=s.node)==null?void 0:k.item)||s,C=w.action_types,f=w.impact_types,h=w.resource,$=a.useMemo(()=>{var m;return Array.from(new Set(((m=w.sub_events)==null?void 0:m.map(F=>F.predicted_cost).filter(Boolean))||[]))},[w.sub_events]),A=a.useMemo(()=>y.chain(l.resourceId[h.id]).map(({count:m,byCategory:F},S)=>({count:m,severity:S,byCategory:F})).sortBy("severity").value(),[h.id,l.resourceId]);return e.jsxs(Jn,{grow:!0,gap:2,ref:o,index:n,selected:x===h.id,onClick:(C==null?void 0:C.length)>0?()=>{const m=j==null?void 0:j(h.id);r({resourceId:h.id},{prevLocation:{pathname:window.location.pathname,search:window.location.search,state:m}})}:void 0,children:[e.jsxs(Qn,{gap:1,children:[e.jsx(H,{size:"small",style:{visibility:t.key==="tree"&&((R=(z=s.node)==null?void 0:z.children)==null?void 0:R.length)>0?"visible":"hidden",...typeof s.depth<"u"&&{marginLeft:s.depth*i.spacing(2)}},onClick:_,children:c[h==null?void 0:h.id]?e.jsx(Me,{fontSize:"small",color:"action"}):e.jsx(Ge,{fontSize:"small",color:"action"})}),e.jsx("div",{style:{overflow:"hidden"},children:e.jsxs(g,{style:{alignItems:"center"},gap:1,children:[t.key!=="resource_type"&&e.jsx(G,{type:h==null?void 0:h.type,id:h==null?void 0:h.id,size:"small"}),e.jsx(ue,{children:e.jsx(u,{variant:"body2",noWrap:!0,children:(h==null?void 0:h.display_name)||(h==null?void 0:h.id)})})]})}),e.jsx(Cs,{resource:h,size:"small",className:"menu-btn"})]}),{action_type:e.jsx(u,{variant:"body2",color:"textSecondary",noWrap:!0,children:se(h==null?void 0:h.type)||(h==null?void 0:h.type)}),resource_type:e.jsx(g,{style:{alignItems:"center"},gap:1,children:C==null?void 0:C.map(m=>e.jsxs(g,{style:{alignItems:"center"},gap:1,children:[e.jsx(ge,{type:m,fontSize:"small"}),e.jsx(u,{variant:"body2",color:"textSecondary",noWrap:!0,children:re(m)})]},m))}),tree:e.jsxs(g,{grow:!0,gap:2,style:{overflow:"auto"},children:[e.jsx(u,{variant:"body2",color:"textSecondary",noWrap:!0,style:{flexGrow:2,maxWidth:300},children:se(h==null?void 0:h.type)||(h==null?void 0:h.type)}),e.jsx(g,{gap:1,style:{flexGrow:1,alignItems:"center"},children:C==null?void 0:C.map(m=>e.jsxs(g,{style:{alignItems:"center"},gap:1,children:[e.jsx(ge,{type:m,fontSize:"small"}),e.jsx(u,{variant:"body2",color:"textSecondary",noWrap:!0,children:re(m)})]},m))})]})}[t.key],e.jsx(g,{gap:1,children:f==null?void 0:f.map(m=>e.jsx(Be,{type:m},m))}),t.key!=="violation_severity"&&e.jsx(g,{gap:1,children:y.map(A,({count:m,severity:F,byCategory:S})=>e.jsx(ee,{title:e.jsx(Yn,{byCategory:S}),children:e.jsx("span",{children:e.jsx(jt,{severity:F,count:m})},F)},F))}),e.jsx(qe,{children:e.jsx(g,{gap:1,children:$.length>0?$.map(m=>e.jsx(De,{predictedCost:m},m)):e.jsx(De,{predictedCost:null})})})]})}),Yn=({byCategory:s})=>e.jsx(N,{gap:1,children:y.map(s,(t,n)=>e.jsx(de,{icon:e.jsx(de,{icon:e.jsx(fs,{category:n,fontSize:"small",color:"action"}),label:n},n),label:`(${t})`,labelColor:"textSecondary"},n))}),Qn=v(g).withConfig({displayName:"EventResources__ResourceWrapper",componentId:"sc-1cog2wh-4"})(()=>({alignItems:"center","& .menu-btn":{display:"none"},"&:hover .menu-btn":{display:"block"}})),Jn=v(g).withConfig({displayName:"EventResources__Child",componentId:"sc-1cog2wh-5"})(({theme:s,index:t,selected:n,onClick:o})=>({alignItems:"center",padding:s.spacing(1),minHeight:40,borderBottom:`solid 1px ${s.palette.dividerLight}`,...n&&{background:s.palette.action.selected},transition:"background 250ms ease-out",...!n&&t%2===0&&{background:ce(s.palette.background.default,.4)},...o&&{cursor:"pointer","&:hover":{background:s.palette.action.hover}},"& > *:first-child":{flexGrow:"2 !important",maxWidth:450,"& > *:first-child":{marginLeft:s.spacing(2)}}}));function Kn({value:s,onChange:t}){return e.jsxs(g,{gap:1,style:{alignItems:"center"},children:[e.jsx(u,{color:"textSecondary",variant:"caption",children:"View"}),e.jsxs(Xn,{children:[e.jsx(ee,{title:"Hierarchy",children:e.jsx(H,{selected:s==="tree",onClick:()=>t("tree"),children:e.jsx(mt,{fontSize:"small"})})}),e.jsx(ee,{title:"List",children:e.jsx(H,{selected:s==="list",onClick:()=>t("list"),children:e.jsx(vs,{fontSize:"small"})})})]})]})}const Xn=v(g).withConfig({displayName:"EventResources__ViewModeButtons",componentId:"sc-1cog2wh-6"})(({theme:s})=>({border:`solid 1px ${s.palette.dividerLight}`,borderRadius:s.shape.borderRadius}));function Zn({value:s,disabled:t=!1,onChange:n}){const[o,i]=a.useState(void 0),l=a.useMemo(()=>({action_type:"Action",resource_type:"Type",violation_severity:"Severity"})[s],[s]);function r(d){i(void 0),n(d)}return e.jsxs(e.Fragment,{children:[e.jsxs(g,{style:{alignItems:"center"},gap:1,children:[e.jsx(u,{variant:"caption",color:"textSecondary",noWrap:!0,children:"Group by"}),e.jsxs(so,{onClick:d=>!t&&i(d.target),disabled:t,children:[l?e.jsx(eo,{children:l}):e.jsx(u,{variant:"body2",children:"None"}),e.jsx(xt,{color:"action",fontSize:"small"})]})]}),e.jsxs(gt,{open:!!o,onClose:()=>i(void 0),anchorEl:o,children:[e.jsx(xe,{selected:s==="action_type",onClick:()=>r("action_type"),children:"Action"}),e.jsx(xe,{selected:s==="resource_type",onClick:()=>r("resource_type"),children:"Resource Type"}),e.jsx(xe,{selected:s==="violation_severity",onClick:()=>r("violation_severity"),children:"Severity"})]})]})}const eo=v(u).withConfig({displayName:"EventResources__GroupByValueTypography",componentId:"sc-1cog2wh-7"})(({theme:s})=>({fontWeight:s.typography.fontWeightMedium,fontSize:s.typography.body2.fontSize,color:s.palette.primary.main})),so=v(g).withConfig({displayName:"EventResources__SelectContainer",componentId:"sc-1cog2wh-8"})(({theme:s,disabled:t})=>({border:`solid 1px ${s.palette.dividerLight}`,borderRadius:s.shape.borderRadius/2,padding:s.spacing(1),cursor:t?"default":"pointer",opacity:t?.3:1,...!t&&{"&:hover":{background:s.palette.action.hover}}})),us={Github:{getPRLink:(s,t)=>`https://github.com/${s}/pull/${t}`,getCommitLink:(s,t)=>`https://github.com/${s}/commit/${t}`},Bitbucket:{getPRLink:(s,t)=>`https://bitbucket.org/${s}/pull-requests/${t}`,getCommitLink:(s,t)=>`https://bitbucket.org/${s}/commits/${t}`}},to=({open:s,toggleButton:t,onSkippedClick:n,...o})=>{var $,A,k,z;const{simulation:i,violationsBy:l}=Y(),[r,{loading:d}]=K(),c=r==null?void 0:r.source,p=($=r==null?void 0:r.source)==null?void 0:$.metadata,x=_t(r==null?void 0:r.timestamp),j=a.useMemo(()=>{var R;return(R=r==null?void 0:r.sub_events)==null?void 0:R.find(m=>m.is_base)},[r==null?void 0:r.sub_events]);a.useMemo(()=>r==null?void 0:r.raw_event,[r==null?void 0:r.raw_event]);const _=a.useMemo(()=>y.groupBy(r==null?void 0:r.sub_events,"action_type"),[r==null?void 0:r.sub_events]),w=a.useMemo(()=>y.chain(r==null?void 0:r.sub_events).groupBy("cloud_provider").mapValues(R=>y.chain(R).groupBy("account_id").mapValues(m=>y.groupBy(m,"region")).value()).value(),[r==null?void 0:r.sub_events]),C=ft(),f=Bs(i,r==null?void 0:r.sub_events),h=a.useMemo(()=>l.severity&&Object.keys(l.severity).length>0,[l]);return e.jsxs(oo,{open:s,...o,children:[e.jsxs(pe,{children:[e.jsx(He,{color:"action"}),e.jsx(u,{variant:"subtitle1",children:"Details"}),e.jsx(U,{grow:!0,children:e.jsx(g,{style:{justifyContent:"flex-end"},children:t})})]}),e.jsxs(ao,{children:[e.jsx(ee,{placement:"top",title:"Timestamp",children:e.jsxs(P,{children:[e.jsx(ws,{color:"action",fontSize:"small"}),e.jsx(ps,{children:d?e.jsx(oe,{width:150}):x})]})}),!i&&j&&e.jsxs(e.Fragment,{children:[e.jsx(fe,{Icon:bt,label:"Event Name",value:r.event_name||re(j.action_type)}),e.jsx(fe,{Icon:vt,label:"User Agent",value:j.user_agent}),e.jsx(fe,{Icon:Ue,label:"User/Role ARN",value:j.cloud_user_arn}),e.jsx(fe,{Icon:Ct,label:"Source IP",value:j.cloud_source_ip})]}),(d||(c==null?void 0:c.format))&&e.jsxs(P,{children:[e.jsx(bn,{format:c==null?void 0:c.format}),e.jsx(ps,{children:d?e.jsx(oe,{width:50}):c==null?void 0:c.format})]}),d&&!r&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{}),e.jsx($e,{width:100}),e.jsx($e,{width:150}),e.jsx($e,{})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{}),e.jsxs(P,{children:[e.jsx(ls,{color:"action",fontSize:"small"}),e.jsx(u,{variant:"subtitle2",noWrap:!0,children:"Risks Summary"})]}),!h&&e.jsxs(P,{children:[e.jsx(ls,{color:"action",fontSize:"small",style:{visibility:"hidden"}}),e.jsx(u,{color:"textSecondary",noWrap:!0,children:"No Risks"})]}),e.jsx(uo,{})]}),(r==null?void 0:r.predicted_cost)&&e.jsxs(qe,{children:[e.jsx(Z,{}),e.jsxs(N,{children:[e.jsxs(P,{center:!0,children:[e.jsx(It,{color:"action"}),e.jsx(u,{variant:"subtitle",noWrap:!0,children:"Predicted Cost"})]}),e.jsx(P,{children:e.jsxs(N,{children:[e.jsx(De,{predictedCost:r.predicted_cost}),e.jsx(u,{color:"textSecondary",children:"Predicted Monthly Change"})]})})]})]}),(c==null?void 0:c.type)==="TerraformCloud"&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{}),e.jsx(Te,{source:c}),e.jsx(lo,{metadata:p})]}),((c==null?void 0:c.type)==="Github"||(c==null?void 0:c.type)==="Bitbucket")&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{}),e.jsx(Te,{source:c}),e.jsx(io,{metadata:p,type:c.type})]}),(c==null?void 0:c.type)==="kubernetes"&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{}),e.jsx(Te,{source:c}),e.jsx(ro,{metadata:p})]}),r&&e.jsxs(e.Fragment,{children:[((A=r.sub_events)==null?void 0:A.length)>0&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{}),e.jsxs(P,{children:[e.jsx(Is,{color:"action",fontSize:"small"}),e.jsx(u,{variant:"subtitle2",noWrap:!0,children:f})]})]}),e.jsx(ze,{actionType:"delete",actionTypeMap:_}),e.jsx(ze,{actionType:"modify",actionTypeMap:_}),e.jsx(ze,{actionType:"create",actionTypeMap:_}),((k=r==null?void 0:r.errors)==null?void 0:k.length)>0&&e.jsxs(P,{children:[e.jsx(ks,{color:"action",fontSize:"small"}),e.jsx(no,{noWrap:!0,onClick:n,children:`Skipped (${(z=r==null?void 0:r.errors)==null?void 0:z.length})`})]}),e.jsx(Z,{})]}),!d&&!y.isEmpty(w)&&e.jsxs(P,{children:[e.jsx(wt,{color:"action",fontSize:"small"}),e.jsx(u,{variant:"subtitle2",noWrap:!0,children:i?"Simulation Scope":"Event Scope"})]}),y.map(w,(R,m)=>e.jsxs(D.Fragment,{children:[e.jsxs(P,{children:[e.jsx(G,{type:"Cloud",id:m,size:"small"}),e.jsx(u,{variant:"subtitle2",noWrap:!0,children:m})]}),y.map(R,(F,S)=>e.jsxs(D.Fragment,{children:[e.jsxs(P,{children:[e.jsx(G,{type:"Account",size:"small"}),e.jsx(u,{variant:"body2",noWrap:!0,children:C(S)})]}),y.map(F,(L,B)=>e.jsx(D.Fragment,{children:e.jsxs(P,{children:[e.jsx(G,{type:"Region",size:"small"}),e.jsx(u,{variant:"body2",noWrap:!0,children:B})]})},B))]},S))]},m))]})]})},no=v.a.withConfig({displayName:"EventDetails__SkippedTypography",componentId:"sc-gs43q2-0"})(({theme:s})=>({...s.typography.subtitle2,color:s.palette.common.orange,cursor:"pointer"})),ps=s=>e.jsx(ue,{children:e.jsx(u,{variant:"body2",noWrap:!0,...s})}),Te=({source:s})=>e.jsxs(P,{children:[e.jsx(vn,{type:s==null?void 0:s.type}),e.jsx(u,{variant:"body2",noWrap:!0,children:re(s==null?void 0:s.type)})]}),$e=({width:s=100})=>e.jsxs(P,{children:[e.jsx(oe,{variant:"circle",children:e.jsx(ws,{color:"action",fontSize:"small"})}),e.jsx(u,{variant:"body2",children:e.jsx(oe,{width:s})})]}),oo=v(N).withConfig({displayName:"EventDetails__Container",componentId:"sc-gs43q2-1"})(({theme:s,open:t})=>({maxWidth:t?300:0,transition:"all 250ms ease-out",overflow:"hidden"}));function ze({actionType:s,actionTypeMap:t}){return t[s]?e.jsxs(P,{children:[e.jsx(ge,{type:s}),e.jsx(u,{variant:"body2",noWrap:!0,children:`${re(s)} (${t[s].length})`})]}):!1}function ro({metadata:s}){return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Cluster",Icon:()=>e.jsx(G,{type:"eks",size:"small"}),label:s==null?void 0:s.event_cluster}),e.jsx(W,{title:"Namespace",Icon:()=>e.jsx(G,{type:"namespace",size:"small"}),label:s==null?void 0:s.event_namespace})]})}function io({metadata:s,type:t}){var n,o,i;return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Branch",Icon:Ie,label:`${s==null?void 0:s.branch}${s!=null&&s.base_branch?s!=null&&s.branch?` -> ${s==null?void 0:s.base_branch}`:s==null?void 0:s.base_branch:""}`}),e.jsx(W,{title:"Pull Request",Icon:Ie,url:(n=us[t])==null?void 0:n.getPRLink(s==null?void 0:s.repository,s==null?void 0:s.pr_id),label:(s==null?void 0:s.pr_id)&&`#${s.pr_id}`}),e.jsx(W,{title:"Commit",label:(o=s==null?void 0:s.commit_hash)==null?void 0:o.slice(0,7),url:(i=us[t])==null?void 0:i.getCommitLink(s==null?void 0:s.repository,s==null?void 0:s.commit_hash),Icon:Et}),e.jsx(W,{title:"Commit Message",label:s==null?void 0:s.commit_message,Icon:Rs}),e.jsx(W,{title:"Username",label:s==null?void 0:s.user_name,Icon:Ue})]})}function lo({metadata:s}){var t,n,o;return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Branch",Icon:Ie,label:s==null?void 0:s.branch}),e.jsx(W,{title:"Pull Request",Icon:Ie,url:s.pull_request_url,label:s.pull_request_url&&`#${s.pull_request_url.split("/").pop()}`}),e.jsx(W,{title:"Terraform Cloud Workspace",label:s==null?void 0:s.workspace_name,url:s==null?void 0:s.workspace_app_url,Icon:St}),e.jsx(W,{title:"Terraform Cloud Run",label:s==null?void 0:s.run_id,url:s==null?void 0:s.run_app_url,Icon:as}),e.jsx(W,{title:"Commit",label:(o=(n=(t=s==null?void 0:s.commit_url)==null?void 0:t.split("/"))==null?void 0:n.pop())==null?void 0:o.slice(0,7),url:s==null?void 0:s.commit_url,Icon:as}),e.jsx(W,{title:"Run message",Icon:Rs,label:s==null?void 0:s.run_message}),e.jsx(W,{title:"Username",label:s==null?void 0:s.user_name,Icon:Ue})]})}const Z=v(Re).withConfig({displayName:"EventDetails__Divider",componentId:"sc-gs43q2-2"})(({theme:s})=>({margin:s.spacing(1)}));Z.defaultProps={light:!0};function W({Icon:s,label:t,url:n,title:o}){return t?e.jsxs(P,{children:[e.jsx(ee,{title:o,children:e.jsx(s,{color:"action",fontSize:"small"})}),n?e.jsx("a",{href:n,target:"_blank",rel:"noreferrer",children:t}):e.jsx(u,{variant:"body2",children:t})]}):!1}const ao=v.div.withConfig({displayName:"EventDetails__DetailsContent",componentId:"sc-gs43q2-3"})(({theme:s})=>({padding:s.spacing(1),paddingLeft:s.spacing(1.5),overflow:"auto",flexGrow:1,flexBasis:0})),P=D.forwardRef((s,t)=>e.jsx(Ws,{ref:t,gap:1,...s}));function fe({Icon:s,label:t,value:n}){const o=Zs();return n?e.jsxs(co,{gap:1,children:[e.jsxs(N,{gap:1,style:{flexGrow:1},children:[e.jsxs(g,{gap:1,children:[e.jsx(s,{color:"action",fontSize:"small"}),e.jsx(u,{variant:"body2",color:"textSecondary",children:t})]}),e.jsxs(g,{gap:1,children:[e.jsx(s,{fontSize:"small",style:{visibility:"hidden"}}),e.jsx(u,{variant:"body2",style:{wordBreak:"break-all"},children:n})]})]}),e.jsx(H,{className:"hide",size:"small",onClick:()=>o(n),children:e.jsx(kt,{fontSize:"small"})})]}):e.jsx(D.Fragment,{})}const Ws=v(g).withConfig({displayName:"EventDetails__PaddedLayoutRow",componentId:"sc-gs43q2-4"})(({theme:s,indent:t,center:n,dense:o})=>({padding:o?0:s.spacing(1),...t&&{paddingLeft:30},...n&&{alignItems:"center"}})),co=v(Ws).withConfig({displayName:"EventDetails__DetailPaddedRow",componentId:"sc-gs43q2-5"})(({theme:s})=>({padding:s.spacing(1),alignItems:"flex-end","& .hide":{visibility:"hidden"},"&:hover .hide":{visibility:"visible"}}));function uo(){const{eventId:s,simulation:t,violationsBy:n}=Y(),o=Se(),i=a.useCallback(l=>{o({eventId:s,simulation:t,section:"risks",filters:{severity:[l]}})},[s,o,t]);return e.jsx(Rt,{data:n.severity,onClick:i})}const po=D.forwardRef(({...s},t)=>{const[n,o]=a.useState({0:!0}),[i]=K(),l=a.useMemo(()=>{var r;return((r=i==null?void 0:i.errors)==null?void 0:r.length)>0?[{key:"skipped",value:"skipped",children:i.errors}]:[]},[i==null?void 0:i.errors]);return e.jsx(ho,{...s,children:e.jsx(bs,{open:n,groups:l,count:l.length,getChildren:a.useCallback(r=>(r==null?void 0:r.children)||[],[]),getChildrenCount:a.useCallback(r=>{var d;return((d=r.children)==null?void 0:d.length)||0},[]),HeaderComponent:xo,ChildComponent:jo,onOpenChange:o})})}),ho=v.div.withConfig({displayName:"EventExceptions__Container",componentId:"sc-12riq0d-0"})(({theme:s})=>({margin:s.spacing(2),overflow:"auto"})),xo=a.forwardRef(({group:s,open:t,onToggle:n},o)=>{const i=t?Me:Ge;return e.jsx(go,{gap:2,grow:!0,ref:o,onClick:n,children:e.jsxs(g,{gap:1,style:{flexGrow:2,alignItems:"center",overflow:"auto"},children:[e.jsx(i,{color:"action",fontSize:"small"}),e.jsx(ks,{color:"action",fontSize:"small"}),e.jsx(mo,{group:s})]})})}),go=v(g).withConfig({displayName:"EventExceptions__Header",componentId:"sc-12riq0d-1"})(({theme:s})=>({padding:s.spacing(2,1),alignItems:"center",borderBottom:`solid 1px ${s.palette.dividerLight}`,borderRadius:s.shape.borderRadius,cursor:"pointer","&:hover":{background:s.palette.action.hover}})),mo=({group:s})=>{const t="Skipped resources",n=s.children.length;return e.jsxs(g,{gap:1,style:{overflow:"auto",alignItems:"center"},children:[e.jsx(u,{variant:"subtitle1",noWrap:!0,style:{flexGrow:1},children:t}),n&&e.jsxs(u,{variant:"subtitle2",color:"textSecondary",children:["(",s.children.length,")"]})]})},jo=a.forwardRef(({child:s,group:t,childIndex:n},o)=>e.jsx(yo,{grow:!0,gap:2,ref:o,index:n,children:e.jsx("div",{style:{flexGrow:2},children:e.jsx(u,{variant:"body2",children:s.message})})})),yo=v(g).withConfig({displayName:"EventExceptions__Child",componentId:"sc-12riq0d-2"})(({theme:s,index:t})=>({alignItems:"center",padding:s.spacing(2),minHeight:40,borderRadius:s.shape.borderRadius,borderBottom:`solid 1px ${s.palette.dividerLight}`,...t%2===0&&{background:ce(s.palette.background.default,.4)}}));function _o({query:s,filters:t}){const{data:n}=Ae(ke`
      query FlowGroupsValues($query: FlowsQuery, $filters: [FlowFilter]) {
        flowGroups(query: $query, filters: $filters) {
          total_count
          values {
            ids {
              ...FacetFragment
            }
            source_ids {
              ...FacetFragment
            }
            destination_ids {
              ...FacetFragment
            }
            intermediate_ids {
              ...FacetFragment
            }
            source_types {
              ...FacetFragment
            }
            destination_types {
              ...FacetFragment
            }
            source_location_ids {
              ...FacetFragment
            }
            destination_location_ids {
              ...FacetFragment
            }
            resource_types {
              ...FacetFragment
            }
            impact_types {
              ...FacetFragment
            }
          }
        }
      }
      fragment FacetFragment on FacetValue {
        value
        count
      }
    `,{skip:!s,variables:{query:s,filters:t}});return a.useMemo(()=>(n==null?void 0:n.flowGroups)||{},[n==null?void 0:n.flowGroups])}function fo({selected:s,resources:t,onSelect:n,onDeselect:o,onScrollEnd:i,...l}){return e.jsx(vo,{...l,children:!t||t.length>0?e.jsx(Ft,{data:t,itemCount:t==null?void 0:t.length,itemSize:35,children:({index:r,style:d})=>{var c;return e.jsx(Co,{resource:t[r],style:d,index:r,selected:s[(c=t[r])==null?void 0:c.id],onSelect:n,onDeselect:o})}}):e.jsx(bo,{children:e.jsx(u,{color:"textSecondary",children:"No matches found"})})})}const bo=v.div.withConfig({displayName:"ResourcesList__NoResultsContainer",componentId:"sc-1gq4a4d-0"})(({theme:s})=>({display:"flex",alignItems:"center",justifyContent:"center",padding:s.spacing(2)})),vo=v.div.withConfig({displayName:"ResourcesList__Container",componentId:"sc-1gq4a4d-1"})(({theme:s})=>({minHeight:200,maxHeight:400,minWidth:400,border:`solid 1px ${s.palette.dividerLight}`,borderRadius:s.shape.borderRadius,overflow:"hidden"}));function Co({resource:s,selected:t,onSelect:n,onDeselect:o,...i}){const l=Ro(),r=a.useCallback(p=>{n({resource_id:s.id,position:p})},[n,s.id]),d=a.useCallback(()=>{o(s.id)},[o,s.id]),c=a.useCallback(()=>{t?d():r("ANY")},[d,r,t]);return e.jsxs(ko,{gap:1,grow:[0,0,1,0],className:Tt({checked:!!t,disabled:!l[s.id]}),...i,children:[e.jsx($t,{checked:!!t,size:"small",color:"primary",onChange:c,disabled:!l[s.id]}),e.jsx(G,{type:s.type,id:s.id,size:"small",className:"icon"}),e.jsx(u,{noWrap:!0,className:"label",children:s.display_name||s.id}),e.jsx("div",{className:"position-input",children:["SRC","INTR","DST","ANY"].map(p=>{var x;return e.jsx(Io,{position:p,onClick:()=>r(p),selected:p===(t==null?void 0:t.position),disabled:!((x=l[s.id])!=null&&x.includes(p))},p)})})]})}function Io({position:s,selected:t,disabled:n,onClick:o}){const i=e.jsx(te,{size:"small",variant:"text",onClick:o,selected:t,disabled:n,children:s});return n?i:e.jsx(ee,{title:wo(s),children:i},s)}function wo(s){return{SRC:"Source",DST:"Destination",INTR:"Intermediate",ANY:"Any"}[s]||s}const ko=v(g).withConfig({displayName:"ResourcesList__ResourceBox",componentId:"sc-1gq4a4d-2"})(({theme:s,index:t})=>({alignItems:"center",padding:s.spacing(1),borderBottom:`solid 1px ${s.palette.dividerLight}`,background:t%2===0?s.palette.background.default:"transparent","&.disabled":{"& .icon, & .label":{opacity:s.palette.action.disabledOpacity}},"& .position-input":{display:"none"},"&:hover, &.checked":{"& .position-input":{display:"block"},"&.disabled":{"& .position-input":{display:"none"}}}}));function Ro(){const{facets:{ids:s,source_ids:t,destination_ids:n,intermediate_ids:o}}=Je(),i=a.useCallback((l,r)=>(l==null?void 0:l.map(({value:d})=>({id:d,position:r})))||[],[]);return a.useMemo(()=>{const l=[...i(s,"ANY"),...i(t,"SRC"),...i(n,"DST"),...i(o,"INTR")];return y.chain(l).groupBy("id").mapValues(r=>r.map(d=>d.position)).value()},[n,s,o,i,t])}function So({phrase:s,query:t,limit:n=100}){return zt({query:Eo,limit:n,variables:{phrase:s,query:t},getResults:o=>{var i;return(i=o==null?void 0:o.flowResources)==null?void 0:i.results},getTotalCount:o=>{var i;return(i=o==null?void 0:o.flowResources)==null?void 0:i.total_count}})}const Eo=ke`
  query ResourcesListQuery(
    $phrase: String
    $query: FlowsQuery
    $skip: Int
    $limit: Int
  ) {
    flowResources(phrase: $phrase, query: $query, skip: $skip, limit: $limit) {
      total_count
      results {
        id
        type
        display_name
      }
    }
  }
`;function Fo({value:s,onChange:t}){const[n,o]=a.useState(),[i]=K(),{simulation:l}=Y(),{results:r,loading:d,loadMore:c,error:p}=So({phrase:n,query:a.useMemo(()=>i&&{event_id:i._id,...l&&{simulation_timestamp:i==null?void 0:i.snapshot_timestamp}},[i,l])}),x=a.useMemo(()=>y.keyBy(s,"resource_id"),[s]),j=xs(o,500),_=a.useCallback(C=>{t([...s||[],C])},[t,s]),w=a.useCallback(C=>{t(s.filter(({resource_id:f})=>f!==C))},[t,s]);return e.jsx(Ot,{error:p,children:e.jsxs(N,{gap:1,children:[e.jsx(To,{phrase:n,onChange:j,loading:d}),r&&e.jsx(fo,{selected:x,resources:r,onScrollEnd:c,onSelect:_,onDeselect:w})]})})}function To({phrase:s="",loading:t,onChange:n,...o}){const[i,l]=a.useState(s),r=a.useCallback(d=>{const c=d.target.value;l(c),n(c)},[n]);return e.jsx(me,{autoFocus:!0,variant:"outlined",placeholder:"Search",value:i,onChange:r,InputProps:{endAdornment:t&&e.jsx(Ve,{size:20})},...o})}const $o=D.forwardRef(({facet:s,values:t={},valuesDefaults:n,toggleButton:o,onChange:i,...l},r)=>e.jsxs(N,{ref:r,...l,children:[e.jsx(pe,{title:e.jsxs(e.Fragment,{children:[e.jsx(we,{color:"action"}),e.jsx(u,{variant:"subtitle1",children:"Filters"})]}),actions:o}),e.jsx(U,{grow:!0,scroll:!0,children:e.jsx(Ho,{children:e.jsx(Ls,{facet:s,values:t,valuesDefaults:n,onValuesChange:i,children:Uo.map(({label:d,component:c})=>e.jsx(c,{label:d},d))})})})]}));function zo({label:s}){return e.jsx(M,{label:s,field:"source_location_ids",renderOption:t=>e.jsx(Ye,{id:t}),defaultCollapsed:!0})}function Oo({label:s}){return e.jsx(M,{label:s,field:"destination_location_ids",renderOption:t=>e.jsx(Ye,{id:t}),defaultCollapsed:!0})}function Do({label:s}){return e.jsx(M,{label:s,createOption:({value:t,onChange:n})=>e.jsx(No,{value:t,onChange:n}),renderOption:({ip_address:t,position:n})=>e.jsxs(g,{gap:2,style:{alignItems:"center"},children:[e.jsx(u,{noWrap:!0,children:t}),n&&e.jsx(Ms,{children:n})]}),merge:a.useCallback((t,n)=>{function o(i,l){return{[i]:n.filter(({position:r})=>!r||r===l).map(({ip_address:r})=>r)}}return{...t,...o("ip_address_src","SRC"),...o("ip_address_dst","DST")}},[]),getValue:a.useCallback(t=>{const n=i("ip_address_src","SRC"),o=i("ip_address_dst","DST");function i(l,r){var d;return((d=t==null?void 0:t[l])==null?void 0:d.map(c=>({ip_address:c,position:r})))||[]}return y.chain([...n,...o]).value()},[]),compare:a.useCallback((t,n)=>t.ip_address===n.ip_address&&(!t.position||!n.position||t.position===n.position),[]),getChecked:a.useCallback((t,n)=>y.some(t,({ip_address:o})=>n.ip_address===o),[])})}const Ms=v(u).withConfig({displayName:"EventImpactsFilters__PositionTypography",componentId:"sc-acdhbk-0"})(({theme:s})=>({fontSize:10,background:s.palette.text.secondary,color:s.palette.background.default,borderRadius:s.shape.borderRadius/2,padding:s.spacing(.5,1)}));function No({value:s,onChange:t}){const{ip_address:n="",position:o="ANY"}=s||{},i=a.useCallback(r=>t({...s,ip_address:r.target.value}),[t,s]),l=a.useCallback(r=>{t({...s,position:r==="ANY"?void 0:r})},[t,s]);return e.jsx(N,{gap:1,children:e.jsx(me,{variant:"outlined",value:n,onChange:i,placeholder:"0.0.0.0",InputProps:{endAdornment:e.jsx(fn,{size:"small",children:["SRC","DST","ANY"].map(r=>e.jsx(te,{selected:r===o,onClick:()=>l(r),children:r},r))})}})})}const Ao=D.memo(({label:s})=>e.jsx(M,{label:s,createOption:a.useCallback(({value:t,onChange:n})=>e.jsx(Fo,{value:t,onChange:n}),[]),getValue:a.useCallback(t=>{function n(o,i){var l;return((l=t==null?void 0:t[o])==null?void 0:l.map(r=>({id:r,position:i})))||[]}return y.chain([...n("resource_ids","ANY"),...n("resource_ids_src","SRC"),...n("resource_ids_dst","DST"),...n("resource_ids_intermediate","INTR")]).groupBy("id").map((o,i)=>({resource_id:i,position:y.chain(o).map("position").compact().uniq().value()[0]})).value()},[]),merge:a.useCallback((t,n)=>{function o(i,l){return{[i]:n.filter(({position:r})=>r===l).map(({resource_id:r})=>r)}}return{...t,...o("resource_ids","ANY"),...o("resource_ids_src","SRC"),...o("resource_ids_dst","DST"),...o("resource_ids_intermediate","INTR")}},[]),renderOption:a.useCallback(({resource_id:t,position:n})=>e.jsxs(g,{gap:1,style:{alignItems:"center"},children:[e.jsx(Ye,{id:t,disableMenu:!0}),n!=="ANY"&&e.jsx(Ms,{children:n})]}),[])}));function Lo({label:s}){return e.jsx(M,{label:s,field:"source_types",defaultCollapsed:!0,renderOption:t=>e.jsxs(g,{gap:1,children:[e.jsx(G,{size:"small",type:t}),e.jsx(ue,{children:e.jsx(u,{noWrap:!0,children:se(t)})})]})})}function Po({label:s}){return e.jsx(M,{label:s,field:"destination_types",defaultCollapsed:!0,renderOption:t=>e.jsxs(g,{gap:1,children:[e.jsx(G,{size:"small",type:t}),e.jsx(ue,{children:e.jsx(u,{noWrap:!0,children:se(t)})})]})})}function Bo(){const{facets:{resource_types:s}}=Je(),t=a.useCallback((i,l)=>{const r=y.chain(l).map("source_type").uniq().value(),d=y.chain(l).map("destination_type").uniq().value();return{...i,source_types:r,destination_types:d}},[]),n=a.useCallback(i=>{const l=new Set(i==null?void 0:i.source_types),r=new Set(i==null?void 0:i.destination_types);return y.chain(s).filter(({value:{source_type:d,destination_type:c}})=>l.has(d)&&r.has(c)).map("value").value()},[s]),o=a.useCallback((i,l)=>i.source_type===l.source_type&&i.destination_type===l.destination_type,[]);return e.jsx(M,{label:"Resource Types",field:"resource_types",renderOption:qo,mergeValues:t,compare:o,getValue:n})}function Vo({label:s}){return e.jsx(M,{label:s,field:"impact_types",renderOption:t=>e.jsx(Be,{type:t})})}function Wo({label:s}){return e.jsx(M,{label:s,field:"port_protocols",createOption:({value:t,onChange:n})=>e.jsx(Go,{value:t,onChange:n}),renderOption:Mo})}function Mo({protocol:s,start:t,end:n}){return e.jsxs(g,{gap:1,children:[e.jsx(u,{color:s?"textPrimary":"textSecondary",children:s||"Any"}),t&&e.jsxs(u,{children:["(",!n||t===n?t:`${t}-${n}`,")"]})]})}function Go({value:s,onChange:t}){const{start:n,end:o,protocol:i}=a.useMemo(()=>s||{},[s]),[l,r]=a.useState(n!==o),d=a.useCallback(j=>{t({...s,protocol:j.target.value})},[t,s]),c=a.useCallback(j=>{const _=j.target.value?+j.target.value:"";t({...s,start:_,...!l&&{end:_}})},[l,t,s]),p=a.useCallback(j=>{t({...s,end:j.target.value?+j.target.value:""})},[t,s]),x=a.useCallback(()=>{r(j=>!j)},[]);return e.jsxs(N,{gap:1,style:{overflow:"visible"},children:[e.jsxs(N,{gap:2,style:{overflow:"visible"},children:[e.jsxs(Dt,{variant:"outlined",children:[e.jsx(Nt,{shrink:!0,children:"Protocol"}),e.jsxs(At,{displayEmpty:!0,value:i||"",onChange:d,children:[e.jsx(xe,{value:"",children:e.jsx(u,{color:"textSecondary",children:"Any"})}),Lt.map(j=>e.jsx(xe,{value:j,children:j},j))]})]}),e.jsx(me,{variant:"outlined",InputLabelProps:{shrink:!0},inputProps:{type:"number"},value:n||"",label:l?"Start Port":"Port",onChange:c,placeholder:"1-65535"}),l&&e.jsx(me,{InputLabelProps:{shrink:!0},inputProps:{type:"number"},variant:"outlined",value:o||"",label:"End Port",onChange:p,placeholder:"1-65535"})]}),e.jsxs(g,{gap:1,children:[e.jsx(Pt,{size:"small",checked:l,onClick:x}),e.jsx(u,{variant:"caption",color:"textSecondary",children:"Port range"})]})]})}function qo(s){return e.jsxs(g,{gap:1,grow:[0,1,0,0,1],children:[e.jsx(G,{size:"small",type:s==null?void 0:s.source_type}),e.jsx(ue,{children:e.jsx(u,{variant:"body2",noWrap:!0,children:se(s==null?void 0:s.source_type)})}),e.jsx(u,{variant:"body2",color:"textSecondary",children:"->"}),e.jsx(G,{size:"small",type:s==null?void 0:s.destination_type}),e.jsx(ue,{children:e.jsx(u,{variant:"body2",noWrap:!0,children:se(s==null?void 0:s.destination_type)})})]})}const Ho=v.div.withConfig({displayName:"EventImpactsFilters__Content",componentId:"sc-acdhbk-1"})(({theme:s})=>({padding:s.spacing(2,3)})),Uo=[{label:"Resource ID",component:Ao},{label:"Impacts",component:Vo},{label:"Resource Types",component:Bo},{label:"Port/Protocol",component:Wo},{label:"IP Address",component:Do},{label:"Source Resource Scope",component:zo},{label:"Destination Resource Scope",component:Oo},{label:"Source Resource Type",component:Lo},{label:"Destination Resource Type",component:Po}].sort((s,t)=>s.label>t.label?1:-1),Gs=D.forwardRef(({filtersValuesDefaults:s,...t},n)=>{const[o,i]=a.useState("list"),[l,r]=a.useState(!0),d=Bt(),[c,p]=be("filters",s),x=a.useMemo(()=>Object.keys(y.omit(c,Object.keys(s||{}))).length>0,[c,s]),{simulation:j}=Y(),[_]=a.useState(100),[w]=K(),C=a.useMemo(()=>w&&{event_id:w._id,...j&&{simulation_timestamp:String(w==null?void 0:w.snapshot_timestamp)}},[w,j]),f=a.useMemo(()=>y.map(c,(T,b)=>({value:T,type:b})),[c]),h=a.useMemo(()=>y.map(s,(T,b)=>({value:T,type:b})),[s]),{values:$,total_count:A}=_o({query:C,filters:h}),[{results:k,total_count:z},{fetchMore:R,loading:m,error:F}]=dn({query:C,filters:f,limit:_}),S=a.useCallback(()=>{!m&&z>(k==null?void 0:k.length)&&R()},[R,k==null?void 0:k.length,z,m]),L=l?e.jsxs(e.Fragment,{children:[x&&e.jsx(te,{variant:"text",size:"small",onClick:()=>p(s||{}),children:"Clear"}),e.jsx(We,{open:l,onClick:()=>r(!1)})]}):e.jsx(te,{variant:"text",size:"small",selected:x,startIcon:e.jsx(we,{fontSize:"small"}),onClick:()=>r(!0),children:"Filters"}),B=a.useCallback(T=>{d(T.id)},[d]),X=c==null?void 0:c.resource_ids;return e.jsxs(g,{grow:!0,...t,children:[e.jsx(Ko,{open:l,children:e.jsx(U,{grow:!0,children:e.jsx($o,{facet:$,values:c,valuesDefaults:s,onChange:p,toggleButton:L})})}),e.jsxs(Jo,{children:[e.jsx(pe,{title:e.jsxs(e.Fragment,{children:[!l&&e.jsxs(e.Fragment,{children:[L,e.jsx(Re,{flexItem:!0,orientation:"vertical"})]}),m?e.jsxs(e.Fragment,{children:[e.jsx(Ve,{size:20}),e.jsx(u,{color:"textSecondary",children:"Loading..."})]}):k?z?x?e.jsx(u,{variant:"subtitle1",children:`${z} out of ${A} matching results`}):e.jsx(u,{variant:"subtitle1",children:`${A} impacted dependencies`}):e.jsx(u,{children:"No matching results"}):e.jsx(oe,{width:200})]}),actions:e.jsx(g,{gap:2,style:{alignItems:"center"},children:e.jsx(Zo,{value:o,onChange:T=>i(T)})})}),e.jsx(U,{grow:!0,children:e.jsx(Xo,{children:!k&&F?e.jsx(J,{children:e.jsx(je,{error:F})}):o==="list"?e.jsx(un,{groups:k,query:C,filters:f,onResourceSelect:B,selectedResources:X,onScrollEnd:S,limit:_,count:z,fullView:!0}):o==="edges"?e.jsx(Yo,{flowGroups:k,flowGroupsLoading:m,flowsQuery:C,flowsFilters:f}):o==="topology"?e.jsx(Qo,{flowsQuery:C,flowsFilters:f,selectedResourceIds:X}):!1})})]})]})});function Yo({flowGroups:s,flowGroupsLoading:t,flowsQuery:n,flowsFilters:o,selectedResourceIds:i}){const[l,{loading:r,error:d}]=Ns({query:n,filters:o}),c=a.useMemo(()=>new Set(i),[i]);return r?e.jsx(J,{children:e.jsx(Ee,{})}):d?e.jsx(J,{children:e.jsx(je,{error:d})}):e.jsx(pn,{nodes:l==null?void 0:l.graph_nodes,edgeIds:l==null?void 0:l.edge_ids,highlighted:c})}function Qo({flowsQuery:s,flowsFilters:t,selectedResourceIds:n}){const[o,{loading:i}]=Ns({query:s,filters:t}),[l,r]=a.useState([]);a.useEffect(()=>{o!=null&&o.graph_nodes&&r(hn(o==null?void 0:o.graph_nodes,n))},[o==null?void 0:o.graph_nodes,n]);const d=a.useMemo(()=>xn(gn(o==null?void 0:o.graph_nodes)),[o==null?void 0:o.graph_nodes]);return i?e.jsx(J,{children:e.jsx(Ee,{})}):e.jsx(mn,{nodes:d,expanded:l,onExpand:r,layout:!0})}const Jo=v(N).withConfig({displayName:"EventImpacts__Container",componentId:"sc-1sq245e-0"})(({theme:s})=>({background:s.palette.background.paper,minWidth:"fit-content"})),Ko=v.div.withConfig({displayName:"EventImpacts__FiltersDrawer",componentId:"sc-1sq245e-1"})(({theme:s,open:t})=>({maxWidth:t?300:0,minWidth:t?300:0,transition:"max-width 250ms ease-out",background:ce(s.palette.background.default,.5),overflow:"hidden",display:"flex",flexDirection:"column"})),Xo=v.div.withConfig({displayName:"EventImpacts__Content",componentId:"sc-1sq245e-2"})(({theme:s})=>({overflow:"auto",display:"flex",flexDirection:"column"}));function Zo({value:s,onChange:t}){return e.jsxs(g,{gap:1,style:{alignItems:"center"},children:[e.jsx(u,{color:"textSecondary",variant:"caption",children:"View"}),e.jsxs(er,{children:[e.jsx(ee,{title:"Topology",children:e.jsx(H,{selected:s==="topology",onClick:()=>t("topology"),children:e.jsx(Vt,{fontSize:"small"})})}),e.jsx(ee,{title:"Edges",children:e.jsx(H,{selected:s==="edges",onClick:()=>t("edges"),children:e.jsx(Wt,{fontSize:"small"})})}),e.jsx(ee,{title:"List",children:e.jsx(H,{selected:s==="list",onClick:()=>t("list"),children:e.jsx(vs,{fontSize:"small"})})})]})]})}const er=v(g).withConfig({displayName:"EventImpacts__ViewModeButtons",componentId:"sc-1sq245e-3"})(({theme:s})=>({border:`solid 1px ${s.palette.dividerLight}`,borderRadius:s.shape.borderRadius})),sr=D.memo(({section:s="resources",onSectionChange:t,detailsOpen:n,...o})=>{var x;const[i,{loading:l}]=K(),r=gs(),{state:d}=ms(),[{selectedResourceId:c}]=a.useState(d||{selectedResourceId:null}),p=a.useCallback(j=>{const _={selectedResourceId:j};return r.replace({search:window.location.search,state:_}),_},[r]);return e.jsxs(Ce,{column:!0,...o,children:[e.jsx(Ce,{header:!0,paper:!0,pad:0,children:e.jsxs(Ss,{value:s,onChange:(j,_)=>t(_),children:[!n&&e.jsx(ne,{value:"details",label:"Details",icon:e.jsx(He,{fontSize:"small",color:"action"})}),e.jsx(ne,{value:"resources",label:"Change Overview"}),e.jsx(ne,{value:"impacts",label:"All Impacts"}),e.jsx(ne,{value:"risks",label:"All Risks"}),!l&&((x=i==null?void 0:i.errors)==null?void 0:x.length)>0&&e.jsx(ne,{value:"exceptions",label:`Exceptions (${i.errors.length})`})]})}),e.jsx(U,{grow:!0,scroll:!0,children:l?e.jsx(J,{children:e.jsx(Ee,{})}):{resources:e.jsx(Ps,{selectedResourceId:c,onResourceNavigation:p}),impacts:e.jsx(Gs,{}),exceptions:e.jsx(po,{}),risks:e.jsx(Mt,{})}[s]||e.jsx(e.Fragment,{})})]})}),tr=D.memo(({header:s})=>{const{section:t}=Le(),[n,o]=Gt("event_details",!0),[i,{loading:l,error:r}]=K(),d=Se(),c=a.useCallback(x=>{x==="details"?o(!0):d({section:x,replace:!0})},[d,o]),p=e.jsx(We,{open:n,onClick:()=>o(!n),ClosedIcon:He});return e.jsxs(N,{style:{height:"100%"},children:[s,e.jsx(U,{grow:!0,children:!l&&r&&!i?e.jsx(J,{children:e.jsx(je,{error:r})}):e.jsxs(g,{grow:!0,children:[e.jsx(to,{open:n,toggleButton:p,onSkippedClick:()=>c("exceptions")}),e.jsx(sr,{section:t,onSectionChange:c,detailsOpen:n})]})})]})});function nr({...s}){const{resourceId:t}=Es();return e.jsx(Gs,{filtersValuesDefaults:a.useMemo(()=>({resource_ids:[t]}),[t]),...s})}function or({section:s="summary",header:t,onSectionChange:n=null,...o}){const i=Se(),l=a.useCallback((r,d)=>{i({section:d,replace:!0})},[i]);return e.jsxs(N,{...o,style:{height:"100%",...o.style},children:[e.jsxs(lr,{children:[e.jsx(rr,{children:t}),e.jsx(ir,{children:e.jsxs(Ss,{value:s,onChange:l,children:[e.jsx(ne,{value:"summary",label:"Change Summary"}),e.jsx(ne,{value:"impacts",label:"Impact Radius"}),e.jsx(ne,{value:"violations",label:"Risks"})]})})]}),e.jsx(U,{grow:!0,scroll:!0,children:{summary:e.jsx(Ht,{showImpactRadius:!0}),impacts:e.jsx(nr,{}),violations:e.jsx(qt,{})}[s]||e.jsx("div",{})})]})}const rr=v.div.withConfig({displayName:"EventResourceLayout__HeaderTitle",componentId:"sc-lxnl6r-0"})(({theme:s})=>({overflow:"hidden",width:300})),ir=v.div.withConfig({displayName:"EventResourceLayout__HeaderTabsContainer",componentId:"sc-lxnl6r-1"})(({theme:s})=>({flexGrow:1})),lr=v(g).withConfig({displayName:"EventResourceLayout__HeaderContainer",componentId:"sc-lxnl6r-2"})(({theme:s})=>({background:s.palette.background.paper,alignItems:"flex-end",borderBottom:`solid 1px ${s.palette.dividerLight}`}));function ar(s,t=!1){var i;const{data:n,...o}=Ae(cr,{skip:!s,variables:{id:s,simulation:t}});return[(i=n==null?void 0:n.event)==null?void 0:i.raw_event,o]}const cr=ke`
  query Event($id: ID, $simulation: Boolean!) {
    event(id: $id, simulation: $simulation) {
      raw_event
    }
  }
`;function dr({eventId:s,simulation:t,onClose:n}){const[o,{loading:i,error:l}]=ar(s,t),r=a.useCallback(()=>{var d=new Blob([JSON.stringify(o,null,2)],{type:"application/json;charset=utf-8"});Ut.saveAs(d,`raw_event_${s}.json`)},[s,o]);return e.jsxs(N,{style:{height:"100%"},children:[e.jsx(pe,{title:e.jsxs(g,{style:{alignItems:"center"},gap:1,children:[e.jsx(Fs,{}),e.jsx(u,{variant:"subtitle1",children:"Raw Event (JSON)"})]}),actions:e.jsxs(e.Fragment,{children:[e.jsx(te,{variant:"text",disabled:!o,startIcon:e.jsx(Yt,{}),onClick:r,children:"Download"}),n&&e.jsx(et,{onClick:n,children:e.jsx(Qt,{})})]})}),e.jsx(ur,{children:i?e.jsx(J,{children:e.jsx(Ee,{})}):l?e.jsx(J,{children:e.jsx(je,{error:l})}):e.jsx(Jt,{data:o})})]})}const ur=v.div.withConfig({displayName:"EventRawData__Content",componentId:"sc-17wjzi0-0"})(({theme:s})=>({background:s.palette.background.default,overflow:"auto",flex:1,flexGrow:1}));function kr(){return e.jsx(_r,{contextProps:{simulation:!0},headerProps:({isResourceHeader:s}={})=>({Icon:Qe,basePath:Ts.path,title:e.jsx(g,{children:e.jsx(Ke,{shrink:s})})})})}function Ke({shrink:s=!1,hideStatus:t=!1}){const[n]=K(),{eventId:o}=Y();return e.jsxs(g,{style:{alignItems:"center"},gap:1,children:[e.jsx(u,{variant:s?"caption":"inherit",children:`Simulation #${o==null?void 0:o.slice(-4).toUpperCase()}`}),!t&&(s?e.jsx($s,{status:n==null?void 0:n.status,fontSize:"small"}):e.jsx(Kt,{status:n==null?void 0:n.status}))]})}function qs(){const s=st(),t=gs(),n=ms();return a.useCallback(o=>{!n.key||n.key==="default"?s.replace({pathname:o}):t.goBack()},[n.key,t,s])}const pr=D.memo(s=>{const{eventId:t,simulation:n}=s,[o,i]=a.useState(!1),l=qs(),r=a.useCallback(()=>{const p=n?Ts.path:zs.path;l(p)},[n,l]),d=n?e.jsx(Ke,{}):`Event #${t.slice(-4).toUpperCase()}`,c=n?Qe:Os;return e.jsxs(e.Fragment,{children:[e.jsx(jn,{Icon:c,title:d,onBackClick:r,actions:e.jsxs(e.Fragment,{children:[e.jsx(hr,{}),e.jsx(xr,{variant:"text",size:"small",startIcon:e.jsx(Fs,{}),onClick:()=>i(!0),children:"View Raw Event (JSON)"})]})}),e.jsx(gr,{open:o,fullWidth:!0,maxWidth:"lg",onClose:()=>i(!1),children:e.jsx(dr,{eventId:t,simulation:n,onClose:()=>i(!1)})})]})});function hr(){const{setSummarization:s}=Xt(),{eventId:t}=Y();return e.jsx(Zt,{size:"small",variant:"text",startIcon:e.jsx(en,{}),onClick:()=>s({event_id:t}),children:"Summarize"})}const xr=v(te).withConfig({displayName:"EventHeader__FixedButton",componentId:"sc-c0ia42-0"})(["position:fixed;right:12px;"]),gr=hs({paper:{height:"100%"}})(Ds);function mr(){const[s,t]=a.useState(!1),{resourceId:n}=Es(),{resource:o,sub_events:[i]}=sn(),{eventId:l,simulation:r}=Y(),[d]=K(),c=qs(),p=i==null?void 0:i.action_type,x=a.useCallback(()=>{c(`${zs.path}/${l}`)},[c,l]),j=r?e.jsx(Ke,{hideStatus:!0,shrink:!0}):e.jsx(u,{variant:"caption",children:`Event #${l.slice(-4).toUpperCase()}`}),_=r?Qe:Os;return e.jsxs(jr,{gap:1,children:[e.jsxs(N,{children:[e.jsxs(yr,{gap:1,children:[e.jsx(te,{variant:"text",size:"small",onClick:x,children:e.jsxs(g,{style:{alignItems:"center"},gap:1,children:[e.jsx(tn,{fontSize:"small"}),_&&e.jsx(_,{color:"action",fontSize:"small"}),e.jsx("div",{children:j})]})}),r&&e.jsx($s,{status:d==null?void 0:d.status,fontSize:"small"})]}),e.jsxs(g,{gap:1,children:[e.jsx(G,{size:"large",type:o==null?void 0:o.type}),e.jsxs(N,{children:[e.jsxs(g,{style:{alignItems:"center"},gap:1,children:[e.jsx(nn,{resource:o,children:e.jsx(u,{variant:"body2",noWrap:!0,children:o?o.display_name||o.id:e.jsx(oe,{width:200})})}),e.jsx(on,{type:p}),e.jsxs(g,{style:{overflow:"visible"},children:[e.jsx(Cs,{resource:o,size:"small"}),e.jsx(Re,{variant:"middle",orientation:"vertical",flexItem:!0}),e.jsx(H,{size:"small",onClick:()=>t(!0),children:e.jsx(ys,{fontSize:"small"})})]})]}),e.jsx(g,{style:{alignItems:"center"},gap:1,children:e.jsx(u,{variant:"body2",color:"textSecondary",noWrap:!0,children:o?se(o.type):e.jsx(oe,{width:100})})})]})]})]}),e.jsx(Ds,{keepMounted:!0,fullWidth:!0,maxWidth:"lg",open:s,onClose:()=>t(!1),PaperProps:{style:{height:"100%"}},children:e.jsx(U,{grow:!0,scroll:!0,children:e.jsx(Ps,{selectedResourceId:n,title:"Jump to changed resource"})})})]})}const jr=v(g).withConfig({displayName:"EventResourceHeader__Container",componentId:"sc-1a5s22p-0"})(({theme:s})=>({alignItems:"center",background:s.palette.background.paper,padding:s.spacing(2),height:90})),yr=v(g).withConfig({displayName:"EventResourceHeader__HeaderTitle",componentId:"sc-1a5s22p-1"})(({theme:s})=>({alignItems:"center",flexGrow:1}));function _r({contextProps:s}){const{id:t}=Le(),n=tt(),[o,{error:i}]=K(t,s==null?void 0:s.simulation),l=a.useMemo(()=>({simulation:s==null?void 0:s.simulation,timestamp:o==null?void 0:o.snapshot_timestamp}),[s==null?void 0:s.simulation,o==null?void 0:o.snapshot_timestamp]);return!o&&i?e.jsx(J,{children:e.jsx(je,{error:i})}):e.jsx(rn,{eventId:t,...s,children:e.jsx(ln,{children:e.jsx(an,{event:o,inspectionParams:l,children:e.jsxs(nt,{children:[e.jsx(ns,{path:`${n.url}/r/:id/:section?`,component:br}),e.jsx(ns,{path:`${n.url}/:section?`,component:fr})]})})})})}const fr=D.memo(()=>{const{eventId:s,simulation:t}=Y();return e.jsx(tr,{header:e.jsx(pr,{eventId:s,simulation:t})})}),br=D.memo(()=>{const s=Le();return e.jsx(cn,{resourceId:decodeURIComponent(s.id),children:e.jsx(or,{section:s.section,header:e.jsx(mr,{})})})});export{_r as E,vn as S,bn as a,kr as b,us as g};
