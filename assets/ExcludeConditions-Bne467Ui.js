import{m as Ee,d as Ae,r as f,e as xe,n as Me,j as t,R as M,q as b,o as ue,l as me,C as $,aa as Y,ab as ze,ac as F,ad as J,ae as X}from"./index-BgJRjf8M.js";import{cX as Le,d as p,cY as De,cZ as Be,c_ as Ne,c$ as se,c5 as he,d0 as Pe,d1 as Ue,b as y,d2 as Fe,d3 as Ve,B as A,d4 as Oe,L as h,as as ne,g as ae,aL as We,aw as w,d5 as oe,d6 as G,aM as Q,d7 as je,d8 as fe,d9 as ge,da as $e,db as Ge,dc as qe,n as be,ae as He,bl as k,R as Ye,dd as Je,de as Ke,df as pe,dg as Ze,dh as re,S as ie,di as U,a as E,T as Xe,I as le,D as ee,A as ce,cn as Qe,bY as et,M as tt,cm as st,bZ as nt,cf as T,cj as at,ck as ot,cl as rt,dj as ye,F as Ce,dk as it,co as lt,h as ct,ci as dt,dl as pt,C as xt}from"./App-BghU7kAw.js";import{P as ut}from"./PortsInput-zv5irp4I.js";var _e={exports:{}};/*! streamsaver. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> */(function(e){((s,n)=>{e.exports=n()})("streamSaver",()=>{const s=typeof window=="object"?window:this;s.HTMLElement||console.warn("streamsaver is meant to run on browsers main thread");let n=null,a=!1;const o=u=>{try{u()}catch{}},r=s.WebStreamsPolyfill||{},i=s.isSecureContext;let d=/constructor/i.test(s.HTMLElement)||!!s.safari||!!s.WebKitPoint;const x=i||"MozAppearance"in document.documentElement.style?"iframe":"navigate",l={createWriteStream:C,WritableStream:s.WritableStream||r.WritableStream,supported:!0,version:{full:"2.0.5",major:2,minor:0,dot:5},mitm:"https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=2.0.0"};function _(u){if(!u)throw new Error("meh");const c=document.createElement("iframe");return c.hidden=!0,c.src=u,c.loaded=!1,c.name="iframe",c.isIframe=!0,c.postMessage=(...v)=>c.contentWindow.postMessage(...v),c.addEventListener("load",()=>{c.loaded=!0},{once:!0}),document.body.appendChild(c),c}function I(u){const c="width=200,height=100",v=document.createDocumentFragment(),j={frame:s.open(u,"popup",c),loaded:!1,isIframe:!1,isPopup:!0,remove(){j.frame.close()},addEventListener(...m){v.addEventListener(...m)},dispatchEvent(...m){v.dispatchEvent(...m)},removeEventListener(...m){v.removeEventListener(...m)},postMessage(...m){j.frame.postMessage(...m)}},z=m=>{m.source===j.frame&&(j.loaded=!0,s.removeEventListener("message",z),j.dispatchEvent(new Event("load")))};return s.addEventListener("message",z),j}try{new Response(new ReadableStream),i&&!("serviceWorker"in navigator)&&(d=!0)}catch{d=!0}o(()=>{const{readable:u}=new TransformStream,c=new MessageChannel;c.port1.postMessage(u,[u]),c.port1.close(),c.port2.close(),a=!0,Object.defineProperty(l,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})});function S(){n||(n=i?_(l.mitm):I(l.mitm))}function C(u,c,v){let j={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},z=0,m=null,g=null,B=null;if(Number.isFinite(c)?([v,c]=[c,v],console.warn("[StreamSaver] Deprecated pass an object as 2nd argument when creating a write stream"),j.size=v,j.writableStrategy=c):c&&c.highWaterMark?(console.warn("[StreamSaver] Deprecated pass an object as 2nd argument when creating a write stream"),j.size=v,j.writableStrategy=c):j=c||{},!d){S(),g=new MessageChannel,u=encodeURIComponent(u.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A");const R={transferringReadable:a,pathname:j.pathname||Math.random().toString().slice(-6)+"/"+u,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+u}};j.size&&(R.headers["Content-Length"]=j.size);const P=[R,"*",[g.port2]];if(a){const L=x==="iframe"?void 0:{transform(H,ke){if(!(H instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");z+=H.length,ke.enqueue(H),m&&(location.href=m,m=null)},flush(){m&&(location.href=m)}};B=new l.TransformStream(L,j.writableStrategy,j.readableStrategy);const de=B.readable;g.port1.postMessage({readableStream:de},[de])}g.port1.onmessage=L=>{L.data.download?x==="navigate"?(n.remove(),n=null,z?location.href=L.data.download:m=L.data.download):(n.isPopup&&(n.remove(),n=null,x==="iframe"&&_(l.mitm)),_(L.data.download)):L.data.abort&&(N=[],g.port1.postMessage("abort"),g.port1.onmessage=null,g.port1.close(),g.port2.close(),g=null)},n.loaded?n.postMessage(...P):n.addEventListener("load",()=>{n.postMessage(...P)},{once:!0})}let N=[];return!d&&B&&B.writable||new l.WritableStream({write(R){if(!(R instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");if(d){N.push(R);return}g.port1.postMessage(R),z+=R.length,m&&(location.href=m,m=null)},close(){if(d){const R=new Blob(N,{type:"application/octet-stream; charset=utf-8"}),P=document.createElement("a");P.href=URL.createObjectURL(R),P.download=u,P.click()}else g.port1.postMessage("end")},abort(){N=[],g.port1.postMessage("abort"),g.port1.onmessage=null,g.port1.close(),g.port2.close(),g=null}},j.writableStrategy)}return l})})(_e);var mt=_e.exports;const ht=Ee(mt),jt=18e4;async function ft(e,s){return Promise.race([e.read(),new Promise((n,a)=>{setTimeout(()=>{a(new Error("Request timed out"))},s)})])}async function gt(e,s,n,a=jt){try{let o=!1;for(;!o;){const{done:r,value:i}=await ft(e,a);if(o=r,r){s.close();break}const d=n.decode(i,{stream:!0});await s.write(new TextEncoder().encode(d))}}catch(o){throw console.error("Error during file download:",o),s.abort(),o}}const us=({rule_ids:e,attack_path_ids:s,account_ids:n})=>{const a=Ae(),[o,r]=f.useState(!1),{workspaceId:i,session:d,user:x}=xe(),l=d==null?void 0:d.access_token,S=s?"/api/standards/attack_paths/violations/report":"/api/standards/rule_violations/report";return{download:f.useCallback(async()=>{var c;r(!0);const u=await fetch(S,{method:"POST",body:JSON.stringify({export_by:x==null?void 0:x.email,filters:{rule_ids:e,attack_path_ids:s,account_ids:n}}),headers:{customer:i||"",authorization:`Bearer ${l}`,"content-type":"application/json"}});if(u.ok){const j=`stream_violations_report-${Me().format("DD_MM_YYYY-HH:mm:ss")}.csv`,m=ht.createWriteStream(j).getWriter(),g=(c=u.body)==null?void 0:c.getReader(),B=new TextDecoder("utf-8");try{await gt(g,m,B)}catch(N){a(N.message,"error")}finally{r(!1)}}else a(u.statusText,"error"),r(!1)},[S,x==null?void 0:x.email,e,s,n,i,l,a]),isDownloading:o}},we=M.createContext(null);function bt({data:e,limit:s,itemCount:n,columns:a,onScroll:o,RowDetailsComponent:r,rowDetailsDisabled:i,headerDisabled:d,isSelected:x,disableZebra:l,sortOptions:_,onSortChange:I}){const[S,C]=f.useState({}),u=f.useMemo(()=>({data:e,columns:a,openMap:S,setOpenMap:C,RowDetailsComponent:r,rowDetailsDisabled:i,isSelected:x,disableZebra:l}),[r,a,e,x,S,i,l]);return t.jsx(we.Provider,{value:u,children:t.jsxs(yt,{children:[!d&&t.jsx(vt,{columns:a,sortOptions:_,onSortChange:I}),t.jsx(Ct,{children:t.jsx(Le,{data:e,itemCount:n,ItemComponent:_t,onScroll:o})})]})})}const yt=b.div.withConfig({displayName:"VirtualTable__TableContainer",componentId:"sc-1flnv7l-0"})(({theme:e})=>({display:"flex",flexDirection:"column",flexGrow:1,flexBasis:0,minWidth:400})),Ct=b.div.withConfig({displayName:"VirtualTable__TableBody",componentId:"sc-1flnv7l-1"})(({theme:e})=>({flexGrow:1,flexBasis:0})),_t=M.forwardRef(({index:e,onSizeChange:s},n)=>{const{openMap:a,setOpenMap:o,columns:r,data:i,RowDetailsComponent:d,rowDetailsDisabled:x,isSelected:l,disableZebra:_}=f.useContext(we),I=a[e],S=f.useCallback(()=>{o(c=>({...c,[e]:!c[e]})),setTimeout(s)},[e,s,o]),C=i[e],u=f.useMemo(()=>d&&(!x||!x(C)),[C,x,d]);return t.jsxs("div",{ref:n,children:[t.jsx(wt,{index:e,interactive:u,onClick:u?S:void 0,selected:l==null?void 0:l(C),disableZebra:_??!1,children:r.map((c,v)=>t.jsx(Se,{style:c.style,children:t.jsx(c.Component,{data:C,rowIndex:e,detailsOpen:I})},v))}),I&&t.jsx(d,{data:C,onSizeChange:s})]})}),ve=b.div.withConfig({displayName:"VirtualTable__TableRowContainer",componentId:"sc-1flnv7l-2"})(({theme:e})=>({display:"flex",flexDirection:"row",padding:e.spacing(1),alignItems:"center","& > *":{marginRight:e.spacing(1)},"& .row-hide":{visibility:"hidden"},"&:hover .row-hide":{visibility:"visible"}})),Se=b.div.withConfig({displayName:"VirtualTable__TableCellContainer",componentId:"sc-1flnv7l-3"})(({theme:e,onClick:s})=>({flexGrow:1,flexBasis:0,overflow:"hidden",display:"flex",flexDirection:"row",gap:e.spacing(1),alignItems:"center",...s&&{"&:hover":{cursor:"pointer",background:e.palette.action.hover}}})),wt=b(ve).withConfig({displayName:"VirtualTable__TableBodyRowContainer",componentId:"sc-1flnv7l-4"})(({theme:e,index:s,interactive:n,selected:a,disableZebra:o})=>({minHeight:45,...n&&{cursor:"pointer","&:hover":{background:e.palette.action.hover}},...!o&&s%2===0&&{background:e.palette.background.default},...a&&{background:e.palette.action.selected,"&:hover":{background:e.palette.action.selected}},...o&&{borderBottom:`solid 1px ${ue(e.palette.divider,.05)}`}}));function vt({columns:e,sortOptions:s,onSortChange:n}){return t.jsx(St,{children:e.map((a,o)=>t.jsxs(Se,{style:a.style,...a.sortField&&{onClick:()=>{n({sort_by:a.sortField,sort_order:s.sort_by!==a.sortField?-1:s.sort_order===-1?1:-1})}},children:[t.jsx(p,{component:"div",color:"textSecondary",children:a.title}),a.sortField&&(s.sort_by===a.sortField?s.sort_order===-1?t.jsx(De,{fontSize:"small",color:"primary"}):t.jsx(Be,{fontSize:"small",color:"primary"}):t.jsx(Ne,{fontSize:"small",color:"secondary"}))]},o))})}const St=b(ve).withConfig({displayName:"VirtualTable__TableHeaderContainer",componentId:"sc-1flnv7l-5"})(({theme:e})=>({borderBottom:`solid 1px ${e.palette.dividerLight}`,marginBottom:e.spacing(1)}));function It({filters:e}){const{bulkExclude:[,,{ids:s,reset:n,addAll:a}],bulkTicket:[,,{reset:o,addAll:r}]}=f.useContext(se),i=()=>{s.size>0?(n(),o()):(a(e),r(e))};return t.jsx(he,{size:"small",indeterminate:s.size>0,checked:s.size>0,onChange:i})}function ms({rule:e,filters:s,exclusions:n,count:a,limit:o,onScroll:r}){return t.jsxs(Pe,{isRemove:!0,children:[t.jsx(kt,{filters:s}),t.jsx(Rt,{children:t.jsx(bt,{data:n,columns:Mt,itemCount:a,RowDetailsComponent:Ue,rowDetailsDisabled:i=>{var d;return((d=i==null?void 0:i.values)==null?void 0:d.length)===0},onScroll:r,limit:o,headerDisabled:!0})})]})}const Rt=b(h).withConfig({displayName:"RuleManualExclusions__Container",componentId:"sc-1l9tufu-0"})({flexGrow:1}),Tt=({ruleId:e,attackPathId:s})=>{const{workspaceId:n,session:a}=xe();return f.useCallback(async()=>{var x,l;const d=s?"/api/standards/attack_paths/exclusions/export":"/api/standards/rules/export-exclusions";try{const _=await fetch(`${d}`,{method:"POST",headers:{customer:String(n),authorization:`Bearer ${a==null?void 0:a.access_token}`,"content-type":"application/json"},body:JSON.stringify({rule_id:e,attack_path_id:s})});if(!_.ok)throw new Error(await _.text());const I=await _.blob(),S=window.URL.createObjectURL(I),C=document.createElement("a");C.href=S,C.download=((l=(x=_.headers.get("Content-Disposition"))==null?void 0:x.split("filename="))==null?void 0:l[1])??"exclusions.csv",document.body.appendChild(C),C.click(),C.remove()}catch(_){console.log(_)}},[n,a,e,s])};function kt({filters:e}){const{bulkExclude:[,,{ids:s}]}=f.useContext(se),n=Tt({ruleId:e.rule_id});return t.jsxs(Et,{gap:1,grow:[1,0],children:[t.jsxs(y,{gap:1,style:{alignItems:"center"},children:[t.jsx(It,{filters:e}),s.size===0?t.jsx(p,{children:"No selected exclusions"}):t.jsx(p,{color:"primary",children:`${s.size} selected exclusion(s)`})]}),t.jsxs(y,{gap:1,children:[t.jsx(Fe,{Icon:Ve,label:"Un-exclude selected"}),t.jsxs(A,{color:"default",variant:"outlined",size:"small",onClick:n,style:{padding:"0px 12px "},startIcon:t.jsx(Oe,{style:{fontSize:12}}),children:["Export"," "]})]})]})}const Et=b(y).withConfig({displayName:"RuleManualExclusions__HeaderContainer",componentId:"sc-1l9tufu-1"})(({theme:e})=>({alignItems:"center",padding:e.spacing(1)}));function At({data:e}){const s=f.useMemo(()=>[e==null?void 0:e.subject_id],[e==null?void 0:e.subject_id]),{bulkExclude:[,,{ids:n,add:a,remove:o}]}=f.useContext(se),r=f.useMemo(()=>me.some(s,i=>n.has(i)),[s,n]);return t.jsx(he,{checked:r,size:"small",disabled:!e,onClick:i=>i.stopPropagation(),onChange:f.useCallback(i=>{r?o([e]):a([e])},[r,a,e,o])})}const Mt=[{Component:At,style:{flex:"unset"}},{title:"Resource",Component:zt},{title:"Exclusion date",Component:Lt,style:{maxWidth:200}},{title:"Applied by",Component:Dt,style:{maxWidth:150}},{title:"Exclude reason",Component:Bt,style:{maxWidth:200}}];function zt({data:e}){return t.jsx(ne,{id:e==null?void 0:e.subject_id})}function Lt({data:e}){return t.jsx(ae,{children:t.jsx(p,{children:We(e==null?void 0:e.exclusion_date)||!1})})}function Dt({data:e}){return t.jsx(ae,{children:t.jsx(p,{children:(e==null?void 0:e.user_name)||!1})})}function Bt({data:e}){return t.jsx(ae,{children:t.jsx(p,{children:(e==null?void 0:e.comment)||!1})})}function hs({rule:e,...s}){return t.jsx(Nt,{...s,children:t.jsx(h,{gap:4,children:{path:t.jsx(Ut,{rule:e}),resource:t.jsx(Pt,{rule:e})}[e==null?void 0:e.rule_type]||!1})})}const Nt=b.div.withConfig({displayName:"RuleConditions__Container",componentId:"sc-10ybiwt-0"})(({theme:e})=>({padding:e.spacing(3)}));function Pt({rule:e}){return t.jsxs(h,{gap:2,children:[t.jsx(w,{icon:t.jsx(oe,{color:"action"}),label:"Resource",labelVariant:"subtitle1"}),t.jsx(W,{predicates:e==null?void 0:e.resource_predicates}),(e==null?void 0:e.action)&&t.jsxs(t.Fragment,{children:[t.jsx(w,{icon:t.jsx(G,{color:"action"}),label:"Action",labelVariant:"subtitle1"}),t.jsx(q,{children:t.jsx(w,{icon:t.jsx(Q,{type:e.action}),label:$(e.action)})})]})]})}function Ut({rule:e}){var s;return t.jsxs(t.Fragment,{children:[t.jsxs(h,{gap:2,children:[t.jsxs(y,{gap:1,children:[t.jsx(w,{icon:t.jsx(oe,{color:"action"}),label:"Source",labelVariant:"subtitle1"}),(e==null?void 0:e.subject)===Y.Source&&t.jsx(K,{})]}),t.jsx(W,{predicates:e==null?void 0:e.path_source_predicates,match:e==null?void 0:e.path_source_predicate_equals_match})]}),t.jsxs(h,{gap:2,children:[t.jsxs(y,{gap:1,children:[t.jsx(w,{icon:t.jsx(je,{color:"action"}),label:"Intermediate",labelVariant:"subtitle1"}),(e==null?void 0:e.subject)===Y.Intermediate&&t.jsx(K,{})]}),t.jsx(W,{predicates:e==null?void 0:e.path_intermediate_predicates,match:e==null?void 0:e.path_intermediate_predicate_equals_match,operand:e==null?void 0:e.path_intermediate_predicate_operand})]}),t.jsxs(h,{gap:2,children:[t.jsxs(y,{gap:1,children:[t.jsx(w,{icon:t.jsx(fe,{color:"action"}),label:"Destination",labelVariant:"subtitle1"}),(e==null?void 0:e.subject)===Y.Destination&&t.jsx(K,{})]}),t.jsx(W,{predicates:e==null?void 0:e.path_destination_predicates,match:e==null?void 0:e.path_destination_predicate_equals_match})]}),((s=e==null?void 0:e.ports)==null?void 0:s.length)>0&&t.jsxs(h,{gap:2,children:[t.jsx(w,{icon:t.jsx(ge,{color:"action"}),label:"Ports",labelVariant:"subtitle1"}),t.jsx(Ft,{ranges:e==null?void 0:e.ports})]}),(e==null?void 0:e.allowed_actions)&&t.jsxs(h,{gap:2,children:[t.jsx(w,{icon:t.jsx(G,{color:"action"}),label:"Allowed Actions",labelVariant:"subtitle1"}),t.jsx(Ie,{value:e==null?void 0:e.allowed_actions})]})]})}function Ie({value:e}){const{operand:s,actions_list:n}=e;return t.jsx(q,{children:t.jsxs(y,{gap:2,children:[(n==null?void 0:n.length)>1&&t.jsxs(t.Fragment,{children:[t.jsx(p,{children:s})," ",t.jsx(be,{light:!0,orientation:"vertical",flexItem:!0})]}),t.jsx(h,{gap:1,children:n==null?void 0:n.map((a,o)=>t.jsxs(t.Fragment,{children:[a.value!==null&&t.jsxs(k,{gap:1,children:[t.jsx(p,{children:{equals:"is",not_equals:"is not"}[a.match_type]}),t.jsx(p,{children:a.value})]}),a.operand&&t.jsx(Ie,{value:a},o)]}))})]})})}function Ft({ranges:e}){return t.jsx(q,{children:t.jsx(h,{gap:1,children:e.map(({start:s,end:n,protocol:a},o)=>t.jsxs(y,{gap:1,children:[t.jsx(p,{children:s}),t.jsx(p,{color:"textSecondary",children:"-"}),t.jsx(p,{children:n}),t.jsx(p,{children:a})]},o))})})}const O=e=>{var s;return((s=e==null?void 0:e.attributes_list)==null?void 0:s.length)>0};function W({predicates:e,operand:s,match:n}){return e!=null&&e.length||(e=[{}]),t.jsxs(y,{gap:2,children:[typeof n=="boolean"&&t.jsx(p,{color:"textSecondary",children:n?"is":"is not"}),(e==null?void 0:e.length)>1&&t.jsxs(t.Fragment,{children:[t.jsx(p,{color:"textSecondary",children:s}),t.jsx(be,{orientation:"vertical",flexItem:!0,light:!0})]}),t.jsx(h,{children:e==null?void 0:e.map((a,o)=>t.jsx(Re,{condition:a},o))})]})}function Re({condition:e,emptyLabel:s="Any"}){const n=e==null?void 0:e.attributes,a=e==null?void 0:e.tags,o=e==null?void 0:e.locations;return t.jsxs(q,{gap:2,children:[t.jsx(y,{gap:2,style:{alignItems:"center"},children:t.jsx(Wt,{condition:e,emptyLabel:s})}),O(n)&&t.jsxs("div",{children:[t.jsx(w,{icon:t.jsx($e,{color:"action",fontSize:"small"}),label:"Attributes"}),t.jsx(te,{group:n})]}),O(a)&&t.jsxs("div",{children:[t.jsx(w,{icon:t.jsx(Ge,{color:"action",fontSize:"small"}),label:"Tags"}),t.jsx(te,{group:a})]}),(o==null?void 0:o.length)>0&&t.jsxs("div",{children:[t.jsx(w,{icon:t.jsx(qe,{color:"action",fontSize:"small"}),label:"Locations"}),o.map((r,i)=>t.jsx(Vt,{location:r},i))]})]})}function Vt({location:e}){return t.jsx(Ot,{children:t.jsx(ne,{id:e.location_value})})}const Ot=b.div.withConfig({displayName:"RuleConditions__LocationBox",componentId:"sc-10ybiwt-1"})(({theme:e})=>({marginLeft:e.spacing(4),padding:e.spacing(1),borderBottom:`solid 1px ${e.palette.dividerLight}`})),q=b(h).withConfig({displayName:"RuleConditions__ResourceConditionBox",componentId:"sc-10ybiwt-2"})(({theme:e})=>({}));function Wt({condition:e,emptyLabel:s}){var n;return e!=null&&e.resource_id?t.jsx(ne,{id:e==null?void 0:e.resource_id}):e!=null&&e.resource_type?t.jsx(w,{icon:t.jsx(Ye,{size:"small",type:e==null?void 0:e.resource_type}),label:((n=ze(e==null?void 0:e.resource_type))==null?void 0:n.display_name)||(e==null?void 0:e.resource_type)}):O(e==null?void 0:e.tags)||O(e==null?void 0:e.attributes)||O(e==null?void 0:e.locations)?t.jsx(M.Fragment,{}):t.jsx(w,{icon:t.jsx(Je,{color:"action",fontSize:"small"}),label:s})}function te({group:e,gap:s}){var n;return t.jsxs($t,{gap:0,children:[t.jsx(Jt,{operand:e.operand,style:{visibility:((n=e.attributes_list)==null?void 0:n.length)>1?"visible":"hidden"}}),t.jsx(Gt,{list:e.attributes_list,gap:s})]})}const $t=b(y).withConfig({displayName:"RuleConditions__ConditionAttributesGroupBox",componentId:"sc-10ybiwt-3"})(({theme:e})=>({padding:e.spacing(1,1,0,1)}));function Gt({list:e,gap:s=2}){return t.jsx(h,{gap:s,children:e==null?void 0:e.map((n,a)=>t.jsx(qt,{attribute:n},a))})}function qt({attribute:e,...s}){if(e.attributes_list)return t.jsxs(h,{...s,children:[t.jsx(w,{icon:t.jsx(pe,{fontSize:"small",color:"action"}),label:t.jsx(Ht,{children:e.name})}),t.jsx(te,{group:e,gap:1})]});const n=e.value[0];return t.jsxs(Yt,{gap:1,children:[t.jsx(pe,{fontSize:"small",color:"action"}),t.jsx(p,{children:e.name}),t.jsx(p,{color:"textSecondary",children:Ze(e.match_type)}),t.jsx(p,{children:n===!0?"true":n===!1?"false":typeof n=="string"||typeof n=="number"?n:""})]})}const Ht=b(p).withConfig({displayName:"RuleConditions__AttributeNameTypogaphy",componentId:"sc-10ybiwt-4"})(({theme:e})=>({})),Yt=b(y).withConfig({displayName:"RuleConditions__ConditionAttributeBox",componentId:"sc-10ybiwt-5"})(({theme:e})=>({padding:e.spacing(1,0,1,0),borderBottom:`solid 1px ${e.palette.dividerLight}`}));function Jt({operand:e,...s}){return t.jsx(Kt,{...s,children:e})}const Kt=b.span.withConfig({displayName:"RuleConditions__OperandBox",componentId:"sc-10ybiwt-6"})(({theme:e})=>({padding:e.spacing(1),minWidth:50,color:e.palette.text.secondary,borderRadius:e.shape.borderRadius/2})),Zt=b(Ke).withConfig({displayName:"RuleConditions__StyledChip",componentId:"sc-10ybiwt-7"})(({theme:e})=>({backgroundColor:ue(e.palette.primary.main,.25),color:e.palette.primary.main,borderRadius:e.shape.borderRadius})),K=()=>t.jsx(He,{placement:"top",title:"This resource is set to trigger a violation when the rule’s criteria are met.",children:t.jsx(Zt,{size:"small",color:"primary",label:"Violating Resource"})}),Xt={protocol:"TCP"},Qt=M.forwardRef(({value:e,onChange:s,error:n},a)=>t.jsxs(t.Fragment,{children:[t.jsx(re,{error:!!n,ref:a,children:t.jsx(ut,{value:e,onChange:s,defaultRange:Xt,disableAnyProtocol:!0})}),n&&t.jsx(p,{color:"error",children:n.message||"Validation error"})]})),es=M.forwardRef(({value:e,onChange:s,error:n},a)=>t.jsxs(t.Fragment,{children:[t.jsx(Te,{value:e,onChange:s,ref:a}),n&&t.jsx(p,{color:"error",children:n.message||"Validation error"})]})),Te=M.forwardRef(({value:e,onChange:s,onDelete:n},a)=>{const{operand:o=F.And,actions_list:r}=e||{};return t.jsx(re,{ref:a,children:t.jsxs(y,{gap:2,grow:[0,1],children:[(r==null?void 0:r.length)>1&&t.jsx("div",{children:t.jsx(ts,{size:"small",onClick:()=>s({...e,operand:o===F.And?F.Or:F.And}),children:o})}),t.jsxs(h,{gap:1,children:[r==null?void 0:r.map((i,d)=>{var x;return t.jsx(t.Fragment,{children:!((x=i.actions_list)!=null&&x.length)||!i.operand?t.jsxs(k,{gap:1,children:[t.jsxs(ie,{value:i.match_type,style:{width:70},onChange:l=>s({...e,actions_list:E(r,{[d]:{$set:{...i,match_type:l.target.value}}})}),children:[t.jsx(U,{value:J.Equals,children:"is"}),t.jsx(U,{value:J.NotEquals,children:"is not"})]}),t.jsx(Xe,{value:i.value,fullWidth:!0,style:{maxWidth:300},onChange:l=>s({...e,actions_list:E(r,{[d]:{$set:{...i,value:l.target.value}}})})}),t.jsx(le,{size:"small",onClick:()=>s({...e,actions_list:E(r,{$splice:[[d,1]]})}),children:t.jsx(ee,{fontSize:"small"})})]},d):t.jsx(Te,{value:i,onChange:l=>s({...e,actions_list:E(r,{[d]:{$set:l}})}),onDelete:()=>s({...e,actions_list:E(r,{$splice:[[d,1]]})})},d)})}),t.jsxs(y,{gap:2,children:[t.jsx(A,{startIcon:t.jsx(ce,{fontSize:"small",color:"action"}),size:"small",variant:"text",onClick:()=>s({...e,actions_list:[...r||[],{value:"",match_type:J.Equals}]}),children:"Add Allowed Action"}),t.jsx(A,{startIcon:t.jsx(Qe,{fontSize:"small",color:"action"}),size:"small",variant:"text",onClick:()=>s({...e,operand:o,actions_list:[...r||[],{operand:F.Or,actions_list:[]}]}),children:"Add Group"}),n&&t.jsx(A,{startIcon:t.jsx(ee,{fontSize:"small",color:"action"}),size:"small",variant:"text",onClick:n,children:"Delete Group"})]})]})]})})}),ts=b(A).withConfig({displayName:"RuleAllowedActionsInput__OperandButton",componentId:"sc-1f6psx7-0"})({minWidth:50}),ss=M.forwardRef(({value:e,onChange:s},n)=>{const[a,o]=f.useState({open:!1,anchorEl:null}),r=f.useCallback(()=>{o(l=>({...l,open:!1}))},[]),i=f.useCallback(l=>{s(l),r()},[r,s]),d=f.useCallback(l=>o({open:!0,anchorEl:l.target}),[]),x=f.useCallback(l=>s(null),[s]);return t.jsxs(re,{ref:n,children:[e?t.jsxs(y,{gap:1,style:{alignItems:"center"},children:[t.jsx(Q,{type:e,fontSize:"small"}),t.jsx(p,{children:$(e)}),t.jsx(le,{size:"small",onClick:x,children:t.jsx(ee,{fontSize:"small"})})]}):t.jsx(A,{startIcon:t.jsx(ce,{fontSize:"small",color:"action"}),size:"small",variant:"text",onClick:d,children:"Add Action"}),t.jsx(et,{...a,onClose:r,children:["create","modify","delete"].map(l=>t.jsxs(tt,{onClick:()=>i(l),children:[t.jsx(st,{children:t.jsx(Q,{type:l})}),t.jsx(nt,{primary:$(l)})]},l))})]})}),ns=[X.Path,X.Resource];function js({form:e}){const{control:s}=e,n=e.watch("rule_type");return t.jsxs(h,{gap:2,children:[t.jsxs(y,{gap:3,style:{alignItems:"center"},children:[t.jsx(p,{variant:"caption",color:"textSecondary",children:"Rule Type"}),t.jsx(T,{name:"rule_type",control:s,render:({field:a})=>t.jsx(at,{...a,children:t.jsx(y,{gap:2,children:ns.map(o=>t.jsx(ot,{control:t.jsx(rt,{color:"primary",value:o}),label:$(o)},o))})})})]}),n===X.Path?t.jsxs(h,{gap:1,style:{height:"100%"},children:[t.jsxs(k,{gap:2,children:[t.jsx(D,{variant:"subtitle2",Icon:oe,title:"Source"}),t.jsx(Z,{form:e,attr:"path_source_predicate_equals_match"})]}),t.jsx(T,{name:"path_source_predicates",control:s,render:({field:a})=>t.jsx(V,{edgeType:"src",addButtonText:"Add Source",...a})}),t.jsxs(k,{gap:2,children:[t.jsx(D,{variant:"subtitle2",Icon:je,title:"Intermediate"}),t.jsx(Z,{form:e,attr:"path_intermediate_predicate_equals_match"}),t.jsx(as,{form:e,attr:"path_intermediate_predicate_operand"})]}),t.jsx(T,{name:"path_intermediate_predicates",control:s,render:({field:a})=>t.jsx(V,{edgeType:"int",addButtonText:"Add Intermediate",...a})}),t.jsxs(k,{gap:2,children:[t.jsx(D,{variant:"subtitle2",Icon:fe,title:"Destination"}),t.jsx(Z,{form:e,attr:"path_destination_predicate_equals_match"})]}),t.jsx(T,{name:"path_destination_predicates",control:s,render:({field:a})=>t.jsx(V,{edgeType:"dst",addButtonText:"Add Destination",...a})}),t.jsx(D,{variant:"subtitle2",Icon:ge,title:"Ports"}),t.jsx(T,{name:"ports",control:s,rules:{validate:a=>me.every(a,o=>os(o))},render:({field:a,fieldState:o})=>t.jsx(Qt,{...o,...a})}),t.jsx(D,{variant:"subtitle2",Icon:G,title:"Allowed Actions"}),t.jsx(T,{name:"allowed_actions",control:s,render:({field:a,fieldState:o})=>t.jsx(es,{...o,...a})})]}):t.jsxs(t.Fragment,{children:[t.jsx(D,{variant:"subtitle2",Icon:ye,title:"Resource"}),t.jsx(T,{name:"resource_predicates",control:s,render:({field:a})=>t.jsx(V,{addButtonText:"Add Resource",...a})}),t.jsx(D,{variant:"subtitle2",Icon:G,title:"Action"}),t.jsx(T,{name:"action",control:s,render:({field:a})=>t.jsx(ss,{...a})})]})]})}function V({value:e,onChange:s,edgeType:n,addButtonText:a,emptyLabel:o}){return(!e||e.length===0)&&(e=[{}]),t.jsxs(h,{gap:1,children:[e==null?void 0:e.map((r,i)=>t.jsxs(k,{grow:[1,0],gap:1,children:[t.jsx(it,{value:r,edgeType:n,emptyLabel:o,onChange:d=>s(E(e,{[i]:{$set:d}}))}),e.length>1&&t.jsx(le,{size:"small",onClick:()=>s(E(e,{$splice:[[i,1]]})),children:t.jsx(lt,{fontSize:"small"})})]},i)),a&&(e.length>1||e[0].resource_id||e[0].resource_type)&&t.jsx("div",{children:t.jsx(A,{onClick:()=>s(E(e,{$push:[{}]})),size:"small",variant:"text",startIcon:t.jsx(ce,{}),children:a})})]})}function Z({form:e,attr:s}){const n=typeof e.watch(s)>"u"?!0:e.watch(s);return t.jsx(Ce,{children:t.jsxs(ie,{margin:"none",disableUnderline:!0,value:n?"true":"false",onChange:a=>e.setValue(s,a.target.value==="true"),children:[t.jsx(U,{value:"true",children:"is"}),t.jsx(U,{value:"false",children:"is not"})]})})}function as({form:e,attr:s}){const n=typeof e.watch(s)>"u"?"OR":e.watch(s);return t.jsx(Ce,{children:t.jsxs(ie,{margin:"none",disableUnderline:!0,value:n,onChange:a=>e.setValue(s,a.target.value),children:[t.jsx(U,{value:"AND",children:"AND"}),t.jsx(U,{value:"OR",children:"OR"})]})})}function os(e){return!(e.start&&(e.start<1||e.start>65535)||e.end&&(e.end<1||e.end>65535)||e.end&&e.start&&e.start>e.end)}const D=({Icon:e,title:s,variant:n="subtitle1"})=>t.jsxs(k,{gap:1,children:[t.jsx(e,{fontSize:"small",color:"action"}),t.jsx(p,{variant:n,children:s})]});function rs({form:e}){const{control:s}=e;return t.jsx(h,{gap:2,children:t.jsxs(h,{gap:2,style:{height:"100%"},children:[t.jsx(w,{labelVariant:"subtitle2",icon:t.jsx(ye,{fontSize:"small",color:"action"}),label:"Resource"}),t.jsx(T,{name:"exclusion_predicates",control:s,render:({field:n})=>t.jsx(V,{emptyLabel:"None",...n})})]})})}function fs({form:e,submitting:s,onSubmit:n}){const[a,o]=f.useState(!1),r=e.watch("exclusion_predicates");return t.jsx(cs,{children:t.jsxs(h,{gap:4,children:[t.jsx(ct,{children:t.jsxs(k,{gap:2,children:[t.jsxs(k,{gap:1,children:[t.jsx(dt,{color:"action"}),t.jsx(p,{variant:"subtitle1",children:"Exclude Conditions"})]}),a?t.jsxs(t.Fragment,{children:[t.jsx(p,{color:"primary",component:"a",onClick:()=>{e.reset(),o(!1)},children:"Cancel edit"}),t.jsx("div",{style:{flexGrow:1}}),t.jsx(A,{startIcon:t.jsx(pt,{}),disabled:!e.formState.isDirty||s,color:"primary",size:"small",onClick:async()=>{await n(),o(!1)},children:"Save"}),s&&t.jsxs(t.Fragment,{children:[t.jsx(xt,{size:15}),t.jsx(p,{color:"textSecondary",children:"Saving..."})]})]}):t.jsx(p,{color:"primary",component:"a",onClick:()=>o(!0),children:"Edit"})]})}),t.jsx(ls,{disabled:!a,form:e,children:t.jsx(is,{condition:r==null?void 0:r[0],children:t.jsx(Re,{condition:r==null?void 0:r[0],emptyLabel:"None"})})})]})})}const is=M.memo(e=>{const{condition:s,children:n}=e;return Object.keys(s||{}).filter(o=>o!=="__typename"&&s[o]!==null).length>0?n:t.jsx(p,{color:"textSecondary",children:"None"})});function ls({disabled:e,form:s,children:n}){return e?n:t.jsx(rs,{form:s})}const cs=b.div.withConfig({displayName:"ExcludeConditions__Container",componentId:"sc-1l9fpp2-0"})(({theme:e})=>({padding:e.spacing(3)}));export{fs as E,js as R,Tt as a,rs as b,hs as c,ms as d,us as u};
