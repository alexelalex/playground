import{q as h,r as g,j as e,a as M,F as he,aG as xe,d as U,o as Q,c as ye,aH as me,x as je,h as be,v as _e,e as fe,S as ve,i as G}from"./index-Ba6YVotX.js";import{d as i,b6 as Ce,K as l,n as S,I as $,bd as Se,B as I,by as X,fY as J,C as A,b as we,af as ee,ag as ke,q as te,ae as j,bV as Ie,fZ as Te,f_ as Ne,f$ as ne,g0 as Ee,U as re,g1 as T,ab as Re,x as Ae,s as Ke,R as F,g2 as se,g3 as Le,g4 as Be,g5 as ae,cZ as ze,c0 as Pe,g6 as De,g7 as Me,z as Ue,g8 as $e,bL as Fe,bM as We,w as He,bU as Ve,g9 as Ye,dC as Ge,dZ as Ze,f as qe,ga as Oe,ee as Qe,ef as Xe,eg as Je,i as oe,gb as et,m as W,gc as Z,o as tt,F as nt,c as rt,S as st,cX as at,gd as ot,ge as it,gf as lt,ca as ct,cc as dt,aP as q,p as B,an as ut,N as gt,O as z,A as pt,gg as ht}from"./App-CM6DQiPl.js";import xt from"./kubernetes-EPGtmjra.js";import{u as yt}from"./search-Wc3juolO.js";import{K as mt}from"./K8sClusterMenuItem-IYAE9FOJ.js";import{H as jt}from"./Header-GcB7EjiI.js";import{A as bt}from"./AddIntegrationTooltip-DIe93P-e.js";const _t=h.div.withConfig({displayName:"DataBreakdown__WidgetWrapper",componentId:"sc-uzfga-0"})(["display:flex;flex-direction:column;padding:",";width:100%;gap:",";border-radius:12px;border:1px solid ",";overflow:hidden;"],({theme:t})=>`${t.spacing(2)}px`,({theme:t})=>`${t.spacing(2)}px`,({theme:t})=>t.palette.divider),ft=h.div.withConfig({displayName:"DataBreakdown__TitleContainer",componentId:"sc-uzfga-1"})(["display:flex;justifycontent:space-between;flex-grow:1;margin-bottom:",";gap:",";"],({theme:t})=>`${t.spacing(1.5)}px`,({theme:t})=>`${t.spacing(10)}px`),vt=h.div.withConfig({displayName:"DataBreakdown__ProgressBar",componentId:"sc-uzfga-2"})(["display:flex;width:100%;height:6px;border-radius:60px;overflow:hidden;"]),Ct=h.div.withConfig({displayName:"DataBreakdown__ProgressSegment",componentId:"sc-uzfga-3"})(["height:100%;background-color:",";width:","%;"],({color:t})=>t,({width:t})=>t),St=h.div.withConfig({displayName:"DataBreakdown__LegendContainer",componentId:"sc-uzfga-4"})(["display:flex;align-items:center;gap:6px;"]),wt=h.div.withConfig({displayName:"DataBreakdown__LegendItem",componentId:"sc-uzfga-5"})(["display:flex;align-items:center;gap:6px;padding:",";"],({theme:t})=>`${t.spacing(.5)}px`),kt=h.div.withConfig({displayName:"DataBreakdown__LegendColor",componentId:"sc-uzfga-6"})(["background-color:",";border-radius:50%;width:6px;height:6px;"],({color:t})=>t);function It({title:t,data:r,primaryKey:s,displayStats:o=!0,totalCount:n}){const a=g.useMemo(()=>n||r.reduce((c,{count:u})=>c+u,0),[r,n]),d=g.useMemo(()=>s&&r.find(({label:c})=>(c==null?void 0:c.toLowerCase())===(s==null?void 0:s.toLowerCase())),[r,s]);return e.jsxs(_t,{children:[e.jsxs(ft,{children:[e.jsx(i,{variant:"h6",children:t}),o&&d&&e.jsx(i,{variant:"h3",children:`${(d==null?void 0:d.count)||0}/${a}`})]}),e.jsx(vt,{children:r.map(({label:c,color:u,count:x})=>e.jsx(Ct,{color:u,width:x/a*100},c))}),e.jsx(St,{children:r.map(({label:c,color:u,count:x})=>e.jsxs(wt,{children:[e.jsx(kt,{color:u}),e.jsx(i,{variant:"body1",children:x}),e.jsx(i,{variant:"body1",style:{whiteSpace:"pre"},children:c})]},c))})]})}const Tt=h.div.withConfig({displayName:"K8sIntegrationsToolbar__ToolbarContainer",componentId:"sc-1d896dz-0"})(["display:flex;flex-direction:column;overflow:'auto';"]),Nt=h.div.withConfig({displayName:"K8sIntegrationsToolbar__SummaryContainer",componentId:"sc-1d896dz-1"})(["display:flex;justify-content:space-between;width:100%;min-height:120px;gap:",";background:",";padding:",";"],({theme:t})=>`${t.spacing(2)}px`,({theme:t})=>t.palette.background.paper,({theme:t})=>`${t.spacing(2)}px`);function Et(){return e.jsx(I,{size:"small",variant:"text",startIcon:e.jsx(X,{}),children:"Filters"})}function Rt(){var s;const{data:t,loading:r}=M(J,{variables:{filters:{}}});return r?e.jsxs(l,{row:!0,gap:!0,center:!0,children:[e.jsx(A,{size:15}),e.jsx(i,{children:"Loading..."})]}):e.jsxs(l,{row:!0,gap:!0,center:!0,children:[e.jsx(xt,{width:"24",height:"24"}),e.jsx(i,{noWrap:!0,variant:"subtitle1",children:`Kubernetes Integrations (${((s=t==null?void 0:t.kubernetesSummary)==null?void 0:s.integrated_clusters_count)||0})`})]})}function At(){const{data:t,loading:r}=M(J,{variables:{filters:{}}}),[s,{loading:o}]=yt({filters:{resource_type:["eks","azure_kubernetes_service","gcp_gke_cluster"],active:!0}});if(r||o)return e.jsx(A,{});const n=t==null?void 0:t.kubernetesSummary,a=(s==null?void 0:s.length)||0,d=[{title:`Integrated Clusters ${(n==null?void 0:n.integrated_clusters_count)||0}/${a}`,data:[{label:"Connected",color:"#1E93FF",count:(n==null?void 0:n.connected_clusters_count)||0},{label:"Disconnected",color:"#DEE3E8",count:(n==null?void 0:n.disconnected_clusters_count)||0}]},{title:"Cluster Agent Status",data:[{label:"Connected",color:"#00BA7B",count:(n==null?void 0:n.connected_clusters_count)||0},{label:"Not Deployed",color:"#92A1B1",count:(n==null?void 0:n.non_deployed_clusters_count)||0},{label:"Health",color:"#FF9A00",count:(n==null?void 0:n.unhealthy_clusters_count)||0},{label:"Disconnected",color:"#D91E16",count:(n==null?void 0:n.disconnected_clusters_count)||0}]},{title:"Cluster Deployed With Runtime Agent",data:[{label:"Runtime agent",color:"#1E93FF",count:(n==null?void 0:n.runtime_agent_clusters_count)||0},{label:"No runtime agent",color:"#DEE3E8",count:((n==null?void 0:n.connected_clusters_count)||0)-((n==null?void 0:n.runtime_agent_clusters_count)||0)}],primaryKey:"with agent"},{title:"Cluster Agent Version Status",data:[{label:"Update Recommended",color:"#1E93FF",count:((n==null?void 0:n.integrated_clusters_count)||0)-((n==null?void 0:n.latest_version_clusters_count)||0)},{label:"Up to Date",color:"#DEE3E8",count:(n==null?void 0:n.latest_version_clusters_count)||0}]}];return e.jsx(we,{children:e.jsx(Nt,{children:d.map(c=>e.jsx(It,{title:c.title,data:c.data,primaryKey:c.primaryKey},c.title))})})}function Kt(){const[t,r]=Ce("k8s-page-chart-visible",!0);return e.jsxs(Tt,{children:[e.jsxs(l,{space:!0,paper:!0,header:!0,children:[e.jsx(Rt,{}),e.jsxs(l,{row:!0,gap:!0,children:[e.jsx(S,{variant:"middle",orientation:"vertical",flexItem:!0}),e.jsx(Et,{}),e.jsx(S,{variant:"middle",orientation:"vertical",flexItem:!0}),e.jsx($,{selected:t,onClick:()=>{r(!t)},children:e.jsx(Se,{fontSize:"small"})})]})]}),e.jsx(At,{})]})}const ie=h.div.withConfig({displayName:"K8sIntegrationsTable__TablePaper",componentId:"sc-10uhh4g-0"})(["background:",";&:not(:last-of-type){margin-bottom:","px;}"],t=>t.theme.palette.background.default,t=>t.theme.spacing(2)),Lt=h(ke).withConfig({displayName:"K8sIntegrationsTable__StyledTable",componentId:"sc-10uhh4g-1"})(({theme:t})=>({display:"block",[ie]:{backgroundColor:t.palette.background.paper,borderRadius:t.shape.borderRadius},[ee]:{backgroundColor:t.palette.background.paper,margin:`${t.spacing(1)}px ${t.spacing(1)}px 0 ${t.spacing(1)}px`,cursor:"pointer",position:"relative","&:hover":{backgroundColor:t.palette.action.hover}},"& > div:first-child":{margin:0,position:"sticky",top:0,zIndex:9,backgroundColor:t.palette.background.paper,borderRadius:0},'& [role="row"]':{marginBottom:t.spacing(1),"&:hover":{backgroundColor:t.palette.action.hover},"&.selected":{backgroundColor:t.palette.action.selected}},'& [role="columnheader"]':{backgroundColor:t.palette.background.default,padding:`${t.spacing(2)}px`,borderBottom:`1px solid ${t.palette.divider}`,display:"flex",alignItems:"center",gap:t.spacing(1),cursor:"pointer","&:hover":{backgroundColor:t.palette.action.hover}}})),Bt=h(l).withConfig({displayName:"K8sIntegrationsTable__MetricsGroup",componentId:"sc-10uhh4g-2"})(["display:flex;align-items:center;gap:","px;& > *:first-child{margin-right:","px;}"],t=>t.theme.spacing(2),t=>t.theme.spacing(2)),zt=h(l).withConfig({displayName:"K8sIntegrationsTable__AgentTypeContainer",componentId:"sc-10uhh4g-3"})(["display:flex;flex-direction:column;gap:","px;"],t=>t.theme.spacing(.5)),O=h(l).withConfig({displayName:"K8sIntegrationsTable__AgentType",componentId:"sc-10uhh4g-4"})(["display:flex;align-items:center;gap:","px;color:",";min-height:20px;svg{width:16px;height:16px;}p{font-size:",";line-height:1;}"],t=>t.theme.spacing(1),t=>t.theme.palette.text.secondary,t=>t.theme.typography.fontSize),Pt=h.div.withConfig({displayName:"K8sIntegrationsTable__StatusPill",componentId:"sc-10uhh4g-5"})(["padding:4px 12px;border-radius:16px;background-color:",";color:white;font-size:0.875rem;font-weight:500;display:inline-flex;align-items:center;justify-content:center;min-width:80px;"],t=>t.color);function Dt({displayName:t,resource:r}){const s=e.jsxs(l,{column:!0,children:[e.jsx(i,{variant:"h4",children:t}),r&&e.jsx(i,{variant:"body1",children:r})]});return e.jsx(re,{title:s,arrow:!0,placement:"top",children:e.jsxs(l,{column:!0,children:[e.jsx(i,{variant:"h4",style:{color:"#16161A",letterSpacing:"-0.32px"},noWrap:!0,children:t}),e.jsx(i,{variant:"body1",style:{color:"#707070",fontSize:"12px"},noWrap:!0,children:r})]})})}function Mt({status:t,statusColor:r}){return e.jsx(Pt,{color:r,children:t})}function Ut({nodes:t,pods:r,memory:s,storage:o}){return e.jsxs(Bt,{children:[e.jsx(i,{variant:"h4",children:t}),e.jsxs(l,{row:!0,gap:!0,children:[e.jsx(i,{variant:"subtitle2",children:r}),e.jsx(i,{variant:"subtitle2",children:s}),e.jsx(i,{variant:"subtitle2",children:o})]})]})}function $t({kubernetes:t,isLoading:r,sortOptions:s,onSortChange:o}){if(r)return e.jsx(te,{children:e.jsx(A,{})});const n=a=>a.cluster_type==="eks"?a.eks_arn:a.cluster_type==="azure_kubernetes_service"?a.aks_resource_id:a.cluster_type==="gcp_gke_cluster"?a.gke_resource_id:null;return e.jsx(ie,{children:e.jsxs(Lt,{data:t,loading:r,onClick:a=>console.log("clicked row:",a),sortOptions:s,onSortChange:o,identify:a=>a._id,children:[e.jsx(j,{style:{maxWidth:5},render:a=>e.jsx(Ie,{severity:Te[a.status]||1})},"severity"),e.jsx(j,{header:"Name",sortKey:"display_name",grow:2,render:a=>e.jsx(Dt,{displayName:a.display_name,resource:n(a)||null})},"name"),e.jsx(j,{header:"Agent Type",sortKey:"agent_type_sort",render:a=>e.jsxs(zt,{children:[e.jsxs(O,{children:[e.jsx(Ne,{fontSize:"small",style:{opacity:a.clusterEnabled?1:.5}}),e.jsx(i,{variant:"subtitle2",children:"Cluster"})]}),a.runtimeEnabled&&e.jsxs(O,{children:[e.jsx(ne,{fontSize:"small"}),e.jsx(i,{variant:"subtitle2",children:"Runtime"})]})]})},"agent_type"),e.jsx(j,{header:"Status",sortKey:"status",render:a=>e.jsx(Mt,{status:a.status,statusColor:a.status_color})},"status"),e.jsx(j,{header:"Runtime Agent Reporting",sortKey:"nodes_sort",render:a=>e.jsx(Ut,{nodes:a.nodes,pods:a.pods,memory:a.memory,storage:a.storage})},"runtime_agent"),e.jsx(j,{header:"Version",sortKey:"version",render:a=>e.jsx(l,{row:!0,center:!0,gap:!0,children:e.jsx(i,{variant:"h4",children:a.version})})},"version"),e.jsx(j,{header:"Last Seen",sortKey:"lastUpdated",render:a=>e.jsx(l,{row:!0,center:!0,gap:!0,children:e.jsx(i,{variant:"subtitle2",children:a.lastUpdated})})},"last_seen"),e.jsx(j,{fit:!0,render:()=>e.jsx(Ee,{fontSize:"small"})},"right_icon")]})})}const E={disconnected:{label:"Disconnected",color:T.ERROR.color,severity:"ERROR"},connected:{label:"Connected",color:T.READY.color,severity:"READY"},unhealthy:{label:"Unhealthy",color:T.UNHEALTHY.color,severity:"UNHEALTHY"},"not deployed":{label:"Not Deployed",color:T.UNINITIALIZED.color,severity:"UNINITIALIZED"},pending:{label:"Pending",color:T.PENDING.color,severity:"PENDING"}},N={nodes:"4/10",pods:3,memory:12,storage:3,version:"2.23.3",lastUpdated:"1 day ago",health:"Connected",accountId:"aws-prod-acc12",clusterEnabled:!0,runtimeEnabled:!0};function Ft(t,r){const s=(o,n)=>{if(!(o!=null&&o.last_event_at))return"not deployed";const a=new Date(o.last_event_at),d=new Date(Date.now()-n*2e3);return a>=d?"connected":"disconnected"};return g.useMemo(()=>{if(!(t!=null&&t.data)||!r)return[];const o=t.data.map(n=>{var b,p,k,C;const a={_id:n._id||"",type:n.type||"",display_name:n.display_name||"",creation_date:n.creation_date||"",collection_token:n.collection_token||"",cluster_type:n.cluster_type||"",cloud_account_id:n.cloud_account_id||"",region:n.region||"",eks_arn:n.eks_arn||"",full_scan_period:n.full_scan_period||0,runtime_agent_enabled:n.runtime_agent_enabled||!1,events_disabled:n.events_disabled||!1,agents:n.agents,log_collectors:n.log_collectors},d=(b=a.log_collectors)==null?void 0:b.collector,c=s(d,a.full_scan_period),u=E[c]||E["not deployed"];return{...a,status:u.severity,status_color:((p=E[c])==null?void 0:p.color)||E["not deployed"].color,version:((C=(k=a.agents)==null?void 0:k.cluster_agent)==null?void 0:C.version)||"-",lastUpdated:(d==null?void 0:d.last_event_at)||null,health:u.label,accountId:a.cloud_account_id,runtimeEnabled:a.runtime_agent_enabled||!1,clusterEnabled:!a.events_disabled,unhealthy_agents_count:0,connected_agents_count:1,disconnected_agents_count:0,non_deployed_agents_count:0,nodes:N.nodes,pods:N.pods,memory:N.memory,storage:N.storage,agent_type_sort:(a.events_disabled?0:2)+(a.runtime_agent_enabled?1:0),nodes_sort:parseInt(N.nodes.split("/")[0],10)}});return r!=null&&r.sort_by&&o.sort((n,a)=>{const d=n[r.sort_by],c=a[r.sort_by];if(d===null||c===null||d===void 0||c===void 0)return 0;if(typeof d=="string"&&typeof c=="string")return r.sort_order*d.localeCompare(c);const u=Number(d),x=Number(c);return!Number.isNaN(u)&&!Number.isNaN(x)?r.sort_order*(u-x):r.sort_order*(d>c?1:-1)}),o},[t,r])}function Wt(t="display_name"){const[r,s]=g.useState({sort_by:t,sort_order:1}),o=g.useCallback(n=>{n&&(typeof n=="object"&&"sort_by"in n?s(n):s(a=>{let d=1;return a.sort_by===n&&(d=a.sort_order===1?-1:1),{sort_by:n,sort_order:d}}))},[]);return{sortOptions:r,handleSort:o}}function Ht(){const{sortOptions:t,handleSort:r}=Wt("display_name"),{data:s,isLoading:o,error:n}=Re.integrations.kubernetes.useQuery();return{kubernetes:Ft(s,t),isLoading:o,error:n,sortOptions:t,handleSort:r}}const Vt=h.div.withConfig({displayName:"K8sIntegrationsPage__Container",componentId:"sc-1g1nyz6-0"})(["display:flex;flex-direction:column;height:100%;overflow:auto;background-color:",";"],t=>t.theme.palette.background.default),Yt=h.div.withConfig({displayName:"K8sIntegrationsPage__MainContent",componentId:"sc-1g1nyz6-1"})(["flex-basis:100%;background-color:",";"],t=>t.theme.palette.background.default);function Gt(){const{kubernetes:t,isLoading:r,error:s,sortOptions:o,handleSort:n}=Ht(),a=()=>s?e.jsx(te,{children:e.jsx(Ke,{error:s})}):e.jsx($t,{kubernetes:t,isLoading:r,sortOptions:o,onSortChange:n});return e.jsxs(Ae,{display:"flex",flexDirection:"column",height:"100%",children:[e.jsx(Kt,{}),e.jsx(Vt,{children:e.jsx(Yt,{children:a()})})]})}const Zt=[{node_name:"Node 1",status:"connected",version:"v1.18.0",last_seen_at:"2023-10-01T12:00:00Z"},{node_name:"Node 2",status:"disconnected",version:"v1.18.0",last_seen_at:"2023-10-01T12:00:00Z"},{node_name:"Node 3",status:"not_deployed",version:"v1.18.0",last_seen_at:"2023-10-01T12:00:00Z"},{node_name:"Node 4",status:"unhealthy",version:"v1.18.0",last_seen_at:"2023-10-01T12:00:00Z"}],qt=[{_id:"5f9b1b3b7b7b4b0001b3b7b4",display_name:"Kubernetes Cluster 1",status:"connected",runtime_agent_enabled:!0,cluster_agent_version:"v1.18.0",last_seen_at:"2023-10-01T12:00:00Z",connected_agents_count:0,disconnected_agents_count:0,unhealthy_agents_count:0,non_deployed_agents_count:2}];function Ot(t){const[r,s]=g.useState(null),[o,n]=g.useState(!0);return g.useEffect(()=>{n(!0),setTimeout(()=>{s(qt[0]),n(!1)},1e3)},[t]),{data:r,loading:o}}function Qt(t){const[r,s]=g.useState(null),[o,n]=g.useState(!0);return g.useEffect(()=>{n(!0),setTimeout(()=>{s(Zt),n(!1)},1e3)},[t]),{data:r,loading:o}}const Xt=h.div.withConfig({displayName:"StatusTag",componentId:"sc-1dbr776-0"})(({theme:t,color:r="white",backgroundColor:s="white",size:o="small"})=>({backgroundColor:s,color:r,borderRadius:t.shape.borderRadius*2,padding:t.spacing(.5,1.5),display:"block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",...o==="small"&&{fontSize:t.typography.caption.fontSize,height:t.spacing(4)},...o==="large"&&{fontSize:t.typography.h4.fontSize,borderRadius:t.shape.borderRadius*1.5,height:32}}));function le({status:t}){var o;const r=he(),s={connected:r.palette.success.main,disconnected:"#D91E16",unhealthy:r.palette.warning.main,not_deployed:r.palette.grey[500]};return e.jsx(Xt,{backgroundColor:s[t],children:e.jsx(i,{variant:"body1",style:{color:"inherit",fontWeight:500},children:((o=E[t])==null?void 0:o.label)||t})})}function Jt({name:t,status:r}){return e.jsxs(l,{row:!0,gap:!0,center:!0,children:[e.jsx(F,{size:"medium",type:"kubernetes"}),e.jsx(i,{variant:"h4",children:t}),e.jsx(le,{status:r})]})}const H=se(l)({padding:"12px",flex:1});function en({apiKey:t,cloudAccount:r}){return e.jsxs(H,{column:!0,gap:2,children:[e.jsxs(l,{row:!0,gap:!0,center:!0,children:[e.jsx(Le,{}),e.jsx(i,{variant:"h4",children:"Cluster Information"})]}),e.jsxs(l,{column:!0,gap:4,style:{padding:"0 24px"},children:[e.jsxs(l,{column:!0,gap:!0,children:[e.jsx(i,{variant:"body1",color:"textSecondary",children:"Cluster API Key"}),e.jsx(i,{variant:"body1",children:t})]}),e.jsxs(l,{column:!0,gap:!0,children:[e.jsx(i,{variant:"body1",color:"textSecondary",children:"Cloud Account"}),e.jsx(i,{variant:"body1",children:r})]})]})]})}function tn({agentId:t,version:r,namespace:s,health:o}){return e.jsxs(H,{column:!0,gap:2,children:[e.jsxs(l,{row:!0,gap:!0,center:!0,children:[e.jsx(Be,{}),e.jsx(i,{variant:"h4",children:"Cluster Agent Details"})]}),e.jsxs(l,{column:!0,gap:4,style:{padding:"0 24px"},children:[e.jsxs(l,{row:!0,gap:!0,children:[e.jsxs(l,{column:!0,gap:!0,grow:!0,children:[e.jsx(i,{variant:"body1",color:"textSecondary",children:"Agent ID"}),e.jsx(i,{variant:"body1",children:t})]}),e.jsxs(l,{column:!0,gap:!0,grow:!0,children:[e.jsx(i,{variant:"body1",color:"textSecondary",children:"Version"}),e.jsx(i,{variant:"body1",children:r})]})]}),e.jsxs(l,{row:!0,gap:!0,children:[e.jsxs(l,{column:!0,gap:!0,grow:!0,children:[e.jsx(i,{variant:"body1",color:"textSecondary",children:"Namespace"}),e.jsx(i,{variant:"body1",children:s})]}),o&&e.jsxs(l,{column:!0,gap:!0,grow:!0,children:[e.jsx(i,{variant:"body1",color:"textSecondary",children:"Health"}),e.jsx(i,{variant:"body1",children:o})]})]})]})]})}function nn({checked:t}){const r={width:"12px",height:"12px"};return t?e.jsx(De,{style:{...r,color:"#1E93FF"}}):e.jsx(Me,{style:r})}function P({name:t,checked:r,isEdit:s}){const{control:o}=ae();return e.jsxs(l,{row:!0,center:!0,gap:!0,children:[s?e.jsx(ze,{name:t,control:o,render:({field:n})=>e.jsx(Pe,{size:"small",checked:n.value,onChange:n.onChange})}):e.jsx(nn,{checked:r}),e.jsx(i,{variant:"body1",children:xe(t)})]})}function rn(){return e.jsxs(l,{column:!0,gap:!0,children:[e.jsx(i,{variant:"body1",color:"textSecondary",children:"Collects Kubernetes workloads eBPF events to detect network, process, and file activities security incidents."}),e.jsx(l,{row:!0,children:e.jsx(I,{variant:"text",color:"primary",children:"Deploy Runtime Agent"})})]})}function sn({isEdit:t,onEdit:r,networkSecurity:s,processesSecurity:o,filesSecurity:n,reportingAgents:a,totalAgents:d}){const{formState:{errors:c}}=ae();return e.jsxs(e.Fragment,{children:[e.jsxs(l,{column:!0,gap:!0,children:[e.jsx(i,{variant:"body1",color:"textSecondary",children:"Detection Mode"}),e.jsxs(l,{row:!0,gap:2,center:!0,children:[e.jsx(P,{name:"networkSecurity",checked:s,isEdit:t}),e.jsx(P,{name:"processesSecurity",checked:o,isEdit:t}),e.jsx(P,{name:"filesSecurity",checked:n,isEdit:t}),!t&&e.jsx(I,{variant:"text",onClick:r,children:"Edit"})]}),c.root&&e.jsx(i,{variant:"body2",color:"error",children:c.root.message})]}),e.jsxs(l,{column:!0,gap:!0,children:[e.jsx(i,{variant:"body1",color:"textSecondary",children:"Runtime Agent Reporting Coverage"}),e.jsxs(i,{variant:"body1",children:[a,"/",d]})]})]})}function an({networkSecurity:t,processesSecurity:r,filesSecurity:s,reportingAgents:o,totalAgents:n,isDeployed:a}){const d=Ue({mode:"onChange",defaultValues:{networkSecurity:t,processesSecurity:r,filesSecurity:s}}),{watch:c,setError:u,clearErrors:x}=d,b=c(),p=Object.values(b).every(v=>!v);g.useEffect(()=>{p?u("root",{type:"manual",message:"Please select at least one detection type: Network, Process, or File"}):x("root")},[p,u,x]);const k=U(),[C,w]=g.useState(!1),_=()=>w(!1),f=()=>w(!0),y=v=>{console.log(v),k("Changes saved successfully!","success"),_()};return e.jsxs(H,{column:!0,gap:2,children:[e.jsxs(l,{row:!0,gap:!0,center:!0,children:[e.jsx(ne,{}),e.jsx(i,{variant:"h4",children:"Runtime Agent"}),e.jsx(l,{grow:!0}),C&&e.jsxs(l,{row:!0,gap:2,center:!0,children:[e.jsx(I,{variant:"text",onClick:_,children:"Dismiss"}),e.jsx(I,{variant:"contained",color:"primary",onClick:d.handleSubmit(y),children:"Save Changes"})]})]}),e.jsx($e,{...d,children:e.jsx(l,{column:!0,gap:4,style:{padding:"0 24px"},children:a?e.jsx(sn,{onEdit:f,isEdit:C,networkSecurity:t,processesSecurity:r,filesSecurity:s,reportingAgents:o||0,totalAgents:n||0}):e.jsx(rn,{})})})]})}function on({apiKey:t,cloudAccount:r,agentId:s,version:o,namespace:n}){return e.jsxs(l,{row:!0,gap:2,center:!0,children:[e.jsxs(l,{row:!0,gap:!0,children:[e.jsx(i,{variant:"body1",color:"textSecondary",children:"Cluster API Key"}),e.jsx(i,{variant:"body1",children:t})]}),e.jsx(S,{orientation:"vertical",flexItem:!0}),e.jsxs(l,{row:!0,gap:!0,children:[e.jsx(i,{variant:"body1",color:"textSecondary",children:"Cloud Account"}),e.jsx(i,{variant:"body1",children:r})]}),e.jsx(S,{orientation:"vertical",flexItem:!0}),e.jsxs(l,{row:!0,gap:!0,children:[e.jsx(i,{variant:"body1",color:"textSecondary",children:"Agent ID"}),e.jsx(i,{variant:"body1",children:s})]}),e.jsx(S,{orientation:"vertical",flexItem:!0}),e.jsxs(l,{row:!0,gap:!0,children:[e.jsx(i,{variant:"body1",color:"textSecondary",children:"Namespace"}),e.jsx(i,{variant:"body1",children:n})]}),e.jsx(S,{orientation:"vertical",flexItem:!0}),e.jsxs(l,{row:!0,gap:!0,children:[e.jsx(i,{variant:"body1",color:"textSecondary",children:"Version"}),e.jsx(i,{variant:"body1",children:o})]})]})}const ln=se(l)(({theme:t})=>({padding:"16px 24px",backgroundColor:t.palette.background.paper,borderRadius:t.spacing(2)}));function cn({clusterInfo:t,clusterAgentData:r,agentData:s}){const[o,n]=g.useState(!0);return e.jsxs(ln,{column:!0,children:[e.jsxs(l,{row:!0,center:!0,gap:4,children:[e.jsx(i,{variant:"h4",children:"Cluster Overview"}),o&&e.jsx(on,{...t,...r}),e.jsx(l,{grow:!0}),e.jsx($,{onClick:()=>n(!o),children:o?e.jsx(Fe,{}):e.jsx(We,{})})]}),e.jsx(He,{in:!o,children:e.jsxs(l,{row:!0,children:[e.jsx(en,{...t}),e.jsx(S,{orientation:"vertical",flexItem:!0}),e.jsx(tn,{...r}),e.jsx(S,{orientation:"vertical",flexItem:!0}),e.jsx(an,{...s})]})})]})}const dn=h(Ge).withConfig({displayName:"K8sClusterTable__CustomTable",componentId:"sc-1k4mq6y-0"})(({theme:t})=>({borderRadius:"12px 12px 0 0",overflow:"hidden",[Ve]:{borderRadius:0,padding:t.spacing(1,4),margin:"0px !important",[Ye]:{alignSelf:"center"}},[ee]:{paddingRight:t.spacing(4),paddingLeft:t.spacing(4),height:48,borderRadius:0,backgroundColor:t.palette.background.paper,"&:nth-child(odd)":{borderTop:"1px solid #E9ECEF",borderBottom:"1px solid #E9ECEF"}}})),un=h(Ze).withConfig({displayName:"K8sClusterTable__StyledWarningIcon",componentId:"sc-1k4mq6y-1"})(({theme:t})=>({width:16,height:16,color:t.palette.primary.main}));function gn(t){const{data:r,totalCount:s}=t;return e.jsxs(dn,{...t,stickyHeader:!0,data:r,totalCount:s,identify:o=>o.node_name,children:[e.jsx(j,{grow:2,style:{maxWidth:320},header:e.jsxs(i,{variant:"h6",color:"textSecondary",children:["Cluster Nodes (",s,")"]}),render:o=>e.jsx(l,{center:!0,gap:2,row:!0,children:e.jsx(i,{variant:"body1",children:o.node_name})})}),e.jsx(j,{header:e.jsx(i,{variant:"body1",color:"textSecondary",children:"Status"}),style:{maxWidth:150},render:o=>e.jsx(l,{row:!0,grow:!0,gap:!0,children:e.jsx(le,{status:o.status})})}),e.jsx(j,{header:e.jsx(i,{variant:"body1",color:"textSecondary",children:"Version"}),style:{maxWidth:100},render:o=>e.jsxs(l,{row:!0,grow:!0,gap:!0,children:[e.jsx(i,{variant:"body1",children:o.version}),e.jsx(re,{title:e.jsxs(l,{column:!0,gap:1,style:{maxWidth:220},children:[e.jsx(i,{variant:"body1",color:"primary",children:"Update available"}),e.jsx(i,{variant:"body1",children:"Please consider upgrading to ensure optimal performance and security."})]}),placement:"top",children:e.jsx(un,{})})]})}),e.jsx(j,{style:{maxWidth:200},header:e.jsx(i,{variant:"body1",color:"textSecondary",children:"Last Seen"}),render:o=>e.jsx(l,{row:!0,grow:!0,gap:!0,children:e.jsx(i,{variant:"body1",color:"textSecondary",children:Q(o.last_seen_at).fromNow()})})})]})}function pn(){const t=ye(),{id:r}=me(),{data:s,loading:o}=Ot(r),{data:n,loading:a}=Qt(r),d={apiKey:"key",cloudAccount:"account"},c={agentId:"id",version:(s==null?void 0:s.cluster_agent_version)||"",namespace:"namespace",health:"health"},u={networkSecurity:!1,processesSecurity:!0,filesSecurity:!0,reportingAgents:15,totalAgents:20,isDeployed:!0};return o||!s?null:e.jsxs(l,{column:!0,fullHeight:!0,gap:2,children:[e.jsxs(l,{header:!0,paper:!0,gap:!0,children:[e.jsx($,{size:"small",onClick:()=>t.goBack(),children:e.jsx(qe,{})}),e.jsx(Jt,{name:s==null?void 0:s.display_name,status:s==null?void 0:s.status}),e.jsx(l,{grow:!0}),e.jsxs(l,{row:!0,gap:2,center:!0,children:[e.jsxs(l,{row:!0,gap:!0,center:!0,children:[e.jsx(Oe,{}),e.jsx(i,{variant:"body1",children:Q(s==null?void 0:s.last_seen_at).format("DD MMMM YYYY, hh:mm:ss A")})]}),e.jsx(I,{variant:"outlined",startIcon:e.jsx(X,{}),children:"Filter"})]})]}),e.jsx(l,{row:!0,grow:!0,children:e.jsx(l,{column:!0,grow:!0,children:e.jsxs(l,{column:!0,grow:!0,scroll:!0,gap:2,style:{padding:"0 12px"},children:[e.jsx(cn,{clusterInfo:d,clusterAgentData:c,agentData:u}),e.jsx(gn,{data:n,loading:a,totalCount:(n==null?void 0:n.length)||0})]})})})]})}var V={},hn=Xe,xn=Je;Object.defineProperty(V,"__esModule",{value:!0});var D=V.default=void 0,yn=xn(g),mn=hn(Qe()),jn=(0,mn.default)(yn.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}),"Info");D=V.default=jn;function bn({onUpdateStep:t,clusters:r=[],runtimeAgentEnabled:s=!0}){const[o]=oe(et),[n,a]=g.useState(null),[d,c]=g.useState(!1),[u,x]=g.useState(""),[b,p]=g.useState({isLoading:!1,message:""}),k=U();return{selectedValue:u,clusterCreated:d,integrationData:n,handleClusterSelect:f=>{const{value:y}=f.target;d||x(y)},handleClose:()=>{t(null)},loadingState:b,createCluster:async()=>{if(!u)throw new Error("No cluster selected");const f=r.find(y=>y.id===u);if(!f)throw new Error("Selected cluster not found");p({isLoading:!0,message:"Creating cluster..."});try{const y=await o({variables:{kubernetes:{display_name:f.display_name,cluster_type:f.type,eks_arn:u,runtime_agent_enabled:s,tracing_policies:s?{network:!0,process:!1,files:!1}:void 0}}}),v={_id:y.data.createKubernetes._id,collection_token:y.data.createKubernetes.collection_token,clusterName:f.display_name,clusterType:f.type};return t(v),a(v),c(!0),v}catch(y){throw k(y.message,"error"),x(""),c(!1),y}finally{p({isLoading:!1,message:""})}}}}const _n=W(t=>({apiKeySection:{marginBottom:t.spacing(3),"& > div":{display:"flex",alignItems:"center","& > span":{color:r=>!r.clusterCreated&&t.palette.text.disabled}}},helmSection:{marginBottom:t.spacing(3),"& > *:not(:last-child)":{marginBottom:t.spacing(2)},"& > div:has(> span)":{height:144,display:"flex","& > span":{color:r=>!r.clusterCreated&&t.palette.text.disabled}}}}));function fn({clusterCreated:t,integrationData:r,runtimeAgentEnabled:s}){const o=_n({clusterCreated:t}),n=()=>`helm repo add lightlytics https://lightlytics.github.io/helm-charts
helm repo update
helm install lightlytics
--set lightlytics.apiToken=${r==null?void 0:r.collection_token}
--set lightlytics.apiUrl=app.stage.lightops.io
${s?`--set lightlytics.runtime.enabled=true 
`:""}-n lightlytics
--create-namespace lightlytics/lightlytics`;return e.jsxs("div",{children:[e.jsx(i,{variant:"subtitle2",gutterBottom:!0,children:"Cluster API key"}),e.jsx(i,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:t?"Copy this API key to use in the setup.":"Please select a cluster and click Add Integration to generate an API key"}),e.jsx("div",{className:o.apiKeySection,children:e.jsx(Z,{text:(r==null?void 0:r.collection_token)||"API key will appear here after cluster selection",disableCopy:!(r!=null&&r.collection_token)})}),e.jsxs("div",{className:o.helmSection,children:[e.jsx(i,{variant:"subtitle2",gutterBottom:!0,children:"Install with Helm™"}),e.jsx(i,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:"Run the following command in your Kubernetes environment, when the agent is up verify the status is Connected:"}),e.jsx(Z,{text:t?n():"Helm command will appear here after cluster selection",disableCopy:!t})]}),e.jsxs(i,{variant:"body2",color:"textSecondary",children:["Visit the"," ",e.jsx(tt,{href:"https://github.com/lightlytics/helm-charts",target:"_blank",color:"secondary",children:"Helm Charts repository"})," ","for a complete list of configuration parameters and their values."]})]})}const vn=W(t=>({clusterSelect:{marginTop:t.spacing(2),marginBottom:t.spacing(3)},select:{height:70,animation:r=>r.clusterCreated?"none":"$pulse 2s ease-in-out infinite","& .MuiPaper-root":{maxHeight:700,boxShadow:"0px 4px 10px rgba(0, 0, 0, 0.1)"}},menuItem:{width:"540px",borderRadius:t.shape.borderRadius,marginLeft:t.spacing(1),marginRight:t.spacing(1),marginBottom:t.spacing(1),padding:t.spacing(2),"&:hover":{backgroundColor:t.palette.action.hover}},loadingLabel:{display:"flex",alignItems:"center",gap:t.spacing(2),"& .MuiCircularProgress-root":{marginLeft:t.spacing(1)},"& > span:first-child":{fontSize:"1rem"}},loadingText:{fontSize:"0.9rem",color:t.palette.primary.main,fontWeight:500},"@keyframes pulse":{"0%":{opacity:1,backgroundColor:t.palette.background.paper},"50%":{opacity:.97,backgroundColor:t.palette.action.hover},"100%":{opacity:1,backgroundColor:t.palette.background.paper}}}));function Cn({selectedValue:t,clusters:r,loading:s,clustersLoading:o,errors:n,loadingState:a,onClusterSelect:d,clusterCreated:c}){const u=vn({clusterCreated:c}),x=g.useMemo(()=>n.cluster_id?n.cluster_id:!r.length&&!o?"No clusters available":null,[n.cluster_id,r,o]),b=g.useMemo(()=>{if(s||o||a.isLoading)return e.jsxs("div",{className:u.loadingLabel,children:[e.jsx(A,{size:20}),e.jsx(i,{variant:"body2",className:u.loadingText,children:a.message||"Loading..."})]})},[s,o,a.isLoading,a.message,u.loadingLabel,u.loadingText]);return e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"subtitle2",gutterBottom:!0,children:"Select Cluster"}),e.jsx(i,{variant:"body1",color:"textSecondary",children:"Select the Kubernetes cluster to begin the setup process."}),e.jsxs(nt,{variant:"outlined",className:u.clusterSelect,fullWidth:!0,children:[e.jsx(rt,{children:b}),e.jsx(st,{label:b,value:t,onChange:p=>d(p,r),disabled:s||o||!r.length||c,error:!!n.cluster_id,className:u.select,MenuProps:{PaperProps:{style:{maxHeight:700,overflowY:"auto"}}},children:(r||[]).map(p=>e.jsx(at,{value:p.id,className:u.menuItem,children:e.jsx(mt,{id:p.id,displayName:p.display_name,type:p.type,accountName:p.account_name})},p.id))}),x&&e.jsx(ot,{error:!0,children:x})]})]})}const Sn=W(t=>({content:{padding:t.spacing(3)},container:{display:"flex",flexDirection:"column",width:"100%","& > *:not(:last-child)":{}},description:{marginBottom:t.spacing(3)},togglesContainer:{display:"flex",gap:t.spacing(4),alignItems:"center"},toggleWrapper:{display:"flex",alignItems:"center",gap:t.spacing(1)},infoIcon:{fontSize:16,color:t.palette.text.secondary,cursor:"help"},divider:{margin:t.spacing(2,0)},submitButtons:{display:"flex",justifyContent:"flex-end",gap:t.spacing(1),marginTop:t.spacing(3)},generateButton:{marginLeft:"auto"}}));function ce(t){const{updateStep:r,setLoading:s,loading:o,onClose:n}=t,[a,d]=g.useState(!0),[c]=g.useState({}),u=U(),[x]=oe(it),b=M(lt),{data:{notIntegratedClusters:p=[]}={},loading:k}=b,{selectedValue:C,clusterCreated:w,integrationData:_,handleClusterSelect:f,handleClose:y,loadingState:v,createCluster:de}=bn({onUpdateStep:r,clusters:p,runtimeAgentEnabled:a}),m=Sn({clusterCreated:w}),K=()=>{y(),n()},ue=async()=>{if(C){s(!0);try{await de()}finally{s(!1)}}},ge=async pe=>{const R=pe.target.checked;if(d(R),_!=null&&_._id&&w){s(!0);try{await x({variables:{id:_._id,kubernetes:{display_name:_.clusterName,runtime_agent_enabled:R,tracing_policies:R?{network:!0,process:!1,files:!1}:void 0}}})}catch(Y){d(!R),Y instanceof Error&&u(Y.message,"error")}finally{s(!1)}}},L=o||v.isLoading;return e.jsx(ct,{open:!0,onClose:K,children:e.jsx(dt,{className:m.content,children:e.jsxs("div",{className:m.container,children:[e.jsxs("div",{className:m.description,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(F,{type:"kubernetes"}),e.jsx(i,{variant:"body1",gutterBottom:!0,children:"Kubernetes Cluster Agent"})]}),e.jsx(S,{className:m.divider}),e.jsx(i,{variant:"body1",gutterBottom:!0,children:"This integration allows you to deploy the Kubernetes Cluster Agent and Runtime Agent modules seamlessly."})]}),e.jsx(Cn,{selectedValue:C,clusters:p,loading:L,clustersLoading:k,errors:c,loadingState:v,onClusterSelect:f,clusterCreated:w}),e.jsxs("div",{className:m.togglesContainer,children:[e.jsxs("div",{className:m.toggleWrapper,children:[e.jsx(q,{checked:!0,disabled:!0,color:"primary"}),e.jsx(i,{children:"Cluster Agent"}),e.jsx(D,{className:m.infoIcon})]}),e.jsxs("div",{className:m.toggleWrapper,children:[e.jsx(q,{checked:a,onChange:ge,color:"primary",disabled:o||v.isLoading}),e.jsx(i,{children:"Runtime Agent"}),e.jsx(D,{className:m.infoIcon})]}),e.jsx(B,{variant:"contained",color:"primary",className:m.generateButton,onClick:ue,disabled:!C||L||w,children:L?"Generating...":"Generate Token"})]}),e.jsx(S,{className:m.divider}),e.jsx(fn,{clusterCreated:w,integrationData:_?{collection_token:_.collection_token}:void 0,runtimeAgentEnabled:a}),e.jsxs("div",{className:m.submitButtons,children:[e.jsx(B,{variant:"outlined",onClick:K,children:"Cancel"}),e.jsx(B,{variant:"contained",color:"primary",onClick:K,children:"Close"})]})]})})})}const wn=[{Component:ce,stepLabel:"Configure Integration",maxWidth:"600px",hideSubmit:!0,Icon:()=>e.jsx(F,{size:"small",type:"kubernetes"}),label:"Add Kubernetes Runtime Integration"}];function kn({setIntegrationSteps:t}){const r=()=>{t({steps:wn})};return e.jsx(bt,{id:"k8s-addIntegration-button",startIcon:e.jsx(pt,{fontSize:"large",color:"action"}),color:"default",onClick:r,children:"Add Runtime Integration"})}function In({userHasNoGroups:t,history:r,setIntegrationSteps:s}){var n,a;const o=(a=(n=je())==null?void 0:n.split("/"))==null?void 0:a[1];return e.jsx(jt,{Icon:ut,title:"Settings",selector:e.jsxs(gt,{onChange:(d,c)=>{r.push(c)},value:o,children:[e.jsx(z,{value:"integrations",label:"Integrations"}),e.jsx(z,{value:"k8s",label:"K8s Integrations"}),e.jsx(z,{value:"collection",label:"Log Collection Status"})]}),actions:!t&&e.jsx(kn,{setIntegrationSteps:s})})}function Bn(){const{url:t}=be(),r=_e(),{workspaceId:s}=fe(),o=ht(s),[n,a]=g.useState(null),d=c=>{c===null&&a(null)};return e.jsxs(e.Fragment,{children:[e.jsx(In,{userHasNoGroups:o,history:r,setIntegrationSteps:a}),e.jsxs(ve,{children:[e.jsx(G,{path:`${t}/:id`,component:pn}),e.jsx(G,{component:Gt})]}),n&&e.jsx(ce,{updateStep:d,setLoading:()=>{},loading:!1,onClose:()=>a(null)})]})}export{Bn as default};
