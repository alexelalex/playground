import{m as ke,e as xe,r as g,o as Ae,R as B,q as b,j as t,n as ue,l as he,C as G,a4 as J,a5 as Me,a6 as U,a7 as K,a8 as Z}from"./index-Ba6YVotX.js";import{cA as ze,d as p,cB as Le,cC as Be,cD as De,cE as ne,bD as me,L as h,b as y,cF as Ne,cG as Pe,cH as Fe,cI as Ue,B as L,cJ as Ve,as as ae,g as oe,aL as Oe,cK as We,aw as S,cL as re,cM as q,aM as ee,cN as je,cO as fe,cP as ge,n as be,bl as A,cQ as $e,cR as Ge,cS as qe,R as He,cT as Ye,cU as pe,cV as Je,U as Ke,cW as ie,S as le,a as z,cX as F,T as Qe,I as ce,D as te,A as de,cY as Xe,bu as Ze,M as et,bO as tt,bv as st,cZ as k,c_ as nt,c$ as at,d0 as ot,d1 as ye,d2 as rt,bT as it,F as Ce,h as lt,d3 as ct,d4 as dt,C as pt}from"./App-CM6DQiPl.js";import{P as xt}from"./PortsInput-DgwKjCEH.js";var we={exports:{}};/*! streamsaver. MIT License. Jimmy WÃ¤rting <https://jimmy.warting.se/opensource> */(function(e){((s,n)=>{e.exports=n()})("streamSaver",()=>{const s=typeof window=="object"?window:this;s.HTMLElement||console.warn("streamsaver is meant to run on browsers main thread");let n=null,a=!1;const o=x=>{try{x()}catch{}},r=s.WebStreamsPolyfill||{},i=s.isSecureContext;let d=/constructor/i.test(s.HTMLElement)||!!s.safari||!!s.WebKitPoint;const j=i||"MozAppearance"in document.documentElement.style?"iframe":"navigate",l={createWriteStream:C,WritableStream:s.WritableStream||r.WritableStream,supported:!0,version:{full:"2.0.5",major:2,minor:0,dot:5},mitm:"https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=2.0.0"};function _(x){if(!x)throw new Error("meh");const c=document.createElement("iframe");return c.hidden=!0,c.src=x,c.loaded=!1,c.name="iframe",c.isIframe=!0,c.postMessage=(...w)=>c.contentWindow.postMessage(...w),c.addEventListener("load",()=>{c.loaded=!0},{once:!0}),document.body.appendChild(c),c}function R(x){const c="width=200,height=100",w=document.createDocumentFragment(),m={frame:s.open(x,"popup",c),loaded:!1,isIframe:!1,isPopup:!0,remove(){m.frame.close()},addEventListener(...u){w.addEventListener(...u)},dispatchEvent(...u){w.dispatchEvent(...u)},removeEventListener(...u){w.removeEventListener(...u)},postMessage(...u){m.frame.postMessage(...u)}},M=u=>{u.source===m.frame&&(m.loaded=!0,s.removeEventListener("message",M),m.dispatchEvent(new Event("load")))};return s.addEventListener("message",M),m}try{new Response(new ReadableStream),i&&!("serviceWorker"in navigator)&&(d=!0)}catch{d=!0}o(()=>{const{readable:x}=new TransformStream,c=new MessageChannel;c.port1.postMessage(x,[x]),c.port1.close(),c.port2.close(),a=!0,Object.defineProperty(l,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})});function T(){n||(n=i?_(l.mitm):R(l.mitm))}function C(x,c,w){let m={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},M=0,u=null,f=null,N=null;if(Number.isFinite(c)?([w,c]=[c,w],console.warn("[StreamSaver] Deprecated pass an object as 2nd argument when creating a write stream"),m.size=w,m.writableStrategy=c):c&&c.highWaterMark?(console.warn("[StreamSaver] Deprecated pass an object as 2nd argument when creating a write stream"),m.size=w,m.writableStrategy=c):m=c||{},!d){T(),f=new MessageChannel,x=encodeURIComponent(x.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A");const v={transferringReadable:a,pathname:m.pathname||Math.random().toString().slice(-6)+"/"+x,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+x}};m.size&&(v.headers["Content-Length"]=m.size);const E=[v,"*",[f.port2]];if(a){const I=j==="iframe"?void 0:{transform(Y,Ee){if(!(Y instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");M+=Y.length,Ee.enqueue(Y),u&&(location.href=u,u=null)},flush(){u&&(location.href=u)}};N=new l.TransformStream(I,m.writableStrategy,m.readableStrategy);const W=N.readable;f.port1.postMessage({readableStream:W},[W])}f.port1.onmessage=I=>{I.data.download?j==="navigate"?(n.remove(),n=null,M?location.href=I.data.download:u=I.data.download):(n.isPopup&&(n.remove(),n=null,j==="iframe"&&_(l.mitm)),_(I.data.download)):I.data.abort&&(P=[],f.port1.postMessage("abort"),f.port1.onmessage=null,f.port1.close(),f.port2.close(),f=null)},n.loaded?n.postMessage(...E):n.addEventListener("load",()=>{n.postMessage(...E)},{once:!0})}let P=[];return!d&&N&&N.writable||new l.WritableStream({write(v){if(!(v instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");if(d){P.push(v);return}f.port1.postMessage(v),M+=v.length,u&&(location.href=u,u=null)},close(){if(d){const v=new Blob(P,{type:"application/octet-stream; charset=utf-8"}),E=document.createElement("a");E.href=URL.createObjectURL(v),E.download=x,E.click()}else f.port1.postMessage("end")},abort(){P=[],f.port1.postMessage("abort"),f.port1.onmessage=null,f.port1.close(),f.port2.close(),f=null}},m.writableStrategy)}return l})})(we);var ut=we.exports;const ht=ke(ut),cs=({rule_ids:e,attack_path_ids:s,account_ids:n})=>{const{workspaceId:a,session:o,user:r}=xe(),i=o==null?void 0:o.access_token,l=s?"/api/standards/attack_paths/violations/report":"/api/standards/rule_violations/report";return g.useCallback(async()=>{var T;const R=await fetch(l,{method:"POST",body:JSON.stringify({export_by:r==null?void 0:r.email,filters:{rule_ids:e,attack_path_ids:s,account_ids:n}}),headers:{customer:a||"",authorization:`Bearer ${i}`,"content-type":"application/json"}});if(R.ok){const x="stream_violations_report-"+Ae().format("DD_MM_YYYY-HH:mm:ss")+".csv",w=ht.createWriteStream(x).getWriter(),m=(T=R.body)==null?void 0:T.getReader(),M=new TextDecoder("utf-8");let u=0,f=[];const N=18e4,P=async(v,E)=>Promise.race([v.read(),new Promise((I,W)=>setTimeout(()=>W(new Error("Request timed out")),E))]);try{for(;;){const{done:v,value:E}=await P(m,N);if(v){console.log("Download completed");break}const I=M.decode(E,{stream:!0});f.push(I),u+=I.length,await w.write(new TextEncoder().encode(I))}w.close(),console.log(`Total length: ${u} characters`),console.log(`Number of chunks: ${f.length}`)}catch(v){console.error("Error during file download:",v),w.abort()}}else console.error("Failed to fetch the CSV file")},[l,i,a,e,r==null?void 0:r.email,s])},_e=B.createContext(null);function mt({data:e,limit:s,itemCount:n,columns:a,onScroll:o,RowDetailsComponent:r,rowDetailsDisabled:i,headerDisabled:d,isSelected:j,disableZebra:l,sortOptions:_,onSortChange:R}){const[T,C]=g.useState({}),x=g.useMemo(()=>({data:e,columns:a,openMap:T,setOpenMap:C,RowDetailsComponent:r,rowDetailsDisabled:i,isSelected:j,disableZebra:l}),[r,a,e,j,T,i,l]);return t.jsx(_e.Provider,{value:x,children:t.jsxs(jt,{children:[!d&&t.jsx(yt,{columns:a,sortOptions:_,onSortChange:R}),t.jsx(ft,{children:t.jsx(ze,{data:e,itemCount:n,ItemComponent:gt,onScroll:o})})]})})}const jt=b.div.withConfig({displayName:"VirtualTable__TableContainer",componentId:"sc-1flnv7l-0"})(({theme:e})=>({display:"flex",flexDirection:"column",flexGrow:1,flexBasis:0,minWidth:400})),ft=b.div.withConfig({displayName:"VirtualTable__TableBody",componentId:"sc-1flnv7l-1"})(({theme:e})=>({flexGrow:1,flexBasis:0})),gt=B.forwardRef(({index:e,onSizeChange:s},n)=>{const{openMap:a,setOpenMap:o,columns:r,data:i,RowDetailsComponent:d,rowDetailsDisabled:j,isSelected:l,disableZebra:_}=g.useContext(_e),R=a[e],T=g.useCallback(()=>{o(c=>({...c,[e]:!c[e]})),setTimeout(s)},[e,s,o]),C=i[e],x=g.useMemo(()=>d&&(!j||!j(C)),[C,j,d]);return t.jsxs("div",{ref:n,children:[t.jsx(bt,{index:e,interactive:x,onClick:x?T:void 0,selected:l==null?void 0:l(C),disableZebra:_??!1,children:r.map((c,w)=>t.jsx(Se,{style:c.style,children:t.jsx(c.Component,{data:C,rowIndex:e,detailsOpen:R})},w))}),R&&t.jsx(d,{data:C,onSizeChange:s})]})}),ve=b.div.withConfig({displayName:"VirtualTable__TableRowContainer",componentId:"sc-1flnv7l-2"})(({theme:e})=>({display:"flex",flexDirection:"row",padding:e.spacing(1),alignItems:"center","& > *":{marginRight:e.spacing(1)},"& .row-hide":{visibility:"hidden"},"&:hover .row-hide":{visibility:"visible"}})),Se=b.div.withConfig({displayName:"VirtualTable__TableCellContainer",componentId:"sc-1flnv7l-3"})(({theme:e,onClick:s})=>({flexGrow:1,flexBasis:0,overflow:"hidden",display:"flex",flexDirection:"row",gap:e.spacing(1),alignItems:"center",...s&&{"&:hover":{cursor:"pointer",background:e.palette.action.hover}}})),bt=b(ve).withConfig({displayName:"VirtualTable__TableBodyRowContainer",componentId:"sc-1flnv7l-4"})(({theme:e,index:s,interactive:n,selected:a,disableZebra:o})=>({minHeight:45,...n&&{cursor:"pointer","&:hover":{background:e.palette.action.hover}},...!o&&s%2===0&&{background:e.palette.background.default},...a&&{background:e.palette.action.selected,"&:hover":{background:e.palette.action.selected}},...o&&{borderBottom:`solid 1px ${ue(e.palette.divider,.05)}`}}));function yt({columns:e,sortOptions:s,onSortChange:n}){return t.jsx(Ct,{children:e.map((a,o)=>t.jsxs(Se,{style:a.style,...a.sortField&&{onClick:()=>{n({sort_by:a.sortField,sort_order:s.sort_by!==a.sortField?-1:s.sort_order===-1?1:-1})}},children:[t.jsx(p,{component:"div",color:"textSecondary",children:a.title}),a.sortField&&(s.sort_by===a.sortField?s.sort_order===-1?t.jsx(Le,{fontSize:"small",color:"primary"}):t.jsx(Be,{fontSize:"small",color:"primary"}):t.jsx(De,{fontSize:"small",color:"secondary"}))]},o))})}const Ct=b(ve).withConfig({displayName:"VirtualTable__TableHeaderContainer",componentId:"sc-1flnv7l-5"})(({theme:e})=>({borderBottom:`solid 1px ${e.palette.dividerLight}`,marginBottom:e.spacing(1)}));function wt({filters:e}){const{bulkExclude:[,,{ids:s,reset:n,addAll:a}],bulkTicket:[,,{reset:o,addAll:r}]}=g.useContext(ne),i=()=>{s.size>0?(n(),o()):(a(e),r(e))};return t.jsx(me,{size:"small",indeterminate:s.size>0,checked:s.size>0,onChange:i})}function ds({rule:e,filters:s,exclusions:n,count:a,limit:o,onScroll:r}){return t.jsxs(Ne,{isRemove:!0,children:[t.jsx(St,{filters:s}),t.jsx(_t,{children:t.jsx(mt,{data:n,columns:Tt,itemCount:a,RowDetailsComponent:Pe,rowDetailsDisabled:i=>{var d;return((d=i==null?void 0:i.values)==null?void 0:d.length)===0},onScroll:r,limit:o,headerDisabled:!0})})]})}const _t=b(h).withConfig({displayName:"RuleManualExclusions__Container",componentId:"sc-1l9tufu-0"})({flexGrow:1}),vt=({ruleId:e,attackPathId:s})=>{const{workspaceId:n,session:a}=xe();return g.useCallback(async()=>{var j,l;const d=s?"/api/standards/attack_paths/exclusions/export":"/api/standards/rules/export-exclusions";try{const _=await fetch(`${d}`,{method:"POST",headers:{customer:String(n),authorization:`Bearer ${a==null?void 0:a.access_token}`,"content-type":"application/json"},body:JSON.stringify({rule_id:e,attack_path_id:s})});if(!_.ok)throw new Error(await _.text());const R=await _.blob(),T=window.URL.createObjectURL(R),C=document.createElement("a");C.href=T,C.download=((l=(j=_.headers.get("Content-Disposition"))==null?void 0:j.split("filename="))==null?void 0:l[1])??"exclusions.csv",document.body.appendChild(C),C.click(),C.remove()}catch(_){console.log(_)}},[n,a,e,s])};function St({filters:e}){const{bulkExclude:[,,{ids:s}]}=g.useContext(ne),n=vt({ruleId:e.rule_id});return t.jsxs(It,{gap:1,grow:[1,0],children:[t.jsxs(y,{gap:1,style:{alignItems:"center"},children:[t.jsx(wt,{filters:e}),s.size===0?t.jsx(p,{children:"No selected exclusions"}):t.jsx(p,{color:"primary",children:`${s.size} selected exclusion(s)`})]}),t.jsxs(y,{gap:1,children:[t.jsx(Fe,{Icon:Ue,label:"Un-exclude selected"}),t.jsxs(L,{color:"default",variant:"outlined",size:"small",onClick:n,style:{padding:"0px 12px "},startIcon:t.jsx(Ve,{style:{fontSize:12}}),children:["Export"," "]})]})]})}const It=b(y).withConfig({displayName:"RuleManualExclusions__HeaderContainer",componentId:"sc-1l9tufu-1"})(({theme:e})=>({alignItems:"center",padding:e.spacing(1)}));function Rt({data:e}){const s=g.useMemo(()=>[e==null?void 0:e.subject_id],[e==null?void 0:e.subject_id]),{bulkExclude:[,,{ids:n,add:a,remove:o}]}=g.useContext(ne),r=g.useMemo(()=>he.some(s,i=>n.has(i)),[s,n]);return t.jsx(me,{checked:r,size:"small",disabled:!e,onClick:i=>i.stopPropagation(),onChange:g.useCallback(i=>{r?o([e]):a([e])},[r,a,e,o])})}const Tt=[{Component:Rt,style:{flex:"unset"}},{title:"Resource",Component:Et},{title:"Exclusion date",Component:kt,style:{maxWidth:200}},{title:"Applied by",Component:At,style:{maxWidth:150}},{title:"Exclude reason",Component:Mt,style:{maxWidth:200}}];function Et({data:e}){return t.jsx(ae,{id:e==null?void 0:e.subject_id})}function kt({data:e}){return t.jsx(oe,{children:t.jsx(p,{children:Oe(e==null?void 0:e.exclusion_date)||!1})})}function At({data:e}){return t.jsx(oe,{children:t.jsx(p,{children:(e==null?void 0:e.user_name)||!1})})}function Mt({data:e}){return t.jsx(oe,{children:t.jsx(p,{children:(e==null?void 0:e.comment)||!1})})}function ps({rule:e,...s}){return t.jsx(zt,{...s,children:t.jsx(h,{gap:4,children:{path:t.jsx(Bt,{rule:e}),resource:t.jsx(Lt,{rule:e})}[e==null?void 0:e.rule_type]||!1})})}const zt=b.div.withConfig({displayName:"RuleConditions__Container",componentId:"sc-10ybiwt-0"})(({theme:e})=>({padding:e.spacing(3)}));function Lt({rule:e}){return t.jsxs(h,{gap:2,children:[t.jsx(S,{icon:t.jsx(re,{color:"action"}),label:"Resource",labelVariant:"subtitle1"}),t.jsx($,{predicates:e==null?void 0:e.resource_predicates}),(e==null?void 0:e.action)&&t.jsxs(t.Fragment,{children:[t.jsx(S,{icon:t.jsx(q,{color:"action"}),label:"Action",labelVariant:"subtitle1"}),t.jsx(H,{children:t.jsx(S,{icon:t.jsx(ee,{type:e.action}),label:G(e.action)})})]})]})}function Bt({rule:e}){var s;return t.jsxs(t.Fragment,{children:[t.jsxs(h,{gap:2,children:[t.jsxs(y,{gap:1,children:[t.jsx(S,{icon:t.jsx(re,{color:"action"}),label:"Source",labelVariant:"subtitle1"}),(e==null?void 0:e.subject)===J.Source&&t.jsx(Q,{})]}),t.jsx($,{predicates:e==null?void 0:e.path_source_predicates,match:e==null?void 0:e.path_source_predicate_equals_match})]}),t.jsxs(h,{gap:2,children:[t.jsxs(y,{gap:1,children:[t.jsx(S,{icon:t.jsx(je,{color:"action"}),label:"Intermediate",labelVariant:"subtitle1"}),(e==null?void 0:e.subject)===J.Intermediate&&t.jsx(Q,{})]}),t.jsx($,{predicates:e==null?void 0:e.path_intermediate_predicates,match:e==null?void 0:e.path_intermediate_predicate_equals_match,operand:e==null?void 0:e.path_intermediate_predicate_operand})]}),t.jsxs(h,{gap:2,children:[t.jsxs(y,{gap:1,children:[t.jsx(S,{icon:t.jsx(fe,{color:"action"}),label:"Destination",labelVariant:"subtitle1"}),(e==null?void 0:e.subject)===J.Destination&&t.jsx(Q,{})]}),t.jsx($,{predicates:e==null?void 0:e.path_destination_predicates,match:e==null?void 0:e.path_destination_predicate_equals_match})]}),((s=e==null?void 0:e.ports)==null?void 0:s.length)>0&&t.jsxs(h,{gap:2,children:[t.jsx(S,{icon:t.jsx(ge,{color:"action"}),label:"Ports",labelVariant:"subtitle1"}),t.jsx(Dt,{ranges:e==null?void 0:e.ports})]}),(e==null?void 0:e.allowed_actions)&&t.jsxs(h,{gap:2,children:[t.jsx(S,{icon:t.jsx(q,{color:"action"}),label:"Allowed Actions",labelVariant:"subtitle1"}),t.jsx(Ie,{value:e==null?void 0:e.allowed_actions})]})]})}function Ie({value:e}){const{operand:s,actions_list:n}=e;return t.jsx(H,{children:t.jsxs(y,{gap:2,children:[(n==null?void 0:n.length)>1&&t.jsxs(t.Fragment,{children:[t.jsx(p,{children:s})," ",t.jsx(be,{light:!0,orientation:"vertical",flexItem:!0})]}),t.jsx(h,{gap:1,children:n==null?void 0:n.map((a,o)=>t.jsxs(t.Fragment,{children:[a.value!==null&&t.jsxs(A,{gap:1,children:[t.jsx(p,{children:{equals:"is",not_equals:"is not"}[a.match_type]}),t.jsx(p,{children:a.value})]}),a.operand&&t.jsx(Ie,{value:a},o)]}))})]})})}function Dt({ranges:e}){return t.jsx(H,{children:t.jsx(h,{gap:1,children:e.map(({start:s,end:n,protocol:a},o)=>t.jsxs(y,{gap:1,children:[t.jsx(p,{children:s}),t.jsx(p,{color:"textSecondary",children:"-"}),t.jsx(p,{children:n}),t.jsx(p,{children:a})]},o))})})}const O=e=>{var s;return((s=e==null?void 0:e.attributes_list)==null?void 0:s.length)>0};function $({predicates:e,operand:s,match:n}){return e!=null&&e.length||(e=[{}]),t.jsxs(y,{gap:2,children:[typeof n=="boolean"&&t.jsx(p,{color:"textSecondary",children:n?"is":"is not"}),(e==null?void 0:e.length)>1&&t.jsxs(t.Fragment,{children:[t.jsx(p,{color:"textSecondary",children:s}),t.jsx(be,{orientation:"vertical",flexItem:!0,light:!0})]}),t.jsx(h,{children:e==null?void 0:e.map((a,o)=>t.jsx(Re,{condition:a},o))})]})}function Re({condition:e,emptyLabel:s="Any"}){const n=e==null?void 0:e.attributes,a=e==null?void 0:e.tags,o=e==null?void 0:e.locations;return t.jsxs(H,{gap:2,children:[t.jsx(y,{gap:2,style:{alignItems:"center"},children:t.jsx(Ft,{condition:e,emptyLabel:s})}),O(n)&&t.jsxs("div",{children:[t.jsx(S,{icon:t.jsx($e,{color:"action",fontSize:"small"}),label:"Attributes"}),t.jsx(se,{group:n})]}),O(a)&&t.jsxs("div",{children:[t.jsx(S,{icon:t.jsx(Ge,{color:"action",fontSize:"small"}),label:"Tags"}),t.jsx(se,{group:a})]}),(o==null?void 0:o.length)>0&&t.jsxs("div",{children:[t.jsx(S,{icon:t.jsx(qe,{color:"action",fontSize:"small"}),label:"Locations"}),o.map((r,i)=>t.jsx(Nt,{location:r},i))]})]})}function Nt({location:e}){return t.jsx(Pt,{children:t.jsx(ae,{id:e.location_value})})}const Pt=b.div.withConfig({displayName:"RuleConditions__LocationBox",componentId:"sc-10ybiwt-1"})(({theme:e})=>({marginLeft:e.spacing(4),padding:e.spacing(1),borderBottom:`solid 1px ${e.palette.dividerLight}`})),H=b(h).withConfig({displayName:"RuleConditions__ResourceConditionBox",componentId:"sc-10ybiwt-2"})(({theme:e})=>({}));function Ft({condition:e,emptyLabel:s}){var n;return e!=null&&e.resource_id?t.jsx(ae,{id:e==null?void 0:e.resource_id}):e!=null&&e.resource_type?t.jsx(S,{icon:t.jsx(He,{size:"small",type:e==null?void 0:e.resource_type}),label:((n=Me(e==null?void 0:e.resource_type))==null?void 0:n.display_name)||(e==null?void 0:e.resource_type)}):O(e==null?void 0:e.tags)||O(e==null?void 0:e.attributes)||O(e==null?void 0:e.locations)?t.jsx(B.Fragment,{}):t.jsx(S,{icon:t.jsx(Ye,{color:"action",fontSize:"small"}),label:s})}function se({group:e,gap:s}){var n;return t.jsxs(Ut,{gap:0,children:[t.jsx(Gt,{operand:e.operand,style:{visibility:((n=e.attributes_list)==null?void 0:n.length)>1?"visible":"hidden"}}),t.jsx(Vt,{list:e.attributes_list,gap:s})]})}const Ut=b(y).withConfig({displayName:"RuleConditions__ConditionAttributesGroupBox",componentId:"sc-10ybiwt-3"})(({theme:e})=>({padding:e.spacing(1,1,0,1)}));function Vt({list:e,gap:s=2}){return t.jsx(h,{gap:s,children:e==null?void 0:e.map((n,a)=>t.jsx(Ot,{attribute:n},a))})}function Ot({attribute:e,...s}){if(e.attributes_list)return t.jsxs(h,{...s,children:[t.jsx(S,{icon:t.jsx(pe,{fontSize:"small",color:"action"}),label:t.jsx(Wt,{children:e.name})}),t.jsx(se,{group:e,gap:1})]});const n=e.value[0];return t.jsxs($t,{gap:1,children:[t.jsx(pe,{fontSize:"small",color:"action"}),t.jsx(p,{children:e.name}),t.jsx(p,{color:"textSecondary",children:Je(e.match_type)}),t.jsx(p,{children:n===!0?"true":n===!1?"false":typeof n=="string"||typeof n=="number"?n:""})]})}const Wt=b(p).withConfig({displayName:"RuleConditions__AttributeNameTypogaphy",componentId:"sc-10ybiwt-4"})(({theme:e})=>({})),$t=b(y).withConfig({displayName:"RuleConditions__ConditionAttributeBox",componentId:"sc-10ybiwt-5"})(({theme:e})=>({padding:e.spacing(1,0,1,0),borderBottom:`solid 1px ${e.palette.dividerLight}`}));function Gt({operand:e,...s}){return t.jsx(qt,{...s,children:e})}const qt=b.span.withConfig({displayName:"RuleConditions__OperandBox",componentId:"sc-10ybiwt-6"})(({theme:e})=>({padding:e.spacing(1),minWidth:50,color:e.palette.text.secondary,borderRadius:e.shape.borderRadius/2})),Ht=b(We).withConfig({displayName:"RuleConditions__StyledChip",componentId:"sc-10ybiwt-7"})(({theme:e})=>({backgroundColor:ue(e.palette.primary.main,.25),color:e.palette.primary.main,borderRadius:e.shape.borderRadius})),Q=()=>t.jsx(Ke,{placement:"top",title:"This resource is set to trigger a violation when the ruleâs criteria are met.",children:t.jsx(Ht,{size:"small",color:"primary",label:"Violating Resource"})}),Yt={protocol:"TCP"},Jt=B.forwardRef(({value:e,onChange:s,error:n},a)=>t.jsxs(t.Fragment,{children:[t.jsx(ie,{error:!!n,ref:a,children:t.jsx(xt,{value:e,onChange:s,defaultRange:Yt,disableAnyProtocol:!0})}),n&&t.jsx(p,{color:"error",children:n.message||"Validation error"})]})),Kt=B.forwardRef(({value:e,onChange:s,error:n},a)=>t.jsxs(t.Fragment,{children:[t.jsx(Te,{value:e,onChange:s,ref:a}),n&&t.jsx(p,{color:"error",children:n.message||"Validation error"})]})),Te=B.forwardRef(({value:e,onChange:s,onDelete:n},a)=>{const{operand:o=U.And,actions_list:r}=e||{};return t.jsx(ie,{ref:a,children:t.jsxs(y,{gap:2,grow:[0,1],children:[(r==null?void 0:r.length)>1&&t.jsx("div",{children:t.jsx(Qt,{size:"small",onClick:()=>s({...e,operand:o===U.And?U.Or:U.And}),children:o})}),t.jsxs(h,{gap:1,children:[r==null?void 0:r.map((i,d)=>{var j;return t.jsx(t.Fragment,{children:!((j=i.actions_list)!=null&&j.length)||!i.operand?t.jsxs(A,{gap:1,children:[t.jsxs(le,{value:i.match_type,style:{width:70},onChange:l=>s({...e,actions_list:z(r,{[d]:{$set:{...i,match_type:l.target.value}}})}),children:[t.jsx(F,{value:K.Equals,children:"is"}),t.jsx(F,{value:K.NotEquals,children:"is not"})]}),t.jsx(Qe,{value:i.value,fullWidth:!0,style:{maxWidth:300},onChange:l=>s({...e,actions_list:z(r,{[d]:{$set:{...i,value:l.target.value}}})})}),t.jsx(ce,{size:"small",onClick:()=>s({...e,actions_list:z(r,{$splice:[[d,1]]})}),children:t.jsx(te,{fontSize:"small"})})]},d):t.jsx(Te,{value:i,onChange:l=>s({...e,actions_list:z(r,{[d]:{$set:l}})}),onDelete:()=>s({...e,actions_list:z(r,{$splice:[[d,1]]})})},d)})}),t.jsxs(y,{gap:2,children:[t.jsx(L,{startIcon:t.jsx(de,{fontSize:"small",color:"action"}),size:"small",variant:"text",onClick:()=>s({...e,actions_list:[...r||[],{value:"",match_type:K.Equals}]}),children:"Add Allowed Action"}),t.jsx(L,{startIcon:t.jsx(Xe,{fontSize:"small",color:"action"}),size:"small",variant:"text",onClick:()=>s({...e,operand:o,actions_list:[...r||[],{operand:U.Or,actions_list:[]}]}),children:"Add Group"}),n&&t.jsx(L,{startIcon:t.jsx(te,{fontSize:"small",color:"action"}),size:"small",variant:"text",onClick:n,children:"Delete Group"})]})]})]})})}),Qt=b(L).withConfig({displayName:"RuleAllowedActionsInput__OperandButton",componentId:"sc-1f6psx7-0"})({minWidth:50}),Xt=B.forwardRef(({value:e,onChange:s},n)=>{const[a,o]=g.useState({open:!1,anchorEl:null}),r=g.useCallback(()=>{o(l=>({...l,open:!1}))},[]),i=g.useCallback(l=>{s(l),r()},[r,s]),d=g.useCallback(l=>o({open:!0,anchorEl:l.target}),[]),j=g.useCallback(l=>s(null),[s]);return t.jsxs(ie,{ref:n,children:[e?t.jsxs(y,{gap:1,style:{alignItems:"center"},children:[t.jsx(ee,{type:e,fontSize:"small"}),t.jsx(p,{children:G(e)}),t.jsx(ce,{size:"small",onClick:j,children:t.jsx(te,{fontSize:"small"})})]}):t.jsx(L,{startIcon:t.jsx(de,{fontSize:"small",color:"action"}),size:"small",variant:"text",onClick:d,children:"Add Action"}),t.jsx(Ze,{...a,onClose:r,children:["create","modify","delete"].map(l=>t.jsxs(et,{onClick:()=>i(l),children:[t.jsx(tt,{children:t.jsx(ee,{type:l})}),t.jsx(st,{primary:G(l)})]},l))})]})}),Zt=[Z.Path,Z.Resource];function xs({form:e}){const{control:s}=e,n=e.watch("rule_type");return t.jsxs(h,{gap:2,children:[t.jsxs(y,{gap:3,style:{alignItems:"center"},children:[t.jsx(p,{variant:"caption",color:"textSecondary",children:"Rule Type"}),t.jsx(k,{name:"rule_type",control:s,render:({field:a})=>t.jsx(nt,{...a,children:t.jsx(y,{gap:2,children:Zt.map(o=>t.jsx(at,{control:t.jsx(ot,{color:"primary",value:o}),label:G(o)},o))})})})]}),n===Z.Path?t.jsxs(h,{gap:1,style:{height:"100%"},children:[t.jsxs(A,{gap:2,children:[t.jsx(D,{variant:"subtitle2",Icon:re,title:"Source"}),t.jsx(X,{form:e,attr:"path_source_predicate_equals_match"})]}),t.jsx(k,{name:"path_source_predicates",control:s,render:({field:a})=>t.jsx(V,{edgeType:"src",addButtonText:"Add Source",...a})}),t.jsxs(A,{gap:2,children:[t.jsx(D,{variant:"subtitle2",Icon:je,title:"Intermediate"}),t.jsx(X,{form:e,attr:"path_intermediate_predicate_equals_match"}),t.jsx(es,{form:e,attr:"path_intermediate_predicate_operand"})]}),t.jsx(k,{name:"path_intermediate_predicates",control:s,render:({field:a})=>t.jsx(V,{edgeType:"int",addButtonText:"Add Intermediate",...a})}),t.jsxs(A,{gap:2,children:[t.jsx(D,{variant:"subtitle2",Icon:fe,title:"Destination"}),t.jsx(X,{form:e,attr:"path_destination_predicate_equals_match"})]}),t.jsx(k,{name:"path_destination_predicates",control:s,render:({field:a})=>t.jsx(V,{edgeType:"dst",addButtonText:"Add Destination",...a})}),t.jsx(D,{variant:"subtitle2",Icon:ge,title:"Ports"}),t.jsx(k,{name:"ports",control:s,rules:{validate:a=>he.every(a,o=>ts(o))},render:({field:a,fieldState:o})=>t.jsx(Jt,{...o,...a})}),t.jsx(D,{variant:"subtitle2",Icon:q,title:"Allowed Actions"}),t.jsx(k,{name:"allowed_actions",control:s,render:({field:a,fieldState:o})=>t.jsx(Kt,{...o,...a})})]}):t.jsxs(t.Fragment,{children:[t.jsx(D,{variant:"subtitle2",Icon:ye,title:"Resource"}),t.jsx(k,{name:"resource_predicates",control:s,render:({field:a})=>t.jsx(V,{addButtonText:"Add Resource",...a})}),t.jsx(D,{variant:"subtitle2",Icon:q,title:"Action"}),t.jsx(k,{name:"action",control:s,render:({field:a})=>t.jsx(Xt,{...a})})]})]})}function V({value:e,onChange:s,edgeType:n,addButtonText:a,emptyLabel:o}){return(!e||e.length===0)&&(e=[{}]),t.jsxs(h,{gap:1,children:[e==null?void 0:e.map((r,i)=>t.jsxs(A,{grow:[1,0],gap:1,children:[t.jsx(rt,{value:r,edgeType:n,emptyLabel:o,onChange:d=>s(z(e,{[i]:{$set:d}}))}),e.length>1&&t.jsx(ce,{size:"small",onClick:()=>s(z(e,{$splice:[[i,1]]})),children:t.jsx(it,{fontSize:"small"})})]},i)),a&&(e.length>1||e[0].resource_id||e[0].resource_type)&&t.jsx("div",{children:t.jsx(L,{onClick:()=>s(z(e,{$push:[{}]})),size:"small",variant:"text",startIcon:t.jsx(de,{}),children:a})})]})}function X({form:e,attr:s}){const n=typeof e.watch(s)>"u"?!0:e.watch(s);return t.jsx(Ce,{children:t.jsxs(le,{margin:"none",disableUnderline:!0,value:n?"true":"false",onChange:a=>e.setValue(s,a.target.value==="true"),children:[t.jsx(F,{value:"true",children:"is"}),t.jsx(F,{value:"false",children:"is not"})]})})}function es({form:e,attr:s}){const n=typeof e.watch(s)>"u"?"OR":e.watch(s);return t.jsx(Ce,{children:t.jsxs(le,{margin:"none",disableUnderline:!0,value:n,onChange:a=>e.setValue(s,a.target.value),children:[t.jsx(F,{value:"AND",children:"AND"}),t.jsx(F,{value:"OR",children:"OR"})]})})}function ts(e){return!(e.start&&(e.start<1||e.start>65535)||e.end&&(e.end<1||e.end>65535)||e.end&&e.start&&e.start>e.end)}const D=({Icon:e,title:s,variant:n="subtitle1"})=>t.jsxs(A,{gap:1,children:[t.jsx(e,{fontSize:"small",color:"action"}),t.jsx(p,{variant:n,children:s})]});function ss({form:e}){const{control:s}=e;return t.jsx(h,{gap:2,children:t.jsxs(h,{gap:2,style:{height:"100%"},children:[t.jsx(S,{labelVariant:"subtitle2",icon:t.jsx(ye,{fontSize:"small",color:"action"}),label:"Resource"}),t.jsx(k,{name:"exclusion_predicates",control:s,render:({field:n})=>t.jsx(V,{emptyLabel:"None",...n})})]})})}function us({form:e,submitting:s,onSubmit:n}){const[a,o]=g.useState(!1),r=e.watch("exclusion_predicates");return t.jsx(os,{children:t.jsxs(h,{gap:4,children:[t.jsx(lt,{children:t.jsxs(A,{gap:2,children:[t.jsxs(A,{gap:1,children:[t.jsx(ct,{color:"action"}),t.jsx(p,{variant:"subtitle1",children:"Exclude Conditions"})]}),a?t.jsxs(t.Fragment,{children:[t.jsx(p,{color:"primary",component:"a",onClick:()=>{e.reset(),o(!1)},children:"Cancel edit"}),t.jsx("div",{style:{flexGrow:1}}),t.jsx(L,{startIcon:t.jsx(dt,{}),disabled:!e.formState.isDirty||s,color:"primary",size:"small",onClick:async()=>{await n(),o(!1)},children:"Save"}),s&&t.jsxs(t.Fragment,{children:[t.jsx(pt,{size:15}),t.jsx(p,{color:"textSecondary",children:"Saving..."})]})]}):t.jsx(p,{color:"primary",component:"a",onClick:()=>o(!0),children:"Edit"})]})}),t.jsx(as,{disabled:!a,form:e,children:t.jsx(ns,{condition:r==null?void 0:r[0],children:t.jsx(Re,{condition:r==null?void 0:r[0],emptyLabel:"None"})})})]})})}const ns=B.memo(e=>{const{condition:s,children:n}=e;return Object.keys(s||{}).filter(o=>o!=="__typename"&&s[o]!==null).length>0?n:t.jsx(p,{color:"textSecondary",children:"None"})});function as({disabled:e,form:s,children:n}){return e?n:t.jsx(ss,{form:s})}const os=b.div.withConfig({displayName:"ExcludeConditions__Container",componentId:"sc-1l9fpp2-0"})(({theme:e})=>({padding:e.spacing(3)}));export{us as E,xs as R,vt as a,ss as b,ps as c,ds as d,cs as u};
